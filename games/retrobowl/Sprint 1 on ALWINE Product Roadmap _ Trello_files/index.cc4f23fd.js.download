function e(e){return e&&e.__esModule?e.default:e}var t=globalThis,i={},a={},l=t.parcelRequiree178;null==l&&((l=function(e){if(e in i)return i[e].exports;if(e in a){var t=a[e];delete a[e];var l={id:e,exports:{}};return i[e]=l,t.call(l.exports,l,l.exports),l.exports}var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}).register=function(e,t){a[e]=t},t.parcelRequiree178=l);var r=l.register;r("2CzA6",function(e,t){let i=["http://localhost:2999/","http://localhost:3003/"];e.exports={getTargetOrigin:()=>{var e;return i.includes(null===(e=document)||void 0===e?void 0:e.referrer)?document.referrer:"https://trello.com".toString()}}}),r("kLmoG",function(e,t){e.exports={defaultLocale:"en",supportedLocales:["cs","de","en","es","fi","fr","hu","it","ja","nb","nl","pl","pt-BR","ru","sv","th","tr","uk","vi","zh-Hans","zh-Hant"],resourceUrl:"./strings/98d7172763b1/{locale}.json"}});var s=l("2CzA6"),c=l("g7WGV"),n=l("kLmoG"),c=l("g7WGV"),o=l("a2sLy");const{Promise:u}=window.TrelloPowerUp,d=(e,t,i)=>u.try(()=>{if(i&&i!==t)return i;let a=(0,o.zendeskURL).parse(t);if(!a.isZendesk)throw e.NotHandled("Not a Zendesk url");return a.isTicket?(0,c.API).getTicket(e,a.ticketId).then(e=>e.ticket.subject?e.ticket.subject:`#${e.ticket.id}`):a.isView?(0,c.API).getView(e,a.viewId).then(e=>e.view.title):t});var h={};h=function(){for(var e={},t=0;t<arguments.length;t++){var i=arguments[t];for(var a in i)_.call(i,a)&&(e[a]=i[a])}return e};var _=Object.prototype.hasOwnProperty,c=(l("g7WGV"),l("g7WGV")),p=l("g8ktN");const{Promise:k}=window.TrelloPowerUp,g=(e,t)=>new k(i=>e.popup({title:e.localizeKey("authorize"),url:"authorize.html",callback:e=>t(e).then(i),height:103})),m=(e,t)=>{let i=e=>t(e).catch(p.zendeskError,t=>{if(t instanceof p.zendeskError.Unauthorized||t instanceof p.zendeskError.MissingSubdomain)return g(e,i);throw t});return i(e)},y=(e,t,i,a)=>m(e,l=>i.getList(l,a).then(a=>new k(l=>{let r=i.nameAttr||"name",s=a.map(e=>({text:e[r],callback:a=>k.try(()=>i.set(e)).then(e=>t(a,e)).then(l)}));return e.popup({title:i.title,items:s,search:i.search})}))),z=e=>(0,c.API).listUsers(e).then(e=>e.users.map(e=>({id:e.id,name:e.name}))),w=(e,t)=>y(e,t,{getList:z,set:e=>e,title:e.localizeKey("choose_a_person"),search:{count:10,placeholder:e.localizeKey("search_for_a_person"),empty:e.localizeKey("nobody_found")}}),b=e=>(0,c.API).listActiveViews(e).then(e=>e.views.map(e=>({id:e.id,name:e.title}))),f=(e,t)=>y(e,t,{getList:b,set:e=>e,title:e.localizeKey("choose_a_view"),search:{count:10,placeholder:e.localizeKey("search_views"),empty:e.localizeKey("no_views_found")}}),v=e=>(0,c.API).listTags(e).then(e=>e.tags.map(e=>({name:e.name}))),K=(e,t)=>y(e,t,{getList:v,set:e=>e,title:e.localizeKey("choose_a_tag"),search:{count:10,placeholder:e.localizeKey("search_for_a_tag"),empty:e.localizeKey("no_tags_found")}}),{Promise:T}=window.TrelloPowerUp,x=(t,i)=>(a,l)=>m(a,async a=>{let r=(await t(a,l)).map(t=>e(h)(t,{callback:e=>T.all([e.get("organization","shared","subdomain"),e.get("board","shared","subdomain")]).spread((e,t)=>t||e).then(i=>e.attach({url:`https://${i}${t.url}`,name:t.text}).then(()=>e.closePopup()))}));return a.popup({title:i.getTitle(l)||a.localizeKey("zendesk"),items:r,search:i.search})}),P=e=>`.zendesk.com/agent/tickets/${e}`,A=e=>`.zendesk.com/agent/filters/${e}`,U=e=>(0,c.API).getRecentlyUpdatedTickets(e).then(e=>e.results.map(e=>({url:P(e.id),text:e.subject?e.subject:`#${e.id}`}))),I=e=>t=>w(t,e),j=e=>t=>f(t,e),L=e=>t=>K(t,e),$=e=>(0,c.API).getAuthenticatedUser(e).then(t=>(0,c.API).getTicketsAssignedToUser(e,t.user.id).then(e=>e.results.map(e=>({url:P(e.id),text:e.subject?e.subject:`#${e.id}`})))),O=(e,t)=>(0,c.API).getTicketsAssignedToUser(e,t.id).then(e=>e.results.map(e=>({url:P(e.id),text:e.subject?e.subject:`#${e.id}`}))),R=(e,t)=>(0,c.API).executeView(e,t.id,100).then(e=>e.rows.map(e=>({url:P(e.ticket.id),text:e.subject||e.ticket.subject}))),V=(e,t)=>(0,c.API).getTicketsWithTag(e,t.name).then(e=>e.results.map(e=>({url:P(e.id),text:e.subject?e.subject:`#${e.id}`}))),N=e=>(0,c.API).listActiveViews(e).then(e=>e.views.map(e=>({url:A(e.id),text:e.title}))),E=e=>({count:10,placeholder:e.localizeKey("search_tickets"),empty:e.localizeKey("no_tickets_found")}),G=e=>e.popup({title:e.localizeKey("attach_a_ticket"),items:[{text:e.localizeKey("attach_a_recently_updated_ticket"),callback:x(U,{getTitle:()=>e.localizeKey("recently_updated_tickets"),search:E(e)})},{text:e.localizeKey("attach_a_ticket_assigned_to_me"),callback:x($,{getTitle:()=>e.localizeKey("assigned_to_me"),search:E(e)})},{text:e.localizeKey("attach_a_ticket_assigned_to_someone"),callback:I(x(O,{getTitle:t=>e.localizeKey("assigned_to_name",{name:t.name}),search:E(e)}))},{text:e.localizeKey("attach_a_ticket_by_view"),callback:j(x(R,{getTitle:t=>e.localizeKey("tickets_in_view",{view:t.name}),search:E(e)}))},{text:e.localizeKey("attach_a_ticket_by_tag"),callback:L(x(V,{getTitle:t=>e.localizeKey("tickets_with_tag",{tagname:t.name}),search:E(e)}))}]}),H=async e=>{let t=await T.all([e.get("organization","shared","subdomain"),e.get("board","shared","subdomain")]).spread((e,t)=>t||e).then(t=>t?{items:[{text:e.localizeKey("attach_a_ticket"),callback:G},{text:e.localizeKey("attach_a_view"),callback:x(N,{getTitle:()=>e.localizeKey("views"),search:{count:10,placeholder:e.localizeKey("search_views"),empty:e.localizeKey("no_views_found")}})}]}:{url:"authorize.html",height:91});return e.popup({title:e.localizeKey("zendesk"),...t})};var p=l("g8ktN"),o=l("a2sLy");const{Promise:S}=window.TrelloPowerUp,W="./images/icon.svg";window.TrelloPowerUp.initialize({"attachment-sections":(e,t)=>{let i=[],a=t.entries.filter(e=>(0,o.zendeskURL).isTicket(e.url));a.length>0&&i.push({claimed:a,icon:W,title:e.localizeKey("zendesk_tickets"),content:{type:"iframe",url:e.signUrl("./tickets.html"),height:38*a.length}});let l=t.entries.filter(e=>(0,o.zendeskURL).isView(e.url));return l.length>0&&l.forEach(t=>{let a=d(e,t.url,t.name).then(t=>t&&0!==t.indexOf("https://")?t:e.localizeKey("zendesk_view"));i.push({claimed:[t],icon:W,id:(0,o.zendeskURL).parse(t.url).viewId,title:()=>a,content:{type:"iframe",url:e.signUrl("./view.html",{url:t.url})}})}),i},"card-badges":(e,t)=>{let i=t.attachments.filter(e=>(0,o.zendeskURL).isTicket(e.url));return i.length>0?[{text:i.length.toString(),icon:W}]:[]},"card-buttons":e=>e.memberCanWriteToModel("card")?[{icon:W,text:e.localizeKey("zendesk"),callback:H}]:[],"card-from-url":(e,t)=>d(e,t.url).then(e=>e&&e!==t.url?{name:e}:null).catch(p.zendeskError,()=>{throw e.NotHandled()}),"format-url":async(e,t)=>{let i=(0,o.zendeskURL).parse(t.url);if(!i.isZendesk)throw e.NotHandled();try{if(i.ticketId){let{ticket:t}=await (0,c.API).getTicket(e,i.ticketId),a=(t,i)=>{let a=`${t}_${i}`;return["ticket_priority","ticket_priority_low","ticket_priority_high","ticket_priority_normal","ticket_priority_urgent","ticket_status","ticket_status_closed","ticket_status_hold","ticket_status_new","ticket_status_open","ticket_status_pending","ticket_status_solved","ticket_type","ticket_type_incident","ticket_type_problem","ticket_type_question","ticket_type_task"].includes(a)?`${e.localizeKey(t)}: ${e.localizeKey(`${t}_${i}`)}`:""},l=[a("ticket_status",t.status),a("ticket_type",t.type),a("ticket_priority",t.priority)].filter(e=>e);return{icon:W,text:t.subject?t.subject:`#${t.id}`,subtext:`${l.join(" | ")}`}}let a=await d(e,t.url,t.name);if(a)return{icon:W,text:a};return{icon:W,text:t.url}}catch(t){throw e.NotHandled()}},"show-settings":e=>e.popup({title:e.localizeKey("zendesk_settings"),url:"settings.html",height:178}),"authorization-status":e=>S.all([(0,c.API).getTokenData(e),(0,c.API).getSubdomain(e)]).then(([e,t])=>({authorized:e.token&&t&&e.subdomain===t})),"show-authorization":e=>e.popup({title:e.localizeKey("authorize"),url:"authorize.html",height:91})},{targetOrigin:(0,s.getTargetOrigin)(),localization:e(n),Sentry:window.Sentry});
//# sourceMappingURL=index.cc4f23fd.js.map
