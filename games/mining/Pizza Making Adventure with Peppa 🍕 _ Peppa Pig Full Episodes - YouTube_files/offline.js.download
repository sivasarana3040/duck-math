(function(g){var window=this;'use strict';var AN9=function(){i5.apply(this,arguments)},knv=function(){i5.apply(this,arguments)},jI2=function(K){K.C&&(K.S=!0,PY(K))},Gnm=function(){i5.apply(this,arguments)},u57=function(){i5.apply(this,arguments)},hz2=function(K){var X=(K.C.transferRetryCount||0)<3;
X&&(K=K.C,K.transferRetryCount=(K.transferRetryCount||0)+1);return X},H2v=function(){i5.apply(this,arguments)},i2e=function(K){return g.E(function(X){if(X.C==1)X=g.B(X,cNK(),2);
else{var Q=K.gf;var p=g.Ya();p=Object.keys(p);Q=JNl(Q,p);X=g.B(X,Q,0)}return X})},PCj=function(){i5.apply(this,arguments)},oi=function(K){this.C=K},obl=function(){i5.apply(this,arguments)},Z9=function(K,X,Q,p){Q=Q===void 0?!1:Q;
p=p===void 0?!0:p;X=typeof X==="string"?X:X.videoDetails.videoId;if(g.dC(X)===2){var U=Z2m(K,X);U&&U.stopVideo();g.Wi(X,2);K.J=2;Q?gbz(K.C):p&&rNl(K.C)}},yNz=function(K){return K instanceof Error?new gj("UNKNOWN_ENCODE_ERROR",{originalMessage:K.message}):new gj("UNKNOWN_ENCODE_ERROR")},tOx=function(){i5.apply(this,arguments)},BzC=function(){i5.apply(this,arguments)},Y49=function(){i5.apply(this,arguments)},m0J=function(K,X){var Q,p,U,I,d,L,b,S,N,D,v,n,a,R,O,A,w,u;
return g.E(function(h){if(h.C==1)return Q=g.h9("main_downloads_library_id","mainDownloadsLibraryEntity"),p=g.h9("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.B(h,rj(K,{mode:"readonly",o$:!0},function(r){return g.WN.all([yR(r,Q,"mainDownloadsLibraryEntity"),yR(r,p,"mainDownloadsListEntity")])}),2);
U=h.j;I=g.G(U);d=I.next().value;L=I.next().value;b=d;S=L;b||(b={id:Q});N=g.G(X);for(D=N.next();!D.done;D=N.next())if(v=D.value,v===g.iG){if(b.smartDownloadsList)return h.return();b.smartDownloadsList=v}else if(n=g.Xf(v).entityType,a={},n==="mainPlaylistEntity"?a.playlistItem=v:n==="mainVideoEntity"&&(a.videoItem=v),!g.HN(a)){R=void 0;if((R=S)==null?0:R.downloads){O=!1;A=g.G(S.downloads);for(w=A.next();!w.done;w=A.next())if(u=w.value,u.playlistItem===v||u.videoItem===v){O=!0;break}O||S.downloads.push(a)}else S=
{id:p,downloads:[a]};b.downloadsList=p}return h.return({mainDownloadsLibraryEntity:b,mainDownloadsListEntity:S})})},q4v=function(K){var X;
return g.E(function(Q){if(Q.C==1)return g.B(Q,t0(K.j,"offlineOrchestrationActionWrapperEntity"),2);X=Q.j;return g.B(Q,ezm(K,X),0)})},ldK=function(K){return x09[K.transferState]!==void 0},KlC=function(){i5.apply(this,arguments)},Xn9=function(){i5.apply(this,arguments)},pnl=function(){try{var K=g.R9("ytglobal.locks_");
if(K)return K;var X;if(X=navigator){var Q=navigator;X="locks"in Q&&!!Q.locks}if(X)return g.RW.localStorage&&g.RW.localStorage.getItem("noop"),K=new Qal,g.M3("ytglobal.locks_",K),K}catch(p){}},$$j=function(K,X){var Q,p,U,I,d,L;
return g.E(function(b){switch(b.C){case 1:if(K.W)return b.return();K.W=!0;K.C=X;Q=g.Xf(K.C.key);p=Q.entityId;U=void 0;if(K.C.transferState==="TRANSFER_STATE_TRANSFERRING")return g.B(b,BY(K,p),7);if(K.C.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||K.C.transferRetryCount||K.C.hasLoggedFirstStarted){b.ZS(3);break}return g.B(b,BY(K,p),5);case 5:return U=b.j,K.C.hasLoggedFirstStarted=!0,g.B(b,U$z(K),6);case 6:IRo({videoId:p,oE:K.C,offlineModeType:U},void 0,void 0,!0);b.ZS(3);break;case 7:U=b.j,
Yv({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:p,oE:K.C,offlineModeType:U});case 3:return g.B(b,d$n(K),8);case 8:return I=null,g.PG(b,9),g.B(b,TBl(K,X),11);case 11:I=b.j;K.S=I;g.U7(b,10);break;case 9:return d=g.XZ(b),mg("error getting player response",d,X.cotn),g.B(b,K.PQ("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return b.return();case 10:return L=Llj(K.api.B(),X.cotn,I),g.B(b,bTm(K,L),13);case 13:return g.B(b,StJ(L.videoId),
14);case 14:L.d4=b.j;var S=K.N,N=L,D=X.maximumDownloadQuality;N.getPlayerResponse();g.Wi(N.videoId,2);S.J=2;S.j=!1;var v;(v=S.player)==null||v.dispose();S.player=S.api.yB(N);N={};S.player.vv((N.localmediachange=S.GJ,N.signatureexpired=S.Rj,N.statechange=S.P8J,N),S);S.K("html5_generate_content_po_token")&&S.player.tU();D=S.Qw(D);S.player.iA(g.Kx(D,D,!0,"m"),!1);S.player.Ef(!1);K.T.start(108E5);g.mk(b)}})},vOj=function(K,X,Q,p,U){var I,d,L,b,S,N;
return g.E(function(D){switch(D.C){case 1:if(I=p){D.ZS(2);break}return g.B(D,NBe([X]),3);case 3:d=D.j,I=d[0];case 2:return g.B(D,D$v(K,I,Q,U),4);case 4:L=D.j;b=L.mainVideoEntity;S=L.channelEntity;g.PG(D,5);var v=eY(b.thumbnail),n=eY(S.avatar);return g.B(D,qU(v.concat(n)),7);case 7:g.U7(D,0);break;case 5:N=g.XZ(D),N instanceof Error&&N.message==="Failed to fetch"&&mg(N.message),g.mk(D)}})},xv=function(){},nOJ=function(){i5.apply(this,arguments)},BY=function(K,X){var Q,p,U;
return g.E(function(I){if(I.C==1)return g.B(I,l5(K.j,g.h9(X,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);Q=I.j;return I.return((U=(p=Q)==null?void 0:p.offlineModeType)!=null?U:void 0)})},Qal=function(){this.locks=navigator.locks},aRn=function(K,X,Q){this.C=K;
this.V=X;this.J=Q},Fll=function(){i5.apply(this,arguments)},EOe=function(){i5.apply(this,arguments)},qU=function(K){var X,Q;
return g.E(function(p){if(p.C==1)return g.B(p,V2l(),2);if(p.C!=3){X=p.j;if(!X)throw Error("Cache API not supported");return K.length?g.B(p,X.open("yt-player-local-img"),3):p.return()}Q=p.j;return g.B(p,Q.addAll(K),0)})},Rqj=function(){i5.apply(this,arguments)},CDv=function(){i5.apply(this,arguments)},M2n=function(){i5.apply(this,arguments)},OTK=function(){i5.apply(this,arguments)},Wl7=function(){i5.apply(this,arguments)},saC=function(K,X){var Q,p,U;
return g.E(function(I){Q=g.G(X);for(p=Q.next();!p.done;p=Q.next()){U=p.value;var d=void 0,L=void 0,b=((L=U.action)==null?void 0:(d=L.actionMetadata)==null?void 0:d.retryScheduleIntervalsInSeconds)||[1,2,4];d=1;U.retryScheduleIndex<b.length&&(d=b[U.retryScheduleIndex]);U.C=d*1E3+Date.now();U.retryScheduleIndex++}return g.B(I,wnj(K,X),0)})},zqm=function(){},Ag9=function(K,X){var Q,p;
return g.E(function(U){switch(U.C){case 1:return Q=Kn(X),g.B(U,l5(K.C,X.entityKey,"transfer"),2);case 2:p=U.j;if(!p||p.transferState!=="TRANSFER_STATE_COMPLETE")return U.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q));g.PG(U,3);return g.B(U,fRj(K,X,!0),5);case 5:g.U7(U,4);break;case 3:return g.XZ(U),U.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return U.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q))}})},kHv=function(K){var X=new g.JM("und",new g.mA("Default","und",!0));
X.captionTracks=K.captionTracks;return X},Qu=function(K,X){var Q=g.dC(X);
if(Q===1||Q===0)return Promise.resolve();(Q=Z2m(K,X))&&Q.stopVideo();K.J=0;return jao(X)},pn=function(K){return{key:g.h9(K.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:K.action,parentActionId:K.parentActionId,rootActionId:K.rootActionId,childActionIds:K.childActionIds,prereqActionId:K.prereqActionId,postreqActionIds:K.postreqActionIds,retryScheduleIndex:K.retryScheduleIndex,hasChildActionFailed:K.hasChildActionFailed,enqueueTimeSec:(K.C/1E3).toFixed()}},GH7=function(K,X,Q){if(!Q){var p=p===void 0?!1:p;
Q=K.C.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!Q||p)Q=g.Oo(16),K.C.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",Q)}K={flowNonce:Q,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:X.eventType};X.metadata&&(K.flowMetadata=X.metadata);X.statusCode!==void 0&&(K.flowEventStatus=X.statusCode);X.csn&&(K.csn=X.csn);X.can&&(K.can=X.can);g.gN("flowEvent",K,void 0)},IX=function(K,X){X=X===void 0?!1:X;
var Q;return g.E(function(p){if(p.C==1){if(K.C)throw Error("Already downloading a video");K.mq=0;K.W=!1;return g.B(p,uLj(K),2)}return p.C!=4?(Q=p.j,hqe(K.vP,!Q),Q&&K.L.mE()?X?g.B(p,new Promise(function(U){g.FH(U,1E3)}),4):p.ZS(4):(!Q&&K.C&&U3(K),p.ZS(0))):g.B(p,$$j(K,Q),0)})},HTx=function(){i5.apply(this,arguments)},cge=function(K,X){var Q,p,U,I,d,L,b,S;
return g.E(function(N){Q=eY(K.avatar);p=g.G(X);for(U=p.next();!U.done;U=p.next())if(I=U.value,I.id!==K.id)for(d=g.G(eY(I.avatar)),L=d.next();!L.done;L=d.next())b=L.value,S=Q.indexOf(b),S!==-1&&Q.splice(S,1);return N.return(Q)})},Jgm=function(){i5.apply(this,arguments)},uLj=function(K){var X,Q;
return g.E(function(p){if(p.C==1)return g.B(p,t0(K.j,"transfer"),2);X=p.j;Q=X.filter(ldK).sort(iTl);return Q.length===0?p.return():p.return(Q[0])})},PD3=function(){i5.apply(this,arguments)},t2e=function(K,X){var Q,p,U,I,d,L,b,S,N,D,v,n,a,R,O,A,w,u,h,r,C,Y,l,IS;
return g.E(function(pZ){switch(pZ.C){case 1:return Q=X.entityKey,p=g.Xf(Q).entityId,g.B(pZ,rj(K.C,{mode:"readonly",o$:!0},function($J){var Q3=yR($J,Q,"playbackData"),V3=yR($J,g.h9(p,"offlineVideoPolicy"),"offlineVideoPolicy");$J=yR($J,g.h9(p,"transfer"),"transfer");return g.WN.all([Q3,V3,$J])}),2);
case 2:U=pZ.j;I=g.G(U);d=I.next().value;L=I.next().value;b=I.next().value;S=d;N=L;D=b;if(!S||!N)return pZ.return(dX(X,!0));v=[];R=((a=S)==null?0:a.playerResponseJson)?JSON.parse(S.playerResponseJson):null;if(!(D&&R&&K.V.K("html5_refresh_deprecated_downloads"))){pZ.ZS(3);break}n=oOl(K,R,D);return g.B(pZ,ZTz(K,D),4);case 4:v=pZ.j;case 3:O={lastPlayerResponseTimestampSeconds:S.playerResponseTimestamp,offlineToken:N.offlineToken,formatIds:v};A={};if((w=D)==null?0:w.maximumDownloadQuality)A.maximumDownloadQuality=
D.maximumDownloadQuality;g.PG(pZ,5);u=void 0;return g.B(pZ,gO9(K,X),7);case 7:return u=pZ.j,g.PG(pZ,8),g.B(pZ,rgz(Q,K.V,{refreshData:O,RH:A,offlineSourceData:u,mediaCapabilities:n}),10);case 10:h=pZ.j;g.U7(pZ,9,5);break;case 8:return g.XZ(pZ,5),r=Kn(X)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",mg("PDE handleRefresh error"),pZ.return(dX(X,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",r,"DOWNLOAD_STATE_FAILED"));
case 9:return g.B(pZ,ygm(K,h,X),11);case 11:return pZ.return(dX(X,!0,h.orchestrationActions));case 5:return C=g.XZ(pZ),Y="PDE handleRefresh error",C instanceof Error&&(Y="PDE handleRefresh error: "+C.message),l="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",IS="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",C instanceof g.JQ&&C.type==="QUOTA_EXCEEDED"&&(l="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",IS="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),mg(Y),pZ.return(dX(X,
!1,void 0,l,IS,"DOWNLOAD_STATE_FAILED"))}})},Ytv=function(){this.C={};
this.C[0]=new xv;if(!g.zQ("aes_pes_encoder_killswitch")){var K=this.C;try{var X=g.P_();var Q=BB7(X);var p=new oi(new g.Qh(Q),new g.Fk(Q))}catch(U){throw K=U instanceof Error?new gj("KEY_CREATION_FAILED",{originalMessage:U.message}):new gj("KEY_CREATION_FAILED"),g.Mg(K),K;}K[1]=p}},Tl=function(K){this.C=K},m$n=function(){i5.apply(this,arguments)},eqo=function(){i5.apply(this,arguments)},x$x=function(K,X){return g.PU(K.C.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(X)},function(Q){return g.WN.all([Q.delete(),
qtK(K,Q.cursor.primaryKey)]).then(function(){Ln(K,Q.cursor.primaryKey,X);return g.si(Q)})})},NBe=function(K){var X,Q,p,U,I,d,L,b;
return g.E(function(S){switch(S.C){case 1:return X=g.rk(),Q=lR9(K),p=g.Mr(KMm),g.PG(S,2),I={Sn:!0},g.B(S,g.Os(X,Q,p,void 0,I),4);case 4:U=S.j;g.U7(S,3);break;case 2:d=g.XZ(S);if(d instanceof g.I0)throw L="GetOffline network manager error: "+d.message,mg(L,d),Error(L);mg("GetOffline fetch request error",d);throw Error("GetOffline fetch request error");case 3:b=bL(U);if(!U)throw mg("Network request failed"),Error("Network request failed");if(b!==void 0)SX(b);else if(!U.videos||!U.videos.length)throw mg("No data"),
Error("No data");return S.return(U.videos.map(function(N){return N.offlineVideoData}))}})},Q_o=function(K,X){var Q,p;
return g.E(function(U){switch(U.C){case 1:return Q=Kn(X),g.PG(U,2),p=g.Xf(X.entityKey).entityId,p==="!*$_ALL_ENTITIES_!*$"?g.B(U,$f(K.C,X,K.J),5):g.B(U,NE(p,K.C,X,K.J),6);case 6:return g.B(U,XLn(K.C,X.entityKey),5);case 5:g.U7(U,3);break;case 2:return g.XZ(U),U.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return U.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Q))}})},i5=function(){Dv.apply(this,arguments)},Ujm=function(K,X){var Q,p,U,I,d,L,b,S,N,D,v,n,a;
return g.E(function(R){switch(R.C){case 1:return Q=Kn(X),p=g.Xf(X.entityKey),U=p.entityId,I=g.P(X.actionMetadata,va),L=!((d=I)==null?0:d.playlistId),g.PG(R,2),g.B(R,vOj(K,U,void 0,(b=I)==null?void 0:b.offlineVideoData,L),4);case 4:g.U7(R,3);break;case 2:return S=g.XZ(R),N="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",D="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",S instanceof g.JQ&&S.type==="QUOTA_EXCEEDED"&&(N="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",D="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
R.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,N,D));case 3:v=1;v=Number(((n=X.actionMetadata)==null?void 0:n.priority)||0)+1;var O=(O=g.P(X.actionMetadata,va))?{playbackDataActionMetadata:{maximumDownloadQuality:O.maximumDownloadQuality}}:void 0;a=nn("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",U,"playbackData",v,pL2,O);return R.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q,[a]))}})},I82=function(){i5.apply(this,arguments)},djv=function(){i5.apply(this,arguments)},
StJ=function(K){var X;
return g.E(function(Q){if(Q.C==1)return g.B(Q,g.UXh(K),2);X=Q.j;return Q.return(X.filter(function(p){return!!p.url}).map(function(p){return p.url}))})},bD9=function(K){var X,Q,p,U,I,d,L,b,S,N,D,v,n,a,R,O,A;
return g.E(function(w){switch(w.C){case 1:if(K.T)throw Error("Already processing an action");if(K.lq())return w.return();X=K.C.actions.shift();Tqx(K.mq,!X);if(X===void 0)return w.return();X.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&X.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&LMm(K.C,X.actionId);Q="";X.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&X.rootActionId===X.actionId&&(Q=X.actionId);p=[X];K.T=p;if(U=K.HP[X.entityType]){w.ZS(2);break}K.T=
void 0;return g.B(w,bD9(K),3);case 3:return w.return();case 2:I=g.G(p);for(d=I.next();!d.done;d=I.next())L=d.value,SH3(L,2);g.PG(w,4,5);return g.B(w,$jx(U,p.map(function(u){return u.action})),7);
case 7:b=w.j,S=g.G(p),N=S.next();case 8:if(N.done){w.ZS(10);break}D=N.value;v=b.get(D.action);return g.B(w,Nq9(K,D,v),9);case 9:N=S.next();w.ZS(8);break;case 10:LMm(K.C,Q);case 5:g.g5(w);K.T=void 0;g.PL(w,6);break;case 4:return n=g.XZ(w),mg("Orchestration error",n),g.PG(w,12),g.B(w,saC(K,p),14);case 14:g.U7(w,5);break;case 12:a=g.XZ(w);mg("Orchestration retry error",a);R=g.G(p);for(O=R.next();!O.done;O=R.next())A=O.value,A.retryScheduleIndex<3&&Djj(K.C,[A]);w.ZS(5);break;case 6:return g.B(w,bD9(K),
0)}})},aX=function(K){return K.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!K.entityKey},yR=function(K,X,Q){return K.C.objectStore("EntityStore").get(X).then(function(p){if(p){if(Q&&p.entityType!==Q)throw Error("Incorrect entity type");
return v7z(K,p)}})},E3=function(){F9.apply(this,arguments);
this.kT="musicTrack"},Ln=function(K,X,Q){var p=K.J[Q];
p||(p=new Set,K.J[Q]=p);p.add(X)},FMm=function(K,X,Q){X=X===void 0?43200:X;
Q=Q===void 0?!0:Q;var p=p===void 0?!1:p;var U,I;return g.E(function(d){switch(d.C){case 1:if(!K.L.mE())return d.return([]);U=[];g.PG(d,2);return g.B(d,n7n(X,Q,p),4);case 4:U=d.j;g.U7(d,3);break;case 2:g.XZ(d);case 3:return I=a8j(K,U,Q,"musicPlaylist"),d.return(I)}})},wLz=function(K,X){var Q,p,U,I,d,L,b,S,N,D,v,n,a,R,O,A,w,u,h,r,C,Y,l,IS,pZ,$J,Q3;
return g.E(function(V3){switch(V3.C){case 1:return Q=Kn(X),p=[],g.B(V3,Vu.getInstance(),2);case 2:U=V3.j;if(!U){V3.ZS(3);break}return g.B(V3,U.get("sdois"),4);case 4:return I=V3.j,g.B(V3,(L=U)==null?void 0:L.get("lmqf"),5);case 5:d=V3.j;case 3:g.PG(V3,6);if(I===void 0)throw Error("prefStorage or opt-in state is undefined");b=[];if(I){V3.ZS(8);break}return g.B(V3,E79(K.C),9);case 9:b=V3.j,b.reverse();case 8:if(!b.length){V3.ZS(10);break}S=g.G(b);N=S.next();case 11:if(N.done){V3.ZS(10);break}D=N.value;
if(!D){V3.ZS(12);break}v=g.Xf(D).entityId;return g.B(V3,RX(K.C,v),14);case 14:return n=V3.j,n.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.B(V3,Cn(v,K.C,{entityKey:D,actionType:X.actionType},K.J,n),12);case 12:N=S.next();V3.ZS(11);break;case 10:return g.B(V3,V43(I,(a=d)!=null?a:"SD"),16);case 16:return R=V3.j,g.B(V3,R7z(R),17);case 17:O=CBn(R);if(!K.V.K("woffle_enable_main_downloads_library")){V3.ZS(18);break}if(I){V3.ZS(19);break}return g.B(V3,M4n(K.C,g.iG),19);case 19:return g.B(V3,
ODl(K.C,[g.iG]),18);case 18:if((A=O)==null?0:A.length)for(w=g.G(O),u=w.next();!u.done;u=w.next())if(r=h=u.value,C=r.actionType,Y=r.entityKey,l=r.actionMetadata,C&&Y&&l&&!g.P(l,WMx)){C==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(l.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(IS=g.P(h.actionMetadata,va))IS.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",h.actionMetadata=Object.assign({},h.actionMetadata,{mainVideoEntityActionMetadata:IS});p.push(h)}g.U7(V3,
7);break;case 6:return pZ=g.XZ(V3),$J="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Q3="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",pZ instanceof g.JQ&&pZ.type==="QUOTA_EXCEEDED"&&($J="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Q3="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),V3.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,$J,Q3));case 7:return V3.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q,p))}})},s_j=function(){i5.apply(this,
arguments)},z7z=function(K){return rj(K,{mode:"readwrite",
o$:!0},function(X){return x$x(X,"videoPlaybackPositionEntity")})},khn=function(K,X,Q,p){var U,I,d,L,b,S,N,D,v;
return g.E(function(n){return n.C==1?(U=X.playlistId,I=f89(X),d=I.qe,L=I.w_,b=Q?(Number(Q)*1E3).toString():Date.now().toString(),S=X.lastModifiedTimestamp?(Number(X.lastModifiedTimestamp)*1E3).toString():"0",N={id:g.h9(U,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:L,lastModifiedTimestampMillis:S,addedTimestampMillis:b,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},D={id:g.h9(U,"musicPlaylist"),title:X.title,playlistId:U,thumbnailDetails:X.thumbnail,visibility:ARJ(X),trackCount:X.totalVideoCount,
tracks:d,downloadMetadata:N.id},p&&(((v=D)==null?0:v.entityMetadata)?D.entityMetadata.nextAutoRefreshIntervalSeconds=String(p):D&&(D.entityMetadata={nextAutoRefreshIntervalSeconds:String(p)})),g.B(n,rj(K.C,{mode:"readwrite",o$:!0},function(a){var R=ME(a,D,"musicPlaylist");a=ME(a,N,"musicPlaylistDownloadMetadataEntity");return g.WN.all([R,a])}),2)):n.return(D)})},j_z=function(){i5.apply(this,arguments)},Gh3=function(){i5.apply(this,arguments)},usn=function(){var K,X,Q,p,U,I;
return g.E(function(d){switch(d.C){case 1:return g.B(d,O3(),2);case 2:K=d.j;if(!K)return d.return([]);X=Date.now()/1E3;return g.B(d,t0(K,"offlineVideoPolicy"),3);case 3:Q=d.j,p=g.G(Q),U=p.next();case 4:if(U.done){d.ZS(6);break}I=U.value;if(!(I.expirationTimestamp&&Number(I.expirationTimestamp)<X)){d.ZS(5);break}I.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";I.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.B(d,Wa(K,I,"offlineVideoPolicy"),5);
case 5:U=p.next();d.ZS(4);break;case 6:return d.return(Q.map(function(L){return L.key}))}})},h7j=function(){i5.apply(this,arguments)},cRK=function(K,X,Q){try{return K.J(X,Q)}catch(p){HDe(p,yNz)}},JRo=function(){i5.apply(this,arguments)},iDn=function(){i5.apply(this,arguments)},wX=function(K,X,Q,p,U){U=U===void 0?!1:U;
var I,d,L,b,S,N;return g.E(function(D){if(D.C==1)return I=g.h9(K,X),d=g.h9(K,"downloadStatusEntity"),g.B(D,rj(Q,{mode:"readonly",o$:!0},function(v){return g.WN.all([yR(v,I,X),yR(v,d,"downloadStatusEntity")])}),2);
L=D.j;b=L.length?L[0]:void 0;if(!b)return D.ZS(0);S=PBn;if(N=L.length>1?L[1]:void 0){if(N.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!U)return D.return();N.downloadState=p}else N={key:d,downloadState:p};g.$l(b,S,N);return g.B(D,rj(Q,{mode:"readwrite",o$:!0},function(v){return g.WN.all([ME(v,b,X),ME(v,N,"downloadStatusEntity")])}),0)})},o7e=function(K){var X;
K=g.P((X=K.getWatchNextResponse())==null?void 0:X.currentVideoEndpoint,g.tz);if(K==null?0:K.playlistId)var Q=K.playlistId;return Q},ARJ=function(K){switch(K.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},ZDJ=function(K){if(K.includes(":"))throw Error("Invalid user cache name: "+K);
return K+":"+g.P_("CacheStorage get")},rRC=function(K,X,Q,p){var U,I,d,L,b,S,N,D,v,n,a,R,O,A,w,u,h,r,C,Y,l,IS,pZ,$J,Q3,V3,xJ,TK,dv,mS;
return g.E(function(h7){switch(h7.C){case 1:return g.B(h7,O3(),2);case 2:U=h7.j;if(!U)return h7.return([]);I=[];if((d=p)==null?0:d.length){I=p;h7.ZS(3);break}return g.B(h7,t0(U,"mainPlaylistEntity"),4);case 4:I=h7.j;case 3:if(!I.length)return h7.return([]);L=[];b=Date.now()/1E3;S=g.G(I);N=S.next();case 5:if(N.done)return L.length?g.B(h7,g7l(L),10):h7.return([]);D=N.value;if(!D.downloadState){v=void 0;h7.ZS(8);break}return g.B(h7,l5(U,D.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:v=
h7.j;case 8:n=v;a=void 0;O=(R=(a=D)==null?void 0:a.entityMetadata)&&R.nextAutoRefreshIntervalSeconds?Number(R.nextAutoRefreshIntervalSeconds):NaN;A=Number.isNaN(O)?K:O;u=w=void 0;h=((w=n)==null?0:w.lastSyncedTimestampMillis)?Number((u=n)==null?void 0:u.lastSyncedTimestampMillis)/1E3:0;C=r=void 0;Y=((r=n)==null?0:r.addedTimestampMillis)?Number((C=n)==null?void 0:C.addedTimestampMillis)/1E3:0;if(Q||!R||h+A<=b){l=[];IS=void 0;if((IS=D.videos)==null?0:IS.length)for(pZ=g.G(D.videos),$J=pZ.next();!$J.done;$J=
pZ.next())Q3=$J.value,V3=JSON.parse(g.Xf(Q3).entityId),V3.videoId&&l.push(V3.videoId);xJ="0";R&&(TK=void 0,xJ=String(Number((TK=R.offlineLastModifiedTimestampSeconds)!=null?TK:0).toFixed()));dv={playlistId:D.playlistId,videoIds:l,offlineLastModifiedTimestamp:xJ,autoSync:X,offlineDateAddedTimestamp:String(Y.toFixed())};L.push(dv)}N=S.next();h7.ZS(5);break;case 10:return mS=h7.j,h7.return(mS)}})},yRo=function(K,X,Q){this.C=K;
this.V=X;this.J=Q},t4J=function(){i5.apply(this,arguments)},Bqv=function(){i5.apply(this,arguments)},s3=function(K,X){K.api.BP("onOfflineOperationFailure",X);
var Q;(Q=K.C)==null||Q.postMessage(X)},YH3=function(K,X,Q){this.C=K;
this.V=X;this.J=Q},mj7=function(){return g.E(function(K){if(zl!==void 0)return K.return(zl);
zl=new Promise(function(X){var Q;return g.E(function(p){switch(p.C){case 1:return g.PG(p,2),g.B(p,fn.open("test-only"),4);case 4:return g.B(p,fn.delete("test-only"),5);case 5:g.U7(p,3);break;case 2:if(Q=g.XZ(p),Q instanceof Error&&Q.name==="SecurityError")return X(!1),p.return();case 3:X("caches"in window),g.mk(p)}})});
return K.return(zl)})},e7K=function(){i5.apply(this,arguments)},qHo=function(){i5.apply(this,arguments)},xj2=function(K,X,Q){var p,U,I,d,L,b,S,N,D,v,n,a,R,O;
return g.E(function(A){if(A.C==1){p=X.additionalMetadadatas;U=void 0;if(p&&p.length>0)for(I=g.G(p),d=I.next();!d.done;d=I.next())if(L=d.value,L.offlineMusicPlaylistData){U=L.offlineMusicPlaylistData;break}b=X.playlistId;S=f89(X);N=S.qe;D=S.w_;v=Q?(Number(Q)*1E3).toString():Date.now().toString();n=X.lastModifiedTimestamp?(Number(X.lastModifiedTimestamp)*1E3).toString():"0";a={id:g.h9(b,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:D,lastModifiedTimestampMillis:n,addedTimestampMillis:v,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};R={id:g.h9(b,"musicAlbumRelease"),title:X.title,audioPlaylistId:b,trackCount:X.totalVideoCount,tracks:N,downloadMetadata:a.id};U&&(R.thumbnailDetails=(O=U.albumHqThumbnail)!=null?O:U.albumArtistThumbnail,R.artistDisplayName=U.albumArtistDisplayName,R.releaseDate=U.albumReleaseDate,R.contentRating={explicitType:U.albumReleaseExplicitType},R.releaseType=U.albumReleaseType);return g.B(A,rj(K.C,{mode:"readwrite",o$:!0},function(w){var u=ME(w,R,"musicAlbumRelease");
w=ME(w,a,"musicAlbumReleaseDownloadMetadataEntity");return g.WN.all([u,w])}),2)}return A.return(R)})},IRo=function(K,X,Q,p){p={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!p};X&&Q&&(X=Math.floor(X/1024).toFixed(),Q=Math.floor(Q/1024).toFixed(),p.alreadyDownloadedKbytes=X,p.totalFetchedKbytes=X,p.totalContentKbytes=Q);Yv(p,K)},QUx=function(K,X){var Q,p,U,I,d,L,b,S,N,D,v,n,a,R,O,A,w;
return g.E(function(u){switch(u.C){case 1:return Q=Kn(X),p=g.Xf(X.entityKey),U=p.entityId,I=[],g.PG(u,2),g.B(u,l87(K,U),4);case 4:I=u.j;if(!(K.V.K("woffle_enable_main_downloads_library")&&((d=I)==null?0:d.length))){u.ZS(5);break}return g.B(u,ODl(K.C,[X.entityKey]),5);case 5:g.U7(u,3);break;case 2:return L=g.XZ(u),b="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",S="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",L instanceof g.JQ&&L.type==="QUOTA_EXCEEDED"?(b="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
S="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):mg("Playlist add error"),u.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,b,S));case 3:N=[];if(!K.V.K("html5_offline_prevent_redownload_downloaded_video")){u.ZS(7);break}return g.B(u,K6e(K.C,"mainVideoEntity",I),8);case 8:I=u.j;case 7:if((D=I)==null?0:D.length)for(v=g.G(I),n=v.next();!n.done;n=v.next())if(a=n.value,R=a.offlineVideoData,O=void 0,(O=R)==null?0:O.videoId)A=void 0,w=Number(((A=X.actionMetadata)==null?void 0:A.priority)||
0)+1,N.push(nn("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",R.videoId,"mainVideoEntity",w,AV,Xbe(X,R,U)));return u.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q,N))}})},pbJ=function(K){var X,Q,p;
return g.E(function(U){if(U.C==1)return X=IDBKeyRange.bound(K+"|",K+"~"),g.B(U,g.Wx(),2);if(U.C!=3){Q=U.j;if(!Q)throw g.Wm("gactfv");return g.B(U,g.Nl(Q),3)}p=U.j;return U.return(p.getAll("captions",X))})},UDj=function(K,X,Q){var p,U,I,d,L,b,S,N,D,v,n,a,R,O,A,w,u,h,r,C,Y,l,IS;
return g.E(function(pZ){p=[];U=new Set;if(Q.length)for(I=g.G(Q),d=I.next();!d.done;d=I.next())if(L=d.value,b=void 0,(b=L.downloads)==null?0:b.length)for(S=g.G(L.downloads),N=S.next();!N.done;N=S.next())D=N.value,D.videoItem&&(v=g.Xf(D.videoItem).entityId,U.add(v));if(K.videos){n=g.G(K.videos);for(a=n.next();!a.done;a=n.next())R=a.value,O=JSON.parse(g.Xf(R).entityId),O.videoId&&!U.has(O.videoId)&&p.push(O.videoId);A=g.G(X);for(w=A.next();!w.done;w=A.next())if(u=w.value,u.key!==K.key&&(h=u.videos))for(r=
g.G(h),C=r.next();!C.done;C=r.next())Y=C.value,l=JSON.parse(g.Xf(Y).entityId),l.videoId&&(IS=p.indexOf(l.videoId),IS!==-1&&p.splice(IS,1))}return pZ.return(p)})},IHC=function(K,X){X=X===void 0?0:X;
K=K.C[X];if(!K)throw X=new gj("INVALID_ENCODER_VERSION",{rj:X}),g.Mg(X),X;return K},TOm=function(K,X){var Q,p,U,I,d,L,b,S,N,D,v,n,a,R,O,A,w,u,h,r,C,Y,l,IS,pZ,$J,Q3,V3,xJ,TK,dv,mS,h7,pY,GK,Hx,U6,mn,LZ,kj,W,KZ,wf,$W,xW,Dq,qS,K7,kW,f,M,z,H,m,TQ,q,t,J,kJ;
return g.E(function(jQ){switch(jQ.C){case 1:return Q=Kn(X),p=X.entityKey,U=g.Xf(p).entityId,I=[],d=!1,U==="!*$_ALL_ENTITIES_!*$"?(d=!0,g.B(jQ,t0(K.C,"musicAlbumRelease"),5)):g.B(jQ,l5(K.C,p,"musicAlbumRelease"),4);case 4:(L=jQ.j)&&I.push(L);jQ.ZS(3);break;case 5:I=jQ.j;case 3:if((b=I)==null||!b.length)return jQ.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q));if(d){S=[];N=g.G(I);for(D=N.next();!D.done;D=N.next())v=D.value,n=g.Xf(v.id).entityId,S.push(nn("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
n,"musicAlbumRelease",0,kf));return jQ.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q,S))}a=[];R=I[0];O=void 0;if(!R.downloadMetadata){jQ.ZS(6);break}return g.B(jQ,l5(K.C,R.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:A=jQ.j,O=Number((u=(w=A)==null?void 0:w.addedTimestampMillis)!=null?u:"0")/1E3;case 6:return g.PG(jQ,8),g.B(jQ,dDK(K,U,(h=O)==null?void 0:h.toString()),10);case 10:a=jQ.j;g.U7(jQ,9);break;case 8:r=g.XZ(jQ);if(!(r instanceof Error&&r.message===
"No data")){if(r instanceof Error&&r.message==="Empty response body")mg(r.message);else return C="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",r instanceof g.JQ&&r.type==="QUOTA_EXCEEDED"&&(C="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),jQ.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,C,Y));jQ.ZS(9);break}return g.B(jQ,jX(U,"musicAlbumRelease",K.C,
X,K.J),9);case 9:l=[];IS=new Map;if((pZ=a)==null?0:pZ.length)for($J=g.G(a),Q3=$J.next();!Q3.done;Q3=$J.next())V3=Q3.value,xJ=V3.offlineVideoData,TK=void 0,((TK=xJ)==null?0:TK.videoId)&&IS.set(xJ.videoId,xJ);dv=new Map;mS=[];if((h7=R)==null?0:(pY=h7.tracks)==null?0:pY.length)for(GK=g.G(R.tracks),Hx=GK.next();!Hx.done;Hx=GK.next())if(U6=Hx.value,mn=g.Xf(U6).entityId)IS.has(mn)?(dv.set(mn,IS.get(mn)),IS.delete(mn)):mS.push(mn);kj=Number(((LZ=X.actionMetadata)==null?void 0:LZ.priority)||0)+1;W=g.G(IS.entries());
for(KZ=W.next();!KZ.done;KZ=W.next())wf=KZ.value,$W=g.G(wf),xW=$W.next().value,Dq=$W.next().value,qS=xW,K7=Dq,l.push(nn("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",qS,"musicTrack",kj,kf,Gl(X,K7)));kW=g.G(dv.entries());for(f=kW.next();!f.done;f=kW.next())M=f.value,z=g.G(M),H=z.next().value,m=z.next().value,TQ=H,q=m,l.push(nn("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",TQ,"musicTrack",kj,kf,Gl(X,q)));t=g.G(mS);for(J=t.next();!J.done;J=t.next())kJ=J.value,l.push(nn("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
kJ,"musicTrack",0,kf));return jQ.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q,l))}})},t0=function(K,X,Q){return rj(K,{mode:"readonly",
o$:!0},function(p){return uL(p,X,Q)})},L6J=function(K){var X,Q;
return g.E(function(p){if(p.C==1)return g.B(p,g.Wx(),2);if(p.C!=3)return(X=p.j)?g.B(p,g.Nl(X),3):p.return();Q=p.j;return p.return(g.iE(Q,["index","media","captions"],{mode:"readwrite",o$:!0},function(U){var I=IDBKeyRange.bound(K+"|",K+"~");U=[U.objectStore("index").delete(I),U.objectStore("media").delete(I),U.objectStore("captions").delete(I)];return g.WN.all(U).then(function(){})}))})},bbx=function(){i5.apply(this,arguments)},qtK=function(K,X){return K.C.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(X))},
Syv=function(){i5.apply(this,arguments)},$Do=function(K,X){this.C=K;
this.J=X},Ha=function(K,X,Q,p){var U;
return g.E(function(I){if(I.C==1){if(!K.C)return hV(K,"saveTransferState: "+X),I.return();K.C.transferState=X;K.C.failureReason=p;g.PG(I,2);return g.B(I,U$z(K,function(d){return Q?uL(d,"offlineVideoStreams",K.C.offlineVideoStreams).then(function(L){for(var b=g.G(L),S=b.next();!S.done;S=b.next())if((S=S.value)&&S.streamsProgress){S=g.G(S.streamsProgress);for(var N=S.next();!N.done;N=S.next())N.value.streamState=Q}return NOj(d,L.filter(function(D){return!!D}),"offlineVideoStreams")}):g.WN.resolve(void 0)}),
4)}if(I.C!=2)return g.U7(I,0);
U=g.XZ(I);return U instanceof g.JQ&&U.type==="QUOTA_EXCEEDED"?g.B(I,K.PQ("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):I.ZS(0)})},DDx=function(){i5.apply(this,arguments)},lR9=function(K){return{context:g.S$(),
videoIds:K}},aHz=function(K){var X;
return g.E(function(Q){return Q.C==1?g.B(Q,O3(),2):(X=Q.j)?g.B(Q,rj(X,"readwrite",function(p){for(var U={},I=g.G(K),d=I.next(),L={};!d.done;L={G1:void 0,OM:void 0},d=I.next())L.G1=d.value,L.G1.entityKey&&vwJ(L.G1)&&(L.OM=g.V1(L.G1.payload),d=void 0,L.G1.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(d=function(b){return function(){return ME(p,b.G1.payload[b.OM],b.OM)}}(L)),L.G1.type==="ENTITY_MUTATION_TYPE_DELETE"&&(d=function(b){return function(){return ca(p,b.G1.entityKey)}}(L)),L.G1.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(d=function(b){return function(){return nwv(p,b.G1.entityKey,b.G1.payload[b.OM],b.OM)}}(L)),d&&(U[L.G1.entityKey]=U[L.G1.entityKey]?U[L.G1.entityKey].then(d):d()));
return g.WN.all(Object.values(U))}),0):Q.return()})},F6e=function(K){return new gj("WRONG_DATA_TYPE",{rj:K})},O3=function(){EwK||(EwK=VLJ());
return EwK},Rte=function(){i5.apply(this,arguments)},CXe=function(){i5.apply(this,arguments)},ME=function(K,X,Q){var p=MLK(X),U=IHC(K.j,1),I=Object.assign({},X);
return K.C.objectStore("EntityStore").get(p).then(function(d){if(d){if(d.entityType!==Q)throw Error("Incorrect entity type");I.entityMetadata||(d=v7z(K,d),I.entityMetadata=d.entityMetadata)}}).then(function(){var d={key:p,
entityType:Q,data:cRK(U,I,p),version:1};return g.WN.all([g.L4(K.C.objectStore("EntityStore"),d),Obo(K,I,Q)])}).then(function(){Ln(K,p,Q);
return p})},ca=function(K,X,Q){if(Q==null?0:Q.Ts){var p=new Set;
return W67(K,X,p).then(function(){for(var I=[],d=g.G(p),L=d.next();!L.done;L=d.next())I.push(ca(K,L.value));return g.WN.all(I).then(function(){})})}var U=g.Xf(X).entityType;
return g.WN.all([K.C.objectStore("EntityStore").delete(X),qtK(K,X)]).then(function(){Ln(K,X,U)})},JV=function(K,X){g.y.call(this);
this.token=K;this.C=X;this.observers=[];K=new g.RW.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.P_());K.onmessage=this.j.bind(this);this.channel=K},fHK=function(K,X){var Q,p,U,I,d,L,b,S,N,D,v,n,a,R,O;
return g.E(function(A){switch(A.C){case 1:return Q=Kn(X),p=g.Xf(X.entityKey),U=p.entityId,g.B(A,l5(K.C,X.entityKey,"musicTrack"),2);case 2:I=A.j;if(!I){d=void 0;A.ZS(3);break}return g.B(A,l5(K.C,I.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:d=A.j;case 3:L=d;if(!I||!L)return A.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q));S=g.P(X.actionMetadata,wbn);g.PG(A,5);return g.B(A,sUn(K,U,L.addedTimestampMillis,(N=S)==null?void 0:N.track,(D=S)==null?void 0:D.albumRelease),
7);case 7:n=Number(((v=X.actionMetadata)==null?void 0:v.priority)||0)+1;b=nn("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",U,"playbackData",n,ztl);g.U7(A,6);break;case 5:a=g.XZ(A);if(!(a instanceof Error&&a.message==="No data")){if(a instanceof Error&&a.message==="Empty response body")mg(a.message);else return R="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",O="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",a instanceof g.JQ&&a.type==="QUOTA_EXCEEDED"&&(R="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
O="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),A.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,R,O));A.ZS(6);break}return g.B(A,NE(U,K.C,X,K.J),6);case 6:return A.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q,b?[b]:void 0))}})},Pa=function(K,X,Q,p,U){var I,d,L;
return g.E(function(b){if(b.C==1)return g.B(b,O3(),2);I=b.j;if(!I)return b.return([]);d=X.map(function(S){var N=g.h9(S,Q);N={actionType:p,entityKey:N,actionMetadata:Object.assign({},AWe(),U)};p!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(N.actionMetadata.priority=0);S=new iL(Q,S,N);return pn(S)});
L=kEC(I,d);jUz(K.J);return b.return(L)})},F9=function(K,X){var Q=this;
this.V=K;this.api=X;this.L=new g.zO;this.S=new g.ob;this.I$={GO:function(){return Q.J.I$.GO()},
EY:function(){return Q.L},
ccP:function(){return Q.J},
aQ:function(){return Q.aQ()},
UW:function(){return Q.UW()},
I6:function(){return Q.I6()},
a6:function(){return Q.a6()},
qt:function(){return Q.qt()},
gr:function(p){return Q.gr(p)}};
this.J=new GEj(function(){return uTC(Q)},function(){Q.I6()},this.api.nE(),this.api.K.bind(this.api));
this.C=new oX(this.api);jUz(this.J)},htC=function(){i5.apply(this,arguments)},Hbn=function(K){return K instanceof Error?new gj("UNKNOWN_DECODE_ERROR",{originalMessage:K.message}):new gj("UNKNOWN_DECODE_ERROR")},JW3=function(K,X){var Q,p,U;
return g.E(function(I){switch(I.C){case 1:Q=Kn(X);g.PG(I,2);p=g.Xf(X.entityKey).entityId;if(p==="!*$_ALL_ENTITIES_!*$")return g.B(I,z7z(K.C),5);U=g.h9(p,"videoPlaybackPositionEntity");return g.B(I,cW2(K.C,U),5);case 5:g.U7(I,3);break;case 2:return g.XZ(I),I.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return I.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Q))}})},ibz=function(K){Yv({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},K)},PXm=function(K){return K.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!K.entityKey},ow2=function(K){Yv({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},K)},Zbe=function(){i5.apply(this,arguments)},gwz=function(){i5.apply(this,arguments)},ZTz=function(K,X){var Q,p,U,I,d,L,b,S,N,D,v;
return g.E(function(n){if(n.C==1)return Q=[],g.B(n,rj(K.C,{mode:"readonly",o$:!0},function(a){var R=[],O=X.offlineVideoStreams;if(O){O=g.G(O);for(var A=O.next();!A.done;A=O.next())R.push(yR(a,A.value,"offlineVideoStreams"))}return g.WN.all(R)}),2);
if(p=n.j)for(U=g.G(p),I=U.next();!I.done;I=U.next())if(d=I.value,L=void 0,(L=d)==null?0:L.streamsProgress)for(b=d.streamsProgress,S=0;S<b.length;S++)N=b[S],D=JSON.parse(N.formatStreamBytes),v={itag:D.itag,lmt:D.lastModified,xtags:D.xtags},Q.push(v);return n.return(Q)})},rWn=function(K){return g.Yr((0,g.eJe)(),K)},yWJ=function(){i5.apply(this,arguments)},Kn=function(K){var X,Q,p;
return((p=(X=K.actionMetadata)==null?void 0:(Q=X.retryScheduleIntervalsInSeconds)==null?void 0:Q.length)!=null?p:0)>0},tLl=function(){i5.apply(this,arguments)},BOv=function(){i5.apply(this,arguments)},Yy3=function(K){switch(K){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
VLJ=function(){var K,X,Q;
return g.E(function(p){if(p.C==1)return g.PG(p,2),g.B(p,g.Wx(),4);if(p.C!=2){K=p.j;if(!K||!g.c_()||typeof g.RW.BroadcastChannel==="undefined")return p.return();X=new Ytv;return p.return(new JV(K,X))}Q=g.XZ(p);Q instanceof Error&&g.Mg(Q);return p.return()})},mDe=function(K,X){this.C=K;
this.j=X;this.J={}},etj=function(){i5.apply(this,arguments)},qy2=function(K,X){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:K},metadata:X,statusCode:void 0,csn:void 0,can:void 0}},xDx=function(K){return{context:g.S$(),
playlistIds:K}},dX=function(K,X,Q,p,U,I){return new X9(X?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Kn(K),Q,p,U,I)},XGz=function(K){var X;
return g.E(function(Q){if(Q.C==1){X=K.mutations;if(!X||X.length<=0)return Q.return();if(g.iP){var p={type:"ENTITY_LOADED"};X!==void 0&&(p.payload=X);g.iP.dispatch(p)}return g.B(Q,aHz(X),2)}X.length=0;g.mk(Q)})},Q6n=function(K){var X;
return g.E(function(Q){if(Q.C==1)return g.B(Q,pbJ(K),2);X=Q.j;return Q.return(!!X&&X.length>0)})},pGo=function(){i5.apply(this,arguments)},Ugj=function(){this.actions=[]},ISj=function(K,X){var Q=[];
if(K.thumbnailStyleData){K=g.G(K.thumbnailStyleData);for(var p=K.next();!p.done;p=K.next()){var U=void 0,I=void 0,d=void 0;Q=Q.concat(eY((U=p.value)==null?void 0:(I=U.value)==null?void 0:(d=I.collageThumbnail)==null?void 0:d.coverThumbnail))}}X=eY(X);return Q.concat(X)},NOj=function(K,X,Q){X=X.map(function(p){return ME(K,p,Q)});
return g.WN.all(X)},dgm=function(){},T52=function(){i5.apply(this,arguments)},bTm=function(K,X){var Q,p,U;
return g.E(function(I){switch(I.C){case 1:return g.PG(I,2),(Q=!!X.captionTracks.length||!!X.Ka)?g.B(I,Q6n(X.videoId),4):I.return();case 4:return(p=I.j)?I.return():g.B(I,LBz(K.GK,X),5);case 5:g.U7(I,0);break;case 2:U=g.XZ(I),mg("Caption downloading error",U,X.cotn),g.mk(I)}})},bA9=function(){Dv.apply(this,arguments)},$g9=function(K,X){var Q,p,U,I,d,L,b,S;
return g.E(function(N){switch(N.C){case 1:return Q=g.rk(),p={context:g.S$(),videoPlaybackPositionEntities:K,lastSyncTimestampUsec:X},U=g.Mr(S0m),g.PG(N,2),d={Sn:!0},g.B(N,g.Os(Q,p,U,void 0,d),4);case 4:I=N.j;g.U7(N,3);break;case 2:L=g.XZ(N);if(L instanceof g.I0)throw b="VPPS network manager error: "+L.message,mg(b,L),Error(b);mg("VPPS fetch request error",L);throw Error("VPPS fetch request error");case 3:S=bL(I);if(I)S!==void 0&&SX(S,"position sync");else throw mg("Network request failed for position sync"),
Error("Network request failed for position sync");return N.return(I)}})},N59=function(K){var X,Q,p,U,I,d,L,b,S,N,D,v,n,a,R,O,A,w,u,h,r,C,Y,l,IS,pZ,$J,Q3,V3,xJ,TK,dv,mS,h7,pY,GK,Hx,U6,mn,LZ;
return g.E(function(kj){if(kj.C==1)return g.B(kj,rj(K,{mode:"readonly",o$:!0},function(W){return uL(W,"playbackData").then(function(KZ){var wf=KZ.map(function(qS){return qS.transfer}).filter(function(qS){return!!qS}),$W=KZ.map(function(qS){return qS.offlineVideoPolicy}).filter(function(qS){return!!qS}),xW=KZ.filter(function(qS){return!!qS.key}).map(function(qS){return g.h9(g.Xf(qS.key).entityId,"downloadStatusEntity")});
wf=uL(W,"transfer",wf);$W=uL(W,"offlineVideoPolicy",$W);xW=uL(W,"downloadStatusEntity",xW);var Dq=wf.then(function(qS){qS=qS.reduce(function(K7,kW){(kW==null?0:kW.offlineVideoStreams)&&K7.push.apply(K7,g.gf(kW.offlineVideoStreams));return K7},[]).filter(function(K7){return!!K7});
return uL(W,"offlineVideoStreams",qS)});
return g.WN.all([wf,$W,Dq,xW]).then(function(qS){var K7=g.G(qS);qS=K7.next().value;var kW=K7.next().value;var f=K7.next().value;K7=K7.next().value;return[KZ,qS,kW,f,K7]})})}),2);
if(kj.C!=3)return X=kj.j,g.B(kj,rj(K,{mode:"readonly",o$:!0},function(W){return uL(W,"mainDownloadsListEntity").then(function(KZ){var wf,$W;return($W=(wf=KZ[0])==null?void 0:wf.downloads)!=null?$W:[]})}),3);
Q=kj.j;p=g.G(X);U=p.next().value;I=p.next().value;d=p.next().value;L=p.next().value;b=p.next().value;S=U;N=I;D=d;v=L;n=b;a={};R={};O={};A={};w={};u=[];h=g.G(N);for(r=h.next();!r.done;r=h.next())(C=r.value)&&(a[C.key]=C);Y=g.G(D);for(l=Y.next();!l.done;l=Y.next())(IS=l.value)&&(R[IS.key]=IS);pZ=g.G(n);for($J=pZ.next();!$J.done;$J=pZ.next())(Q3=$J.value)&&(O[Q3.key]=Q3);V3=g.G(v);for(xJ=V3.next();!xJ.done;xJ=V3.next())(TK=xJ.value)&&(A[TK.key]=TK);dv=g.G(Q);for(mS=dv.next();!mS.done;mS=dv.next())h7=
mS.value,pY=void 0,w[(pY=h7.videoItem)!=null?pY:""]=!0,h7.videoItem&&(Hx=GK=void 0,U6=(Hx=(GK=g.Xf(h7.videoItem))==null?void 0:GK.entityId)!=null?Hx:"",u.push({externalVideoId:U6}));mn=S.filter(function(W){if(!W||!W.key||!W.offlineVideoPolicy)return!1;W=g.Xf(W.key).entityId;W=g.h9(W,"downloadStatusEntity");var KZ;return!(W&&((KZ=O[W])==null?void 0:KZ.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
LZ=mn.map(function(W){var KZ=a[W.transfer],wf=[];if(KZ==null?0:KZ.offlineVideoStreams)for(var $W=g.G(KZ.offlineVideoStreams),xW=$W.next();!xW.done;xW=$W.next())(xW=A[xW.value])&&wf.push(xW);$W=R[W.offlineVideoPolicy];xW=w;var Dq=W==null?void 0:W.playerResponseTimestamp,qS=g.Xf($W.key).entityId;W=g.h9(qS,"mainVideoEntity");if($W.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var K7="OFFLINE_VIDEO_STATE_DISABLED";$W.expirationTimestamp&&Number($W.expirationTimestamp)<Date.now()/1E3&&(K7="OFFLINE_VIDEO_STATE_EXPIRED")}else if($W.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")K7="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(KZ==null?void 0:KZ.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":K7="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":K7="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":K7="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":K7="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":K7="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":K7="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:K7="OFFLINE_VIDEO_STATE_UNKNOWN"}if(K7==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(KZ==null?void 0:KZ.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":K7="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":K7="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":K7=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}qS={id:qS,videoState:K7};if(KZ==null?0:KZ.cotn)qS.cotn=KZ.cotn;if(KZ==null?0:KZ.maximumDownloadQuality)qS.selectedVideoQuality=KZ==null?void 0:KZ.maximumDownloadQuality;if(KZ==null?0:KZ.lastProgressTimeMs)qS.lastProgressTimeMs=KZ.lastProgressTimeMs;Dq&&(qS.playerResponseSavedTimeMs=String(Number(Dq)*1E3));KZ=String;Dq=0;wf=g.G(wf);for(K7=wf.next();!K7.done;K7=wf.next())if(K7=K7.value,K7.streamsProgress){K7=g.G(K7.streamsProgress);for(var kW=K7.next();!kW.done;kW=
K7.next()){var f=void 0;Dq+=Number((f=kW.value.numBytesDownloaded)!=null?f:0)}}qS.downloadedBytes=KZ(Dq);qS.selectedOfflineMode=xW[W]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";$W.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(qS.offlinePlaybackDisabledReason=$W.offlinePlaybackDisabledReason);return qS});
return kj.return({offlineVideos:LZ,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:u}}})})},Dg9=function(K,X){this.C=K;
this.V=X},Zv=function(K){var X,Q;
return g.E(function(p){if(p.C==1)return g.B(p,V2l(),2);if(p.C!=3){X=p.j;if(!X)throw Error("Cache API not supported");return K.length?g.B(p,X.open("yt-player-local-img"),3):p.return()}Q=p.j;return g.B(p,Promise.all(K.map(function(U){return Q.delete(U)})),0)})},Gl=function(K,X,Q){X={track:v6n(X)};
Q&&(X.playlistId=Q);if(K=g.P(K.actionMetadata,n6e))X.maximumDownloadQuality=K.maximumDownloadQuality;return{musicTrackEntityActionMetadata:X}},Nq9=function(K,X,Q){var p,U,I,d,L,b,S,N,D,v,n,a;
return g.E(function(R){switch(R.C){case 1:p=X.retryScheduleIndex+2===3;if(Q.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){R.ZS(2);break}if(Q.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){R.ZS(0);break}aSJ(X,Q,p);if(Q.C&&X.retryScheduleIndex+1<3)return g.B(R,saC(K,[X]),0);I=((U=Q)==null?0:U.j)?Q.j:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";d={entityKey:X.action.entityKey,failureReason:I};L=void 0;g.XJ(K.V)?L="mainVideoDownloadStateEntity":g.oM(K.V)&&(L="musicTrackDownloadMetadataEntity");
if(!L||!Q.downloadState){R.ZS(7);break}b=g.Xf(X.action.entityKey).entityId;return g.B(R,wX(b,L,K.j,Q.downloadState),7);case 7:s3(K.N,d);if(Q.downloadState==="DOWNLOAD_STATE_FAILED"&&K.V.K("html5_auto_retry_failed_pde_actions")){R.ZS(0);break}mg("Orchestration result is not retryable, deleting action");return g.B(R,cW2(K.j,pn(X).key),0);case 2:S=void 0;try{S=(N=Q.T)==null?void 0:N.map(function(O){return K.createAction(O,X)})}catch(O){return aSJ(X,Q,p),D={entityKey:X.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},s3(K.N,D),mg("Orchestration subactions creation error",O),R.return()}aSJ(X,Q,p,S);if(!S){R.ZS(12);break}v=S.map(function(O){return pn(O)});
n=0;case 13:if(!(n<S.length)||K.S){R.ZS(15);break}return g.B(R,rj(K.j,{mode:"readwrite",o$:!0},function(O){var A=[];A.push(NOj(O,v.slice(n,n+10),"offlineOrchestrationActionWrapperEntity"));return g.WN.all(A)}),16);
case 16:n+=10;R.ZS(13);break;case 15:if(K.S)return K.S=!1,R.return();case 12:return a=pn(X),g.B(R,cW2(K.j,a.key),17);case 17:SH3(X,4),g.mk(R)}})},FBz=function(K,X){var Q,p,U,I,d;
return g.E(function(L){if(L.C==1)return Q=g.h9(X,"offlineVideoStreams"),g.B(L,l5(K,Q,"offlineVideoStreams"),2);p=L.j;if(!p||!p.streamsProgress)return L.return();U=g.G(p.streamsProgress);for(I=U.next();!I.done;I=U.next())d=I.value,d.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",d.numTotalBytes!==d.numBytesDownloaded&&(d.numBytesDownloaded=d.numTotalBytes);return g.B(L,Wa(K,p,"offlineVideoStreams"),0)})},BB7=function(K){K=(new TextEncoder).encode(K).subarray(0,16);
var X=new Uint8Array(16);X.set(K);return X},E6C=function(){i5.apply(this,arguments)},VR2=function(K){this.cP=K;
this.C=void 0},MR7=function(K,X,Q,p){var U,I,d,L,b,S,N,D,v;
return g.E(function(n){if(n.C==1)return U=g.h9("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),I=new Map,g.B(n,rj(K,{mode:"readwrite",o$:!0},function(a){var R=uL(a,"transfer"),O=uL(a,"offlineOrchestrationActionWrapperEntity"),A=uL(a,"videoDownloadContextEntity"),w=yR(a,U,"mainDownloadsListEntity");return g.WN.all([R,O,A,w]).then(function(u){u=g.G(u);var h=u.next().value;var r=u.next().value;var C=u.next().value;var Y=u.next().value;u=RIJ.map(function(IS){return x$x(a,IS)});
r=g.G(r);for(var l=r.next();!l.done;l=r.next())l=l.value,gX(X,l.actionProto)||u.push(ca(a,l.key,{Ts:!0}));Y&&(Y.downloads=[],u.push(ME(a,Y,"mainDownloadsListEntity")));if(C)for(C=g.G(C),Y=C.next();!Y.done;Y=C.next())Y=Y.value,r=g.Xf(Y.key).entityId,r=g.h9(r,"transfer"),I.set(r,Y.offlineModeType);return g.WN.all(u).then(function(){return h})})}),2);
d=n.j;L=g.G(d);for(b=L.next();!b.done;b=L.next())S=b.value,rX(S,I.get(S.key)),N=g.Xf(S.key).entityId,D={videoId:N,offlineDeleteReason:p,cotn:S.cotn,offlineModeType:I.get(S.key)},yu(D),v=g.h9(N,"mainVideoEntity"),s3(Q,{entityKey:v,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.B(n,C$m(),0)})},jX=function(K,X,Q,p,U){var I,d,L,b,S,N,D,v,n,a,R,O,A,w,u,h,r,C,Y,l,IS,pZ,$J,Q3,V3,xJ,TK,dv,mS,h7,pY,GK,Hx,U6,mn,LZ;
return g.E(function(kj){switch(kj.C){case 1:return I=g.h9(K,X),d=g.h9("music_downloads_library_id","musicDownloadsLibraryEntity"),g.B(kj,rj(Q,{mode:"readonly",o$:!0},function(W){return g.WN.all([yR(W,I,X),yR(W,d,"musicDownloadsLibraryEntity"),uL(W,X),uL(W,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:L=kj.j;b=g.G(L);S=b.next().value;N=b.next().value;D=b.next().value;v=b.next().value;n=S;a=N;R=D;O=v;if(!n){kj.ZS(3);break}return g.B(kj,OA2(n,R),4);case 4:return A=kj.j,g.B(kj,Zv(A),3);case 3:w=[];u=new Map;if(!n){kj.ZS(6);break}return g.B(kj,WB2(n,R,a),7);case 7:w=kj.j;h=g.G(w);for(r=h.next();!r.done;r=h.next())C=r.value,Y=g.Xf(C).entityId,u.set(Y,{videoId:Y,playlistId:K,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.B(kj,t0(Q,"transfer"),8);case 8:for(l=kj.j,IS=
g.G(l),pZ=IS.next();!pZ.done;pZ=IS.next())$J=pZ.value,Q3=g.Xf($J.key).entityId,(V3=u.get(Q3))&&$J&&(V3.cotn=$J.cotn);case 6:xJ=[];TK=g.G(O);for(dv=TK.next();!dv.done;dv=TK.next())mS=dv.value,h7=g.Xf(mS.key).entityId,pY=tV(mS),h7!==K&&pY.rootActionId!==K||gX(p,mS.actionProto)||xJ.push(mS.key);GK=g.h9(K,X);return g.B(kj,rj(Q,{mode:"readwrite",o$:!0},function(W){var KZ=xJ.map(function(wf){return ca(W,wf)});
KZ.push(ca(W,GK,{Ts:!0}));return g.WN.all(KZ)}),9);
case 9:if(!n){kj.ZS(0);break}w.reverse();if(!w.length){kj.ZS(0);break}Hx=g.G(w);U6=Hx.next();case 12:if(U6.done){kj.ZS(0);break}mn=U6.value;LZ=g.Xf(mn).entityId;if(!LZ){kj.ZS(13);break}return g.B(kj,NE(LZ,Q,p,U,u.get(LZ)),13);case 13:U6=Hx.next(),kj.ZS(12)}})},wGo=function(){i5.apply(this,arguments)},$jx=function(K,X){var Q,p,U,I,d,L;
return g.E(function(b){switch(b.C){case 1:Q=new Map,p=g.G(X),U=p.next();case 2:if(U.done){b.ZS(4);break}I=U.value;d=Q;L=d.set;return g.B(b,K.j(I),5);case 5:L.call(d,I,b.j);U=p.next();b.ZS(2);break;case 4:return b.return(Q)}})},s6j=function(){i5.apply(this,arguments)},sUn=function(K,X,Q,p,U){var I,d,L,b,S,N;
return g.E(function(D){switch(D.C){case 1:if(I=p){D.ZS(2);break}return g.B(D,NBe([X]),3);case 3:d=D.j,L=d[0],I=v6n(L);case 2:return g.B(D,zI3(K,I,X,U,Q),4);case 4:b=D.j;S=b.musicTrackEntity;N=b.yv;var v=eY(S.thumbnailDetails),n=[];N&&(n=eY(N.thumbnailDetails));return g.B(D,qU(v.concat(n)),0)}})},fSo=function(){i5.apply(this,arguments)},$f=function(K,X,Q){var p,U,I,d,L,b,S;
return g.E(function(N){if(N.C==1)return g.B(N,rj(K,{mode:"readwrite",o$:!0},function(D){var v=uL(D,"transfer"),n=uL(D,"offlineOrchestrationActionWrapperEntity");return g.WN.all([v,n]).then(function(a){a=g.G(a);var R=a.next().value;var O=a.next().value;a=AOJ.map(function(h){return x$x(D,h)});
O=g.G(O);for(var A=O.next();!A.done;A=O.next()){A=A.value;var w=g.Xf(A.actionProto.entityKey).entityType==="musicTrack",u=A.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";gX(X,A.actionProto)||w&&(!w||u)||a.push(ca(D,A.key,{Ts:!0}))}return g.WN.all(a).then(function(){return R})})}),2);
p=N.j;U=g.G(p);for(I=U.next();!I.done;I=U.next())d=I.value,rX(d),L=g.Xf(d.key).entityId,b={videoId:L,offlineDeleteReason:void 0,cotn:d.cotn},yu(b),S=g.h9(L,"musicTrack"),s3(Q,{entityKey:S,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.B(N,C$m(),0)})},Cn=function(K,X,Q,p,U){var I,d,L,b,S,N,D,v,n,a,R,O,A,w,u,h,r,C,Y,l,IS,pZ,$J,Q3,V3,xJ,TK,dv,mS,h7,pY;
return g.E(function(GK){switch(GK.C){case 1:return I=g.h9(K,"mainVideoEntity"),d=g.h9(K,"ytMainChannelEntity"),L=g.h9(K,"transfer"),b=g.h9(K,"videoDownloadContextEntity"),g.B(GK,rj(X,{mode:"readonly",o$:!0},function(Hx){return g.WN.all([yR(Hx,I,"mainVideoEntity"),yR(Hx,d,"ytMainChannelEntity"),yR(Hx,L,"transfer"),yR(Hx,b,"videoDownloadContextEntity"),uL(Hx,"ytMainChannelEntity"),uL(Hx,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:S=GK.j;N=g.G(S);D=N.next().value;v=N.next().value;n=N.next().value;a=N.next().value;R=N.next().value;O=N.next().value;A=D;w=v;u=n;h=a;r=R;C=O;if(!A&&!w){GK.ZS(3);break}Y=A?eY(A.thumbnail):[];if(!w){l=[];GK.ZS(4);break}return g.B(GK,cge(w,r),5);case 5:l=GK.j;case 4:return IS=l,g.B(GK,Zv(Y.concat(IS)),3);case 3:pZ=[];$J=g.h9(K,"downloadStatusEntity");Q3=g.G(C);for(V3=Q3.next();!V3.done;V3=Q3.next())xJ=V3.value,TK=g.Xf(xJ.key).entityId,dv=tV(xJ),mS=g.Xf(dv.action.entityKey).entityId,TK!==K&&mS!==
K||gX(Q,xJ.actionProto)||pZ.push(xJ.key);return g.B(GK,rj(X,{mode:"readwrite",o$:!0},function(Hx){var U6=pZ.map(function(mn){return ca(Hx,mn)});
U6.push(ca(Hx,I,{Ts:!0}));U6.push(ca(Hx,$J,{Ts:!0}));return g.WN.all(U6)}),7);
case 7:pY=(h7=h)==null?void 0:h7.offlineModeType,U&&(yu(U),U.offlineModeType&&(pY=U.offlineModeType)),rX(u,pY),s3(p,{entityKey:I,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.mk(GK)}})},j6l=function(K,X){var Q,p,U,I,d,L,b,S,N,D,v,n,a,R,O,A,w,u,h,r,C,Y,l,IS,pZ,$J,Q3,V3,xJ,TK,dv,mS,h7,pY,GK,Hx,U6,mn,LZ,kj,W,KZ,wf,$W,xW,Dq,qS,K7,kW,f,M,z,H,m,TQ,q,t,J,kJ,jQ,RS,fZ,p7,s7,tY,cF,q3,A7,ev,GQ,Om;
return g.E(function(oS){switch(oS.C){case 1:return Q=Kn(X),p=X.entityKey,U=g.Xf(p).entityId,I=[],d=!1,U==="!*$_ALL_ENTITIES_!*$"?(d=!0,g.B(oS,t0(K.C,"musicPlaylist"),5)):g.B(oS,l5(K.C,p,"musicPlaylist"),4);case 4:(L=oS.j)&&I.push(L);oS.ZS(3);break;case 5:I=oS.j;case 3:if((b=I)==null||!b.length)return oS.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q));S=g.P(X.actionMetadata,n6e);D=(N=S)==null?void 0:N.autoSync;v=[];a=n=!0;R=!1;O=void 0;if(!d&&D===!1){oS.ZS(6);break}g.PG(oS,7);return g.B(oS,
n7n(0,!!D,!0,I),9);case 9:v=oS.j;g.U7(oS,8);break;case 7:A=g.XZ(oS);if(!(A instanceof Error&&A.message==="No data")){A instanceof Error&&A.message==="Empty response body"&&mg(A.message);oS.ZS(8);break}return U==="!*$_ALL_ENTITIES_!*$"?g.B(oS,$f(K.C,X,K.J),8):g.B(oS,jX(U,"musicPlaylist",K.C,X,K.J),8);case 8:if(!v.length||!d&&v[0].playlistId!==U)return oS.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q));case 6:if(d){w=[];u=g.G(v);for(h=u.next();!h.done;h=u.next())r=h.value,r.upToDate||
D&&!r.shouldAutoSyncMetadata||!r.playlistId||(C={autoSync:D},w.push(nn("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",r.playlistId,"musicPlaylist",0,Ba,{musicPlaylistEntityActionMetadata:C})));return oS.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q,w))}v.length&&(Y=v[0],R=!!Y.upToDate,D&&(n=(l=Y.shouldAutoSyncMetadata)!=null?l:!0,a=(IS=Y.shouldAutoSyncVideos)!=null?IS:!0,Y.checkInSeconds&&(O=Y.checkInSeconds)));if(R||!n)return oS.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Q));pZ=[];$J=I[0];Q3=void 0;if(!$J.downloadMetadata){oS.ZS(15);break}return g.B(oS,l5(K.C,$J.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:V3=oS.j,Q3=Number((TK=(xJ=V3)==null?void 0:xJ.addedTimestampMillis)!=null?TK:"0")/1E3;case 15:return g.PG(oS,17),g.B(oS,kCl(K,U,(dv=Q3)==null?void 0:dv.toString(),O),19);case 19:pZ=oS.j;g.U7(oS,18);break;case 17:mS=g.XZ(oS);if(!(mS instanceof Error&&mS.message==="No data")){if(mS instanceof Error&&mS.message==="Empty response body")mg(mS.message);
else return h7="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",pY="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",mS instanceof g.JQ&&mS.type==="QUOTA_EXCEEDED"&&(h7="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",pY="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),oS.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,h7,pY));oS.ZS(18);break}return g.B(oS,jX(U,"musicPlaylist",K.C,X,K.J),18);case 18:if(!a)return oS.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Q));GK=[];Hx=new Map;if((U6=pZ)==null?0:U6.length)for(mn=g.G(pZ),LZ=mn.next();!LZ.done;LZ=mn.next())kj=LZ.value,W=kj.offlineVideoData,KZ=void 0,((KZ=W)==null?0:KZ.videoId)&&Hx.set(W.videoId,W);wf=new Map;$W=[];if((xW=$J)==null?0:(Dq=xW.tracks)==null?0:Dq.length)for(qS=g.G($J.tracks),K7=qS.next();!K7.done;K7=qS.next())if(kW=K7.value,f=g.Xf(kW).entityId)Hx.has(f)?(wf.set(f,Hx.get(f)),Hx.delete(f)):$W.push(f);z=Number(((M=X.actionMetadata)==null?void 0:M.priority)||0)+1;H=g.G(Hx.entries());for(m=H.next();!m.done;m=
H.next())TQ=m.value,q=g.G(TQ),t=q.next().value,J=q.next().value,kJ=t,jQ=J,GK.push(nn("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",kJ,"musicTrack",z,Ba,Gl(X,jQ)));RS=g.G(wf.entries());for(fZ=RS.next();!fZ.done;fZ=RS.next())p7=fZ.value,s7=g.G(p7),tY=s7.next().value,cF=s7.next().value,q3=tY,A7=cF,GK.push(nn("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",q3,"musicTrack",z,Ba,Gl(X,A7)));ev=g.G($W);for(GQ=ev.next();!GQ.done;GQ=ev.next())Om=GQ.value,GK.push(nn("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",Om,"musicTrack",
0,Ba));return oS.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q,GK))}})},gX=function(K,X){return K.actionType===X.actionType&&K.entityKey===X.entityKey},TBl=function(K,X){var Q,p,U,I,d;
return g.E(function(L){if(L.C==1)return Q=g.Xf(X.key),p=Q.entityId,U=g.h9(p,"playbackData"),g.B(L,l5(K.j,U,"playbackData"),2);I=L.j;if((d=I)==null?0:d.playerResponseJson)return L.return(JSON.parse(I.playerResponseJson));throw Error("No PlayerResponse found");})},WB2=function(K,X,Q){var p,U,I,d,L,b,S,N,D,v,n,a,R,O,A,w,u,h;
return g.E(function(r){p=[];U=new Set;if((I=Q)==null?0:(d=I.downloadedTracks)==null?0:d.length)for(L=g.G(Q.downloadedTracks),b=L.next();!b.done;b=L.next())S=b.value,U.add(S);if(K.tracks){N=g.G(K.tracks);for(D=N.next();!D.done;D=N.next())v=D.value,U.has(v)||p.push(v);n=g.G(X);for(a=n.next();!a.done;a=n.next())if(R=a.value,R.id!==K.id&&(O=R.tracks))for(A=g.G(O),w=A.next();!w.done;w=A.next())u=w.value,h=p.indexOf(u),h!==-1&&p.splice(h,1)}return r.return(p)})},GCj=function(){i5.apply(this,arguments)},
uNK=function(){i5.apply(this,arguments)},jUz=function(K){if(!K.J&&!K.C){var X=pnl();
if(X){K.J=!0;var Q=g.P_("OfflineLockManager");X.request("woffle_orchestration_leader:"+Q,{},function(){var p,U;return g.E(function(I){switch(I.C){case 1:return g.PG(I,2),K.j=new g.ob,K.C=!0,K.J=!1,g.B(I,K.W(),4);case 4:return g.B(I,K.j.promise,5);case 5:g.U7(I,0);break;case 2:p=g.XZ(I),K.uM(),p instanceof Error&&(U=p,U.args=[{name:"WoLockManagerError",Bu:p.name}],g.Mg(U)),g.mk(I)}})})}}},l5=function(K,X,Q){return rj(K,{mode:"readonly",
o$:!0},function(p){return yR(p,X,Q)})},hIl=function(K,X){this.C=K;
this.J=X},cOm=function(K,X,Q,p){if(!K.action.entityKey)throw Error("entityKey is missing.");
var U=g.Xf(K.action.entityKey);U={entityType:U.CI,entityId:U.entityId,offlineOrchestrationActionType:K.action.actionType,orchestrationAction:{orchestrationActionId:K.actionId}};X&&(U.offlineOrchestrationActionResult=X.status,U.isRetryable=Q?!1:X.C,X.J&&(U.offlineOrchestrationFailureReason=HA7(X.J,U.isRetryable)));var I,d;if((I=K.action.actionMetadata)==null?0:(d=I.offlineLoggingData)==null?0:d.offlineModeType)U.offlineModeType=K.action.actionMetadata.offlineLoggingData.offlineModeType;p&&(U.additionalOrchestrationActions=
p.map(function(L){return{orchestrationActionId:L.actionId}}));
return U},JOm=function(K,X){K=g.G(K.actions);
for(var Q=K.next();!Q.done;Q=K.next())if(Q.value.actionId===X)return!0;return!1},uL=function(K,X,Q){return Q?(Q=Q.map(function(p){return yR(K,p,X)}),g.WN.all(Q)):K.C.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(X)).then(function(p){return p.map(function(U){return v7z(K,U)})})},iAm=function(K){var X,Q,p,U,I,d,L,b;
return g.E(function(S){switch(S.C){case 1:return X=g.rk(),Q=xDx(K),p=g.Mr(KMm),g.PG(S,2),I={Sn:!0},g.B(S,g.Os(X,Q,p,void 0,I),4);case 4:U=S.j;g.U7(S,3);break;case 2:d=g.XZ(S);if(d instanceof g.I0)throw L="GetOffline network manager error for playlist: "+d.message,mg(L,d),Error(L);mg("GetOffline fetch request error for playlist",d);throw Error("GetOffline fetch request error for playlist");case 3:b=bL(U);if(!U)throw mg("Network request failed for playlist"),Error("Network request failed for playlist");
if(b!==void 0)SX(b,"playlist");else if(!U.playlists||!U.playlists.length)throw mg("No data for playlist"),Error("No data for playlist");return S.return(U.playlists.map(function(N){return N.offlinePlaylistData}))}})},v6n=function(K){for(var X,Q=g.G(K.additionalMetadatas),p=Q.next();!p.done;p=Q.next())p=p.value,p.offlineMusicVideoData&&(X=p.offlineMusicVideoData);
var U,I,d,L,b;return{id:g.h9(K.videoId,"musicTrack"),videoId:K.videoId,title:K.title,thumbnailDetails:K.thumbnail,lengthMs:String(Number(K.lengthSeconds)*1E3),albumTitle:(U=X)==null?void 0:U.releaseTitle,musicVideoType:(I=X)==null?void 0:I.musicVideoType,contentRating:{explicitType:(d=X)==null?void 0:d.explicitType},artistNames:((L=X)==null?void 0:L.byline)||((b=X)==null?void 0:b.channelName),downloadMetadata:g.h9(K.videoId,"musicTrackDownloadMetadataEntity")}},PY=function(K){K.N&&K.L&&K.S&&K.visibility.isBackground()?
g.VK(K.T,6E4):K.T.stop()},o6m=function(K){var X,Q,p,U,I,d,L;
return g.E(function(b){if(b.C==1)return g.B(b,P$9(K),2);X=b.j;Q=[];p=g.G(X);for(U=p.next();!U.done;U=p.next())I=U.value,d=g.Xf(I.key),L=d.entityId,JOm(K.C,L)||Q.push(I);return g.B(b,ezm(K,Q),0)})},ZAe=function(){i5.apply(this,arguments)},f89=function(K){var X=K.videos;
K=[];var Q=[];if(X){X=g.G(X);for(var p=X.next();!p.done;p=X.next()){var U=p.value.offlineVideoData.videoId;p=g.h9(U,"musicTrack");U=g.h9(U,"musicTrackDownloadMetadataEntity");K.push(p);Q.push(U)}}return{qe:K,w_:Q}},g6z=function(K){K=K*1E3-Date.now();
return K>4E3?4E3:K},rOe=function(K){return K!==void 0},yOx=function(K,X){return{id:K,
channelId:X.channelId,title:X.title,avatar:X.thumbnail}},Xbe=function(K,X,Q){X={offlineVideoData:X,
playlistId:Q};if(K=g.P(K.actionMetadata,tRK))X.maximumDownloadQuality=K.maximumDownloadQuality;return{mainVideoEntityActionMetadata:X}},NE=function(K,X,Q,p,U){var I,d,L,b,S,N,D,v,n,a,R,O,A,w,u,h,r,C,Y,l;
return g.E(function(IS){switch(IS.C){case 1:return I=g.h9(K,"musicTrack"),d=g.h9(K,"transfer"),g.B(IS,rj(X,{mode:"readonly",o$:!0},function(pZ){return g.WN.all([yR(pZ,I,"musicTrack"),yR(pZ,d,"transfer"),uL(pZ,"musicTrack"),uL(pZ,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:L=IS.j;b=g.G(L);S=b.next().value;N=b.next().value;D=b.next().value;v=b.next().value;n=S;a=N;R=D;O=v;if(!n){IS.ZS(3);break}return g.B(IS,OA2(n,R),4);case 4:return A=IS.j,g.B(IS,Zv(A),3);case 3:w=[];u=g.G(O);for(h=u.next();!h.done;h=u.next())r=h.value,C=g.Xf(r.key).entityId,Y=tV(r),l=g.Xf(Y.action.entityKey).entityId,C!==K&&l!==K||gX(Q,r.actionProto)||w.push(r.key);return g.B(IS,rj(X,{mode:"readwrite",o$:!0},function(pZ){var $J=w.map(function(Q3){return ca(pZ,Q3)});
$J.push(ca(pZ,I,{Ts:!0}));return g.WN.all($J)}),6);
case 6:rX(a),U&&yu(U),s3(p,{entityKey:I,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.mk(IS)}})},Dv=function(K){this.C=K},B5n=function(){F9.apply(this,arguments);
this.kT="mainVideoEntity"},iTl=function(K,X){var Q=x09[K.transferState],p=x09[X.transferState];
return Q!==p?Q-p:Number(K.enqueuedTimestampMs)-Number(X.enqueuedTimestampMs)},SH3=function(K,X){var Q={offlineOrchestrationContext:cOm(K)};
X=qy2(X,Q);GH7(Y0z(),X,K.rootActionId)},rNl=function(K){var X,Q,p;
g.E(function(U){if(U.C==1){if(!K.C)return hV(K,"onTransferPausedByNetwork"),U.return();K.T.stop();return g.B(U,Ha(K,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(U.C!=3)return X=K.C,(p=((Q=X)==null?0:Q.key)?g.Xf(X.key).entityId:"")&&K.J?g.B(U,wX(p,K.J,K.j,"DOWNLOAD_STATE_PAUSED"),3):U.ZS(3);U3(K);g.mk(U)})},mge=function(K,X){var Q,p,U,I,d,L,b,S,N,D,v,n;
return g.E(function(a){switch(a.C){case 1:return Q=Kn(X),g.B(a,t0(K.C,"videoPlaybackPositionEntity"),2);case 2:p=a.j;if(p.length===0)return a.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q));g.PG(a,3);return g.B(a,Vu.getInstance(),5);case 5:U=a.j;if(!U)throw Error("prefStorage is undefined");return g.B(a,U.get("psi"),6);case 6:return I=a.j,b=(L=(d=I)==null?void 0:d.EZ)!=null?L:"0",g.B(a,$g9(p,b),7);case 7:return S=a.j,N={isPaused:S.watchHistoryPaused,EZ:S.syncTimestampUsec},g.B(a,U.set("psi",
N),8);case 8:if(N.isPaused){a.ZS(9);break}D=g.P(S.frameworkUpdates,Yf);if(!S.frameworkUpdates||!D){a.ZS(9);break}return g.B(a,XGz(D),9);case 9:g.U7(a,4);break;case 3:return v=g.XZ(a),n="PPE handleRefresh error: "+(v instanceof Error?v.message:"unknown error"),mg(n),a.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return a.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Q))}})},kCl=function(K,X,Q,p){var U,I,d;
return g.E(function(L){switch(L.C){case 1:return g.B(L,iAm([X]),2);case 2:return U=L.j,g.B(L,khn(K,U[0],Q,p),3);case 3:return I=L.j,d=eY(I.thumbnailDetails),g.B(L,qU(d),4);case 4:return L.return(U[0].videos)}})},LBz=function(K,X){var Q,p,U,I;
return g.E(function(d){Q=X.videoId;p=!0;if(X.captionTracks.length)U=kHv(X),K.C=new g.kg(K.cP,X,U);else if(X.Ka)I=g.bDS(X),K.C=new g.NQ(K.cP,X.Ka,Q,I,X.UH,X.eventId),p=X.UH;else return d.return();return d.return(new Promise(function(L){var b;(b=K.C)==null||b.zD({SI:function(){return g.E(function(S){if(S.C==1)return g.B(S,K.SI(Q,p),2);L();g.mk(S)})},
dE:function(){}})}))})},eI7=function(){i5.apply(this,arguments)},m7=function(K){return K.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!K.entityKey},q0K=function(){Dv.apply(this,arguments)},xgx=function(){i5.apply(this,arguments)},lSC=function(){i5.apply(this,arguments)},Llj=function(K,X,Q){return new g.u9(K,{cotn:X,
raw_player_response:Q,download_media:!0,start:Infinity,disable_watch_next:!0})},Vu=function(K){this.token=K},rgz=function(K,X,Q){var p,U,I,d,L,b,S,N;
return g.E(function(D){switch(D.C){case 1:p=g.rk();var v=Q.refreshData,n=Q.isEnqueuedForExpiredStreamUrlRefetch,a=Q.RH,R=Q.offlineSourceData,O=Q.mediaCapabilities,A={entityKey:K};v&&(A.refreshData=v);n&&(A.isExpiredStreamUrlRefetch=n);a&&(A.downloadParameters=a);R&&(A.offlineSourceData=R);v={context:g.py(X),signatureTimestamp:20389,videos:[A]};O&&(v.mediaCapabilities=O);U=v;I=g.Mr(K2z);g.PG(D,2);L={Sn:!0};return g.B(D,g.Os(p,U,I,void 0,L),4);case 4:d=D.j;g.U7(D,3);break;case 2:b=g.XZ(D);if(b instanceof
g.I0)throw S="GetPDE network manager error: "+b.message,mg(S,b),Error(S);mg("GetPDE fetch request error",b);throw Error("GetPDE fetch request error");case 3:N=bL(d);if(d)N!==void 0&&SX(N,"PDE");else throw mg("Network request failed for PDE"),Error("Network request failed for PDE");return D.return(d)}})},XSe=function(){i5.apply(this,arguments)},QqJ=function(){i5.apply(this,arguments)},pSn=function(K,X){K=g.G(K.observers);
for(var Q=K.next();!Q.done;Q=K.next())Q=Q.value,Q(X)},IKj=function(K,X){var Q,p,U,I,d,L,b,S,N,D,v,n,a,R,O,A,w,u,h,r,C,Y,l,IS,pZ,$J,Q3,V3,xJ,TK,dv,mS,h7,pY,GK,Hx,U6,mn,LZ,kj,W,KZ,wf,$W,xW,Dq,qS,K7,kW,f,M,z,H,m,TQ,q,t,J,kJ,jQ,RS,fZ,p7,s7,tY,cF,q3,A7,ev,GQ,Om,oS,Gg,sm;
return g.E(function(ll){switch(ll.C){case 1:return Q=Kn(X),p=X.entityKey,U=g.Xf(p).entityId,I=[],d=!1,U==="!*$_ALL_ENTITIES_!*$"?(d=!0,g.B(ll,t0(K.C,"mainPlaylistEntity"),5)):g.B(ll,l5(K.C,p,"mainPlaylistEntity"),4);case 4:(L=ll.j)&&I.push(L);ll.ZS(3);break;case 5:I=ll.j;case 3:if((b=I)==null||!b.length)return ll.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q));S=g.P(X.actionMetadata,tRK);D=(N=S)==null?void 0:N.nextAutoRefreshIntervalSeconds;n=(v=S)==null?void 0:v.autoSync;a=[];O=R=
!0;A=!1;if(!d&&n===!1){ll.ZS(6);break}g.PG(ll,7);return g.B(ll,rRC(0,!!n,!0,I),9);case 9:a=ll.j;g.U7(ll,8);break;case 7:w=g.XZ(ll);if(!(w instanceof Error&&w.message==="No data")){w instanceof Error&&w.message==="Empty response body"&&mg(w.message);ll.ZS(8);break}return U==="!*$_ALL_ENTITIES_!*$"?g.B(ll,MR7(K.C,X,K.J,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.B(ll,Ubn(U,K.C,X,K.J),8);case 8:if(!a.length||!d&&a[0].playlistId!==U)return ll.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Q));case 6:if(d){u=[];h=g.G(a);for(r=h.next();!r.done;r=h.next())C=r.value,C.upToDate||n&&!C.shouldAutoSyncMetadata||!C.playlistId||(Y={nextAutoRefreshIntervalSeconds:C.checkInSeconds,autoSync:n},u.push(nn("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",C.playlistId,"mainPlaylistEntity",0,AV,{mainPlaylistEntityActionMetadata:Y})));return ll.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q,u))}a.length&&(l=a[0],A=!!l.upToDate,n&&(R=(IS=l.shouldAutoSyncMetadata)!=null?IS:!0,O=(pZ=l.shouldAutoSyncVideos)!=
null?pZ:!0,l.checkInSeconds&&(D=l.checkInSeconds)));if(A||!R)return ll.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q));$J=[];Q3=I[0];if(!Q3.downloadState){V3=void 0;ll.ZS(15);break}return g.B(ll,l5(K.C,Q3.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:V3=ll.j;case 15:return xJ=V3,dv=((TK=xJ)==null?0:TK.addedTimestampMillis)?String(xJ.addedTimestampMillis):void 0,g.PG(ll,17),g.B(ll,l87(K,U,dv,D),19);case 19:$J=ll.j;g.U7(ll,18);break;case 17:mS=g.XZ(ll);if(!(mS instanceof
Error&&mS.message==="No data for playlist")){if(mS instanceof Error&&mS.message==="Empty response body for playlist")mg(mS.message);else return h7="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",pY="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",mS instanceof g.JQ&&mS.type==="QUOTA_EXCEEDED"&&(h7="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",pY="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),ll.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,h7,pY));
ll.ZS(18);break}return g.B(ll,Ubn(U,K.C,X,K.J),18);case 18:if(!O)return ll.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q));GK=[];Hx=new Map;if((U6=$J)==null?0:U6.length)for(mn=g.G($J),LZ=mn.next();!LZ.done;LZ=mn.next())kj=LZ.value,W=kj.offlineVideoData,KZ=void 0,((KZ=W)==null?0:KZ.videoId)&&Hx.set(W.videoId,W);wf=new Map;$W=[];if((xW=Q3)==null?0:(Dq=xW.videos)==null?0:Dq.length)for(qS=g.G(Q3.videos),K7=qS.next();!K7.done;K7=qS.next())if(kW=K7.value,f=JSON.parse(g.Xf(kW).entityId),
M=f.videoId)Hx.has(M)?(wf.set(M,Hx.get(M)),Hx.delete(M)):$W.push(M);H=Number(((z=X.actionMetadata)==null?void 0:z.priority)||0)+1;m=g.G(Hx.entries());for(TQ=m.next();!TQ.done;TQ=m.next())q=TQ.value,t=g.G(q),J=t.next().value,kJ=t.next().value,jQ=J,RS=kJ,GK.push(nn("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",jQ,"mainVideoEntity",H,AV,Xbe(X,RS,U)));fZ=g.G(wf.entries());for(p7=fZ.next();!p7.done;p7=fZ.next())s7=p7.value,tY=g.G(s7),cF=tY.next().value,q3=tY.next().value,A7=cF,ev=q3,GK.push(nn("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
A7,"mainVideoEntity",H,AV,Xbe(X,ev,U)));GQ=g.G($W);for(Om=GQ.next();!Om.done;Om=GQ.next())oS=Om.value,Gg={playlistId:U},sm={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:Gg},GK.push(nn("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",oS,"mainVideoEntity",0,AV,sm));return ll.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q,GK))}})},v7z=function(K,X){a:{K=IHC(K.j,X.version);
try{var Q=K.j(X.data,X.key);break a}catch(p){HDe(p,Hbn)}Q=void 0}return Q},dbn=function(K,X){var Q,p,U,I;
return g.E(function(d){if(d.C==1){Q=X.clientPlaybackNonce;p={cpn:Q,offlineSourceVisualElement:g.NF(X.mq||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};X.j&&(p.videoFmt=Number(X.j.itag));X.T&&(p.audioFmt=Number(X.T.itag));if((U=o7e(X))&&X.videoId){var L=X.videoId;L=U!=="PPSV"?Promise.resolve(!1):K.C.Te(L);d=g.B(d,L,3)}else d=d.ZS(2);return d}d.C!=2&&(I=d.j)&&(p.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");K.j=Q;g.gN("offlinePlaybackStarted",p);g.mk(d)})},T$K=function(){i5.apply(this,
arguments)},L2J=function(){i5.apply(this,arguments)},RX=function(K,X){var Q,p,U,I,d,L,b,S,N,D,v;
return g.E(function(n){if(n.C==1)return Q=g.h9(X,"transfer"),p=g.h9(X,"videoDownloadContextEntity"),g.B(n,rj(K,{mode:"readonly",o$:!0},function(a){return g.WN.all([yR(a,Q,"transfer"),yR(a,p,"videoDownloadContextEntity")])}),2);
U=n.j;I=g.G(U);d=I.next().value;L=I.next().value;b=d;S=L;v={videoId:X,cotn:(N=b)==null?void 0:N.cotn,offlineModeType:(D=S)==null?void 0:D.offlineModeType};return n.return(v)})},$bx=function(K,X,Q,p,U,I){var d,L,b;
return g.E(function(S){d="STREAM_TYPE_UNKNOWN";Q.video&&Q.audio?(d="STREAM_TYPE_AUDIO_AND_VIDEO",mg("unexpected stream type")):Q.video&&!Q.audio?d="STREAM_TYPE_VIDEO":!Q.video&&Q.audio&&(d="STREAM_TYPE_AUDIO");L=g.h9(X,"offlineVideoStreams");b={numBytesDownloaded:U.toFixed(),numTotalBytes:I.toFixed(),streamType:d,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(p),itag:d==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(Q.itag):void 0};return g.B(S,rj(K,{mode:"readwrite",o$:!0},
function(N){var D=yR(N,L,"offlineVideoStreams"),v=yR(N,g.h9(X,"transfer"),"transfer");return g.WN.all([D,v]).then(function(n){n=g.G(n);var a=n.next().value;n=n.next().value;if(!n)return ca(N,L).then(function(){});
var R=bpJ(a);a=SCz(a,p,b,L);var O=ME(N,a,"offlineVideoStreams");bpJ(a)>R&&(n.lastProgressTimeMs=Date.now().toString());R=[O];n.offlineVideoStreams||(n.offlineVideoStreams=[]);n.offlineVideoStreams.indexOf(L)===-1&&(n.offlineVideoStreams.push(L),R.push(ME(N,n,"transfer")));return g.WN.all(R)})}),0)})},N$m=function(K){Yv({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},K)},dDK=function(K,X,Q){var p,U,I;
return g.E(function(d){switch(d.C){case 1:return g.B(d,iAm([X]),2);case 2:return p=d.j,g.B(d,xj2(K,p[0],Q),3);case 3:return U=d.j,I=eY(U.thumbnailDetails),g.B(d,qU(I),4);case 4:return d.return(p[0].videos)}})},Db2=function(){Dv.apply(this,arguments)},JNl=function(K,X){var Q,p,U,I,d,L,b;
return g.E(function(S){switch(S.C){case 1:if(X.length===0)return S.return([]);Q=X.map(function(N){return g.h9(N,"transfer")});
return g.B(S,t0(K.C,"transfer",Q),2);case 2:p=S.j;U=p.filter(rOe).map(function(N){return g.Xf(N.key).entityId});
I=X.filter(function(N){return U.indexOf(N)===-1});
if(I.length===0)return S.return([]);d=g.G(I);L=d.next();case 3:if(L.done){S.ZS(5);break}b=L.value;return g.B(S,jao(b),4);case 4:L=d.next();S.ZS(3);break;case 5:return S.return(I)}})},rX=function(K,X){if(K&&K.transferState!=="TRANSFER_STATE_COMPLETE"&&K.transferState!=="TRANSFER_STATE_FAILED"){var Q=g.Xf(K.key).entityId;
Yv({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:Q,oE:K,offlineModeType:X})}},X9=function(K,X,Q,p,U,I){this.status=K;
this.C=X;this.T=Q;this.j=p;this.J=U;this.downloadState=I},vFJ=function(K,X){var Q,p,U,I,d,L,b,S,N,D,v,n,a,R,O,A,w;
return g.E(function(u){switch(u.C){case 1:return Q=Kn(X),p=g.Xf(X.entityKey),U=p.entityId,g.B(u,l5(K.C,X.entityKey,"mainVideoEntity"),2);case 2:I=u.j;if(!I){d=void 0;u.ZS(3);break}return g.B(u,l5(K.C,I.downloadState,"mainVideoDownloadStateEntity"),4);case 4:d=u.j;case 3:L=d;if(!I||!L)return u.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q));g.PG(u,5);return g.B(u,vOj(K,U,L.addedTimestampMillis,(S=g.P(X.actionMetadata,va))==null?void 0:S.offlineVideoData),7);case 7:N=1;N=Number(((D=
X.actionMetadata)==null?void 0:D.priority)||0)+1;b=nn("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",U,"playbackData",N,pL2);g.U7(u,6);break;case 5:v=g.XZ(u);if(!(v instanceof Error&&v.message==="No data")){if(v instanceof Error&&v.message==="Empty response body")mg(v.message);else return n="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",a="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",v instanceof g.JQ&&v.type==="QUOTA_EXCEEDED"&&(n="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
a="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),u.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,n,a));u.ZS(6);break}return g.B(u,RX(K.C,U),9);case 9:R=u.j;O=g.P(X.actionMetadata,va);if(w=(A=O)==null?void 0:A.playlistId)R.playlistId=w;R.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.B(u,Cn(U,K.C,X,K.J,R),6);case 6:return u.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q,b?[b]:void 0))}})},nFn=function(){i5.apply(this,arguments)},W67=function(K,
X,Q){if(Q.has(X))return g.WN.resolve(void 0);
Q.add(X);return aKz(K,X).then(function(p){return K.C.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(X)).then(function(){return p})}).then(function(p){var U=g.WN.resolve(void 0);
p=g.G(p);for(var I=p.next(),d={};!I.done;d={VO:void 0},I=p.next())d.VO=I.value,U=U.then(function(L){return function(){return W67(K,L.VO,Q)}}(d));
return U}).then(function(){})},F2x=function(K){return g.E(function(X){g.Wi(K,0);
return X.return(L6J(K))})},E79=function(K){var X,Q,p;
return g.E(function(U){if(U.C==1)return K?g.B(U,l5(K,g.iG,"mainDownloadsListEntity"),2):U.return([]);X=U.j;return((Q=X)==null?0:(p=Q.downloads)==null?0:p.length)?U.return(X.downloads.map(function(I){var d;return(d=I.videoItem)!=null?d:""})):U.return([])})},EFK=function(){i5.apply(this,arguments)},V5e=function(K,X){var Q,p,U,I,d,L,b,S,N,D;
return g.E(function(v){switch(v.C){case 1:return Q=Kn(X),p=g.Xf(X.entityKey).entityId,g.B(v,rj(K.C,{mode:"readonly",o$:!0},function(n){var a=yR(n,X.entityKey,"transfer");n=yR(n,g.h9(p,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.WN.all([a,n])}),2);
case 2:U=v.j;I=g.G(U);d=I.next().value;L=I.next().value;b=d;S=L;if(!b||b.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return v.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q));g.PG(v,3);b.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.B(v,Wa(K.C,b,"transfer"),5);case 5:N=g.Xf(b.key).entityId;N$m({videoId:N,oE:b,offlineModeType:(D=S)==null?void 0:D.offlineModeType});g.U7(v,4);break;case 3:return g.XZ(v),v.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
Q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return v.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q))}})},R2m=function(K,X){var Q,p;
return g.E(function(U){if(U.C==1)return g.B(U,g.Wx(),2);if(U.C!=3){Q=U.j;if(!Q)throw g.Wm("wct");return g.B(U,g.Nl(Q),3)}p=U.j;return g.B(U,g.iE(p,["captions"],{mode:"readwrite",o$:!0},function(I){var d=[];I=I.objectStore("captions");for(var L=0;L<X.length;L++){var b=g.L4(I,X[L],K+"|"+X[L].metadata.vss_id);d.push(b)}return g.WN.all(d)}),0)})},bL=function(K){var X;
return(X=K.errorMetadata)==null?void 0:X.status},U$z=function(K,X){var Q;
return g.E(function(p){if(!K.C)return p.return();Q=K.C;return g.B(p,rj(K.j,{mode:"readwrite",o$:!0},function(U){var I=[ME(U,Q,"transfer")];X&&I.push(X(U));return g.WN.all(I)}),0)})},Cyx=function(){Dv.apply(this,arguments)},tV=function(K){if(!K.key)throw Error("Entity key is required.");
if(!K.actionProto)throw Error("OfflineOrchestrationAction is required.");var X=g.Xf(K.key),Q=g.Xf(K.actionProto.entityKey);return new iL(Q.entityType,X.entityId,K.actionProto,K.parentActionId,K.rootActionId,K.childActionIds,K.prereqActionId,K.postreqActionIds,K.retryScheduleIndex,K.hasChildActionFailed,Number(K.enqueueTimeSec)*1E3)},OA2=function(K,X){var Q,p,U,I,d,L,b,S;
return g.E(function(N){Q=eY(K.thumbnailDetails);p=g.G(X);for(U=p.next();!U.done;U=p.next())if(I=U.value,I.id!==K.id)for(d=g.G(eY(I.thumbnailDetails)),L=d.next();!L.done;L=d.next())b=L.value,S=Q.indexOf(b),S!==-1&&Q.splice(S,1);return N.return(Q)})},GEj=function(K,X,Q){var p=this;
this.W=K;this.kT=X;this.visibility=Q;this.S=this.N=this.L=this.J=this.C=!1;this.T=new g.Bh(function(){p.uM()});
this.I$={GO:function(){return p.j},
uM:function(){p.uM()},
EMF:function(){return p.T}};
this.visibility.subscribe("visibilitystatechange",function(){p.nw()})},SX=function(K,X){X=X?" for "+X:"";
if(K===0)throw K="Empty response body"+X,mg(K),Error(K);K="Response with error"+X;mg(K);throw Error(K);},Z2m=function(K,X){var Q;
return((Q=K.player)==null?void 0:Q.getVideoData().videoId)===X?K.player:null},Tqx=function(K,X){K.C&&(K.L=X,PY(K))},M53=function(K){return g.E(function(X){if(X.C==1)return K.S?g.B(X,Qu(K.N,K.S.videoDetails.videoId),3):X.ZS(0);
U3(K);g.mk(X)})},XLn=function(K,X){var Q,p,U,I,d,L,b;
return g.E(function(S){if(S.C==1)return Q=g.h9("music_downloads_library_id","musicDownloadsLibraryEntity"),g.B(S,l5(K,Q,"musicDownloadsLibraryEntity"),2);p=S.j;if(!p)return S.ZS(0);U=g.Xf(X).entityType;U==="musicTrack"?I=p.downloadedTracks:U==="musicPlaylist"&&(I=p.downloadedPlaylists);if((d=I)==null?0:d.length)for(L=0;L<I.length;L++)if(b=I[L],b===X){I.splice(L,1);break}return g.B(S,Wa(K,p,"musicDownloadsLibraryEntity"),0)})},gj=function(K,X){X=X===void 0?{}:X;
g.$X.call(this,g.qm2[K],Object.assign({},{name:"PESEncoderError",type:K},X));this.type=K;this.level="WARNING";Object.setPrototypeOf(this,gj.prototype)},P$9=function(K,X){var Q;
return g.E(function(p){if(p.C==1)return g.B(p,t0(K.j,"offlineOrchestrationActionWrapperEntity",X),2);Q=p.j;return p.return(Q.filter(rOe))})},Op3=function(K,X){this.C=K;
this.J=X},AWe=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},W2m=function(){i5.apply(this,arguments)},Y0z=function(){wSz||(wSz=new sqz);
return wSz},z2J=function(K,X){var Q,p,U;
return g.E(function(I){switch(I.C){case 1:return g.PG(I,2),g.B(I,V43(K,X),4);case 4:return p=I.j,g.B(I,R7z(p),5);case 5:Q=CBn(p);g.U7(I,3);break;case 2:U=g.XZ(I),mg("getAndProcessSmartDownloadsResponse request or processing error",U);case 3:return I.return(Q)}})},jao=function(K){return g.E(function(X){return X.return(F2x(K))})},vwJ=function(K){var X;
K=(X=K.options)==null?void 0:X.persistenceOption;return K==="ENTITY_PERSISTENCE_OPTION_PERSIST"||K==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},fK3=function(K,X){this.C=K;
this.V=X},Axz=function(K){return new g.Vf(function(X,Q){var p=K.length,U=[];
if(p)for(var I=function(S,N){p--;U[S]=N;p==0&&X(U)},d=function(S){Q(S)},L,b=0;b<K.length;b++)L=K[b],g.nM7(L,g.zE(I,b),d);
else X(U)})},kMJ=function(){i5.apply(this,arguments)},eY=function(K){if(!K||!K.thumbnails)return[];
var X=[];K=g.G(K.thumbnails);for(var Q=K.next();!Q.done;Q=K.next())Q=Q.value,Q.url&&X.push(Q.url);return X},jqx=function(K,X,Q){var p,U;
g.E(function(I){switch(I.C){case 1:if(!K.C)return hV(K,"onTransferProgress: "+X),I.return();if(K.C.transferState==="TRANSFER_STATE_TRANSFERRING"){I.ZS(2);break}return g.B(I,d$n(K),2);case 2:p=Date.now();if(!(p-K.fb>1E3)){I.ZS(4);break}K.fb=p;return g.B(I,$bx(K.j,Q.videoId,Q.j,Q.yj,Q.bytesDownloaded,Q.C),5);case 5:if(K.kT&&!(K.kT&&p-K.mq>K.Nw)){I.ZS(4);break}K.mq=p;return g.B(I,BY(K,X),7);case 7:U=I.j,IRo({videoId:X,oE:K.C,offlineModeType:U},Q.bytesDownloaded,Q.C);case 4:K.T.start(108E5),g.mk(I)}})},
D$v=function(K,X,Q,p){var U,I,d,L,b,S,N,D,v,n,a,R,O;
return g.E(function(A){switch(A.C){case 1:Q||(Q=Date.now().toString());I=(U=X.channel)==null?void 0:U.offlineChannelData;d={id:g.h9(X.videoId,"ytMainChannelEntity"),channelId:I.channelId,title:I.title,avatar:I.thumbnail};L={key:g.h9(X.videoId,"mainVideoDownloadStateEntity"),playbackData:g.h9(X.videoId,"playbackData"),addedTimestampMillis:Q,videoDownloadContextEntity:g.h9(X.videoId,"videoDownloadContextEntity")};b={key:g.h9(X.videoId,"videoPlaybackPositionEntity"),videoId:X.videoId,lastPlaybackPositionSeconds:"0"};
K.V.K("html5_offline_playback_position_sync")&&(S={playbackPosition:b.key});N=g.h9(X.videoId,"mainVideoEntity");D={key:N,videoId:X.videoId,title:X.title,thumbnail:X.thumbnail,localizedStrings:{viewCount:X.shortViewCountText},userState:S,lengthSeconds:X.lengthSeconds?Number(X.lengthSeconds):void 0,publishedTimestampMillis:X.publishedTimestamp?(Number(X.publishedTimestamp)*1E3).toString():void 0,formattedDescription:X.description,owner:d.id,downloadState:L.key};if(!K.V.K("woffle_enable_main_downloads_library")||
!p){A.ZS(2);break}return g.B(A,m0J(K.C,[N]),3);case 3:if(a=A.j)v=a.mainDownloadsLibraryEntity,n=a.mainDownloadsListEntity;case 2:return O=PBn,R={key:g.h9(X.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.$l(L,O,R),g.B(A,rj(K.C,{mode:"readwrite",o$:!0},function(w){var u=ME(w,d,"ytMainChannelEntity"),h=ME(w,L,"mainVideoDownloadStateEntity"),r=ME(w,D,"mainVideoEntity");u=[u,h,r];K.V.K("html5_offline_playback_position_sync")&&(h=ME(w,b,"videoPlaybackPositionEntity"),
u.push(h));v&&(h=ME(w,v,"mainDownloadsLibraryEntity"),u.push(h));n&&(h=ME(w,n,"mainDownloadsListEntity"),u.push(h));R&&(w=ME(w,R,"downloadStatusEntity"),u.push(w));return g.WN.all(u)}),4);
case 4:return A.return({mainVideoEntity:D,channelEntity:d})}})},uHJ=function(K,X,Q,p,U){var I;
return g.E(function(d){if(d.C==1)return I=new eX(K,X,Q,p,U),g.B(d,q4v(I),2);GM7(I);return d.return(I)})},fRj=function(K,X,Q){Q=Q===void 0?!1:Q;
var p,U,I,d,L,b,S,N,D,v,n,a,R,O,A;return g.E(function(w){switch(w.C){case 1:return p=g.P(X.actionMetadata,h2n),U=g.Xf(X.entityKey).entityId,I=g.h9(U,"downloadStatusEntity"),g.B(w,rj(K.C,{mode:"readonly",o$:!0},function(u){var h=yR(u,I,"downloadStatusEntity");u=yR(u,g.h9(U,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.WN.all([h,u])}),2);
case 2:return d=w.j,L=g.G(d),b=L.next().value,S=L.next().value,N=b,D=S,v="TRANSFER_STATE_TRANSFER_IN_QUEUE",((n=N)==null?void 0:n.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(v="TRANSFER_STATE_PAUSED_BY_USER"),O={key:X.entityKey,transferState:v,cotn:g.Oo(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(a=p)==null?void 0:a.maximumDownloadQuality,preferredAudioTrack:(R=p)==null?void 0:R.preferredAudioTrack,transferRetryCount:0,isRefresh:Q,hasLoggedFirstStarted:!1},g.B(w,rj(K.C,
{mode:"readwrite",o$:!0},function(u){var h=[];Q&&h.push(ca(u,g.h9(U,"offlineVideoStreams")));h.push(ME(u,O,"transfer"));return g.WN.all(h)}),3);
case 3:if(!Q){w.ZS(4);break}return g.B(w,jao(U),4);case 4:ow2({videoId:U,oE:O,offlineModeType:(A=D)==null?void 0:A.offlineModeType}),g.mk(w)}})},cxJ=function(K,X,Q){var p=MLK(X);
Q=HpC(Q);if(!Q)return g.WN.resolve([]);Q=new Q(X);K=K.C.objectStore("EntityAssociationStore");X=[];Q=g.G(Q.j());for(var U=Q.next();!U.done;U=Q.next())X.push(g.L4(K,{parentEntityKey:p,childEntityKey:U.value}));return g.WN.all(X).then(function(I){return I.map(function(d){return d[1]})})},HpC=function(K){var X=JxK[K];
if(X)return X;g.bS(new g.$X("Entity model not found.",{entityType:K}))},ipv=function(){i5.apply(this,arguments)},GM7=function(K){var X=K.C.actions[0];
return K.T?((X==null?void 0:X.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&K.T[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(K.S=!0),Promise.resolve()):bD9(K)},Py9=function(){i5.apply(this,arguments)},d$n=function(K){var X,Q,p;
return g.E(function(U){if(U.C==1){if(!K.C)return hV(K,"onTransferStart"),U.return();K.T.start(108E5);return g.B(U,Ha(K,"TRANSFER_STATE_TRANSFERRING"),2)}X=K.C;return(p=((Q=X)==null?0:Q.key)?g.Xf(X.key).entityId:"")&&K.J?g.B(U,wX(p,K.J,K.j,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):U.ZS(0)})},n7n=function(K,X,Q,p){var U,I,d,L,b,S,N,D,v,n,a,R,O,A,w,u,h,r,C,Y,l,IS,pZ,$J,Q3,V3,xJ,TK,dv,mS;
return g.E(function(h7){switch(h7.C){case 1:return g.B(h7,O3(),2);case 2:U=h7.j;if(!U)return h7.return([]);I=[];if((d=p)==null?0:d.length){I=p;h7.ZS(3);break}return g.B(h7,t0(U,"musicPlaylist"),4);case 4:I=h7.j;case 3:if(!I.length)return h7.return([]);L=[];b=Date.now()/1E3;S=g.G(I);N=S.next();case 5:if(N.done)return L.length?g.B(h7,g7l(L),10):h7.return([]);D=N.value;v=void 0;a=(n=(v=D)==null?void 0:v.entityMetadata)&&n.nextAutoRefreshIntervalSeconds?Number(n.nextAutoRefreshIntervalSeconds):NaN;R=
Number.isNaN(a)?K:a;A=O=0;w="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!D.downloadMetadata){h7.ZS(8);break}return g.B(h7,l5(U,D.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:u=h7.j,r=h=void 0,O=Number((r=(h=u)==null?void 0:h.addedTimestampMillis)!=null?r:"0")/1E3,Y=C=void 0,A=Number((Y=(C=u)==null?void 0:C.lastModifiedTimestampMillis)!=null?Y:"0")/1E3,IS=l=void 0,w=(IS=(l=u)==null?void 0:l.syncState)!=null?IS:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:pZ=void 0;if(Q||w!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!n||Number((pZ=n.lastSyncedTimestampSeconds)!=null?pZ:0)+R<=b){$J=[];Q3=void 0;if((Q3=D.tracks)==null?0:Q3.length)for(V3=g.G(D.tracks),xJ=V3.next();!xJ.done;xJ=V3.next())TK=xJ.value,$J.push(g.Xf(TK).entityId);dv={playlistId:D.playlistId,videoIds:$J,offlineLastModifiedTimestamp:String(A.toFixed()),autoSync:X,offlineDateAddedTimestamp:String(O.toFixed())};L.push(dv)}N=S.next();h7.ZS(5);break;case 10:return mS=h7.j,h7.return(mS)}})},ezm=function(K,X){var Q,p,U,I,d,L,b,S,N,D,v,n;
return g.E(function(a){Q=[];p=Infinity;U=4E3;I=g.G(X);for(d=I.next();!d.done;d=I.next())L=d.value,b=Number(L.enqueueTimeSec),S=g6z(b),N=L.retryScheduleIndex,D=N!=null&&N>0,S>0&&D?(p=Math.min(p,b),U=Math.min(S,U)):Q.push(L);isFinite(p)&&(!K.J.isActive()||p<K.W)&&(K.W=p,K.J.start(U));K.L.mE()||(v=Q.length,Q=Q.filter(function(R){var O;R=((O=R.actionProto)==null?void 0:O.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!oFx.includes(R)}),n=Q.length<v,!K.J.isActive()&&n&&K.J.start(1));
Q.length>0&&Zp7(K,Q);return g.B(a,GM7(K),0)})},V43=function(K,X){var Q,p,U,I,d,L,b,S,N,D;
return g.E(function(v){switch(v.C){case 1:return Q=g.rk(),g.B(v,O3(),2);case 2:p=v.j;if(!p){v.ZS(3);break}return g.B(v,N59(p),4);case 4:U=v.j;case 3:var n=U;I={context:g.S$(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:K},offlineClientState:n,clientStateRequestData:{preferredFormatType:X}}}};d=g.Mr(gFo);g.PG(v,5);b={Sn:!0};return g.B(v,g.Os(Q,I,d,void 0,b),7);case 7:L=v.j;g.U7(v,6);break;case 5:S=g.XZ(v);if(S instanceof g.I0)throw N=
"DPS network manager error for smart downloads: "+S.message,mg(N,S),Error(N);mg("DPS fetch request error for smart downloads",S);throw Error("DPS fetch request error for smart downloads");case 6:D=bL(L);if(L)D!==void 0&&SX(D,"smart downloads");else throw mg("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return v.return(L)}})},Yv=function(K,X){var Q=X.videoId;
var p=X.oE;X=X.offlineModeType;K.encryptedVideoId=Q;K.cotn=p==null?void 0:p.cotn;K.offlineabilityFormatType=p==null?void 0:p.maximumDownloadQuality;var U;K.isRefresh=(U=p==null?void 0:p.isRefresh)!=null?U:!1;var I;K.softErrorCount=(I=p==null?void 0:p.transferRetryCount)!=null?I:0;K.offlineModeType=X!=null?X:"OFFLINE_NOW";(K.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&K.statusType==="UNKNOWN_STATUS_TYPE"||!K.transferStatusType&&!K.statusType)&&g.bS(Error("Woffle unknown transfer status"));
g.gN("offlineTransferStatusChanged",K)},gO9=function(K,X){var Q,p,U,I;
return g.E(function(d){if(d.C==1)return Q=g.Xf(X.entityKey).entityId,p=g.h9(Q,"videoDownloadContextEntity"),g.B(d,l5(K.C,p,"videoDownloadContextEntity"),2);U=d.j;return(I=U)!=null&&I.offlineModeType?d.return({offlineModeType:U.offlineModeType}):d.return(void 0)})},rxj=function(K,X){var Q;
return g.E(function(p){return X.length?(Q=AWe(),g.$l(Q,qE,{isEnqueuedForExpiredStreamUrlRefetch:!0}),K.api.Q1("qrd",{v:X.length}),p.return(Pa(K,X,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Q))):p.return([])})},hqe=function(K,X){K.C&&(K.N=X,PY(K))},t53=function(K,X){var Q,p,U,I,d,L,b,S,N,D,v,n,a,R,O,A;
return g.E(function(w){switch(w.C){case 1:return Q=Kn(X),p=g.Xf(X.entityKey),U=p.entityId,I=[],g.PG(w,2),g.B(w,kCl(K,U),4);case 4:I=w.j;if((d=I)==null||!d.length){w.ZS(5);break}return g.B(w,yxe(K.C,X.entityKey),5);case 5:g.U7(w,3);break;case 2:return L=g.XZ(w),b="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",S="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",L instanceof g.JQ&&L.type==="QUOTA_EXCEEDED"&&(b="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",S="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
w.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,b,S));case 3:return N=[],g.B(w,K6e(K.C,"musicTrack",I),7);case 7:I=w.j;if(I.length)for(D=g.G(I),v=D.next();!v.done;v=D.next())if(n=v.value,a=n.offlineVideoData,R=void 0,(R=a)==null?0:R.videoId)O=void 0,A=Number(((O=X.actionMetadata)==null?void 0:O.priority)||0)+1,N.push(nn("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",a.videoId,"musicTrack",A,Ba,Gl(X,a,U)));return w.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q,N))}})},
rj=function(K,X,Q){var p,U,I,d;
return g.E(function(L){if(L.C==1)return g.B(L,B$l(K.token),2);if(L.C!=3)return p=L.j,g.B(L,g.iE(p,["EntityStore","EntityAssociationStore"],X,function(b){U=new mDe(b,K.C);return Q(U)}),3);
I=L.j;U&&(d=U.J,Object.keys(d).length>0&&(K.channel.postMessage(d),pSn(K,d)));return L.return(I)})},e2l=function(K){var X,Q;
return g.E(function(p){if(p.C==1)return g.B(p,O3(),2);if(p.C!=3){X=p.j;if(!X)return mg("PES is undefined"),p.return();K.j=new YCm(X,K.api,K.J,K.C);Q=K.Sl(X);return g.B(p,uHJ(X,Q,K.J,K.C,K.V),3)}K.N=p.j;return g.B(p,mbJ(K),0)})},qCv=function(){i5.apply(this,arguments)},uTC=function(K){return g.E(function(X){K.api.BP("onOrchestrationBecameLeader");
return g.B(X,K.UW(),0)})},xb2=function(){i5.apply(this,arguments)},nwv=function(K,X,Q,p){var U=IHC(K.j,1);
return yR(K,X,p).then(function(I){if(I){I=g.sE(I,Q);var d={key:X,entityType:p,data:cRK(U,I,X),version:1};return g.WN.all([g.L4(K.C.objectStore("EntityStore"),d),Obo(K,I,p)])}}).then(function(){Ln(K,X,p);
return X})},zI3=function(K,X,Q,p,U){var I;
return g.E(function(d){return d.C==1?(U||(U=Date.now().toString()),I={id:g.h9(Q,"musicTrackDownloadMetadataEntity"),playbackData:g.h9(Q,"playbackData"),addedTimestampMillis:U,videoDownloadContextEntity:g.h9(Q,"videoDownloadContextEntity")},p&&(X.albumRelease=p.id),g.B(d,rj(K.C,{mode:"readwrite",o$:!0},function(L){var b=[],S=ME(L,I,"musicTrackDownloadMetadataEntity");b.push(S);S=ME(L,X,"musicTrack");b.push(S);p&&(L=ME(L,p,"musicAlbumRelease"),b.push(L));return g.WN.all(b)}),2)):d.C!=3?g.B(d,wX(Q,"musicTrackDownloadMetadataEntity",
K.C,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):d.return({musicTrackEntity:X,
yv:p})})},LMm=function(K,X){if(X)for(var Q=0;Q<K.actions.length;Q++)if(X==="!*$_ALL_ENTITIES_!*$"&&K.actions[Q].actionId!==X||X!=="!*$_ALL_ENTITIES_!*$"&&K.actions[Q].rootActionId===X&&K.actions[Q].actionId!==X)K.actions.splice(Q,1),Q--},KOx=function(K,X,Q,p){p=p===void 0?!1:p;
var U,I,d,L,b,S,N,D,v,n,a,R,O,A,w;return g.E(function(u){switch(u.C){case 1:return U=[],g.B(u,lKv(),2);case 2:return(I=u.j)||p?g.B(u,z2J(X,Q),3):u.return([]);case 3:d=u.j;if((L=d)==null||!L.length)return u.return([]);b={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};S=g.G(d);N=S.next();case 4:if(N.done){u.ZS(6);break}v=D=N.value;n=v.actionType;a=v.entityKey;R=v.actionMetadata;if(!(n&&a&&R)||g.P(R,WMx)){u.ZS(5);break}n==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(R.offlineLoggingData=
b);O=g.Xf(a);A=O.entityId;return g.B(u,Pa(K,[A],"mainVideoEntity",n,R),8);case 8:w=u.j,U=U.concat(w);case 5:N=S.next();u.ZS(4);break;case 6:return u.return(U)}})},bpJ=function(K){if(K==null?0:K.streamsProgress){var X=0;
K=K.streamsProgress;for(var Q=0;Q<K.length;Q++){var p=K[Q];isNaN(Number(p.numBytesDownloaded))?mg("stream progress bytes number invalid"):X+=Number(p.numBytesDownloaded)}return X}return 0},X9z=function(){i5.apply(this,arguments)},Qjx=function(){i5.apply(this,arguments)},p9l=function(K,X){var Q,p,U,I,d,L,b,S,N,D,v,n,a;
return g.E(function(R){switch(R.C){case 1:return Q=Kn(X),p=g.Xf(X.entityKey),U=p.entityId,I=g.P(X.actionMetadata,wbn),g.PG(R,2),g.B(R,sUn(K,U,void 0,(d=I)==null?void 0:d.track,(L=I)==null?void 0:L.albumRelease),4);case 4:if((b=I)==null?0:b.playlistId){R.ZS(5);break}return g.B(R,yxe(K.C,X.entityKey),5);case 5:g.U7(R,3);break;case 2:return S=g.XZ(R),N="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",D="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",S instanceof g.JQ&&S.type==="QUOTA_EXCEEDED"&&
(N="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",D="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),R.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,N,D));case 3:n=Number(((v=X.actionMetadata)==null?void 0:v.priority)||0)+1;var O=(O=g.P(X.actionMetadata,wbn))?{playbackDataActionMetadata:{maximumDownloadQuality:O.maximumDownloadQuality}}:void 0;a=nn("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",U,"playbackData",n,ztl,O);return R.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Q,[a]))}})},g7l=function(K){var X,Q,p,U,I,d,L,b;
return g.E(function(S){switch(S.C){case 1:return X=g.rk(),Q=Uzl(K),p=g.Mr(IT7),g.PG(S,2),I={Sn:!0},g.B(S,g.Os(X,Q,p,void 0,I),4);case 4:U=S.j;g.U7(S,3);break;case 2:d=g.XZ(S);if(d instanceof g.I0)throw L="offlinePlaylistSyncCheck network manager error: "+d.message,mg(L,d),Error(L);mg("offlinePlaylistSyncCheck fetch request error",d);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:b=bL(U);if(!U)throw mg("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(b!==void 0)SX(b,"playlist sync");else if(!U.offlinePlaylistSyncCheckDatas||!U.offlinePlaylistSyncCheckDatas.length)throw mg("No data for playlist sync"),Error("No data for playlist sync");return S.return(U.offlinePlaylistSyncCheckDatas.map(function(N){return N.offlinePlaylistSyncCheckData}))}})},Tw3=function(K,X){var Q,p,U,I,d,L,b,S;
return g.E(function(N){switch(N.C){case 1:return Q=Kn(X),p=g.Xf(X.entityKey).entityId,g.PG(N,2),g.B(N,Vu.getInstance(),4);case 4:U=N.j;if(!U)throw Error("prefStorage is undefined");return g.B(N,U.get("psi"),5);case 5:I=N.j;d=g.P(X.actionMetadata,dzC);if(((L=I)==null?void 0:L.isPaused)!==!1||(b=d)==null||!b.lastPlaybackPositionSeconds){N.ZS(6);break}S={key:g.h9(p,"videoPlaybackPositionEntity"),videoId:p,lastPlaybackPositionSeconds:d.lastPlaybackPositionSeconds};return g.B(N,Wa(K.C,S,"videoPlaybackPositionEntity"),
6);case 6:g.U7(N,3);break;case 2:return g.XZ(N),N.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return N.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q))}})},LOz=function(){if(xf)return xf();
var K={};xf=g.RM("PersistentEntityStoreDb",{kd:(K.EntityStore={I1:1},K.EntityAssociationStore={I1:2},K),shared:!1,upgrade:function(X,Q){Q(1)&&g.u_(g.G2(X,"EntityStore",{keyPath:"key"}),"entityType","entityType");Q(2)&&(X=g.G2(X,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.u_(X,"byParentEntityKey","parentEntityKey"),g.u_(X,"byChildEntityKey","childEntityKey"))},
version:3});return xf()},b1K=function(K){var X=[],Q=K.videos;
Q&&Q.length>0&&X.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:Q[0].offlineVideoData.thumbnail}}});if((K=K.additionalMetadadatas)&&K.length>0)for(K=g.G(K),Q=K.next();!Q.done;Q=K.next()){var p=Q.value.offlineBundleItemPlaylistData,U=void 0;Q=(U=p)==null?void 0:U.style;U=void 0;p={collageThumbnail:{coverThumbnail:(U=p)==null?void 0:U.coverThumbnail}};switch(Q){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":X.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:p});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":X.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:p});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":X.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:p});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":X.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:p})}}return X},SFo=function(K,X){var Q,p,U,I,d,L,b,S,N,D,v,n,a,R,O,A;
return g.E(function(w){switch(w.C){case 1:return Q=Kn(X),p=g.Xf(X.entityKey),U=p.entityId,I=[],g.PG(w,2),g.B(w,dDK(K,U),4);case 4:I=w.j;if((d=I)==null||!d.length){w.ZS(5);break}return g.B(w,yxe(K.C,X.entityKey),5);case 5:g.U7(w,3);break;case 2:return L=g.XZ(w),b="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",S="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",L instanceof g.JQ&&L.type==="QUOTA_EXCEEDED"&&(b="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",S="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
w.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,b,S));case 3:return N=[],g.B(w,K6e(K.C,"musicTrack",I),7);case 7:I=w.j;if(I.length)for(D=g.G(I),v=D.next();!v.done;v=D.next())if(n=v.value,a=n.offlineVideoData,R=void 0,(R=a)==null?0:R.videoId)O=void 0,A=Number(((O=X.actionMetadata)==null?void 0:O.priority)||0)+1,N.push(nn("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",a.videoId,"musicTrack",A,kf,Gl(X,a,U)));return w.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q,N))}})},
$zj=function(K,X){X=X===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":X;
var Q,p,U,I;return g.E(function(d){if(d.C==1)return K.C||hV(K,"setTransferToFailed: "+X),Q="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",X==="TRANSFER_FAILURE_REASON_NETWORK"?Q="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":X==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(Q="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.B(d,Ha(K,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",X),2);if(d.C!=3)return s3(K.wf,{entityKey:(p=K.C)==null?void 0:p.key,failureReason:Q}),
U=K.C?g.Xf(K.C.key).entityId:"",g.B(d,BY(K,U),3);I=d.j;var L={videoId:U,oE:K.C,offlineModeType:I},b=X,S={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};b&&(S.transferFailureReason=b,S.failureReason=Yy3(b));Yv(S,L);g.mk(d)})},Ubn=function(K,X,Q,p){var U,I,d,L,b,S,N,D,v,n,a,R,O,A,w,u,h,r,C,Y,l,IS,pZ,$J,Q3,V3,xJ,TK,dv,mS,h7,pY,GK,Hx,U6,mn,LZ,kj,W,KZ,wf,$W,xW,Dq,qS,K7,kW,f,M,z;
return g.E(function(H){switch(H.C){case 1:return U=g.h9(K,"mainPlaylistEntity"),I=g.h9(K,"ytMainChannelEntity"),g.B(H,rj(X,{mode:"readonly",o$:!0},function(m){return g.WN.all([yR(m,U,"mainPlaylistEntity"),yR(m,I,"ytMainChannelEntity"),uL(m,"mainPlaylistEntity"),uL(m,"mainDownloadsListEntity"),uL(m,"ytMainChannelEntity"),uL(m,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:d=H.j;L=g.G(d);b=L.next().value;S=L.next().value;N=L.next().value;D=L.next().value;v=L.next().value;n=L.next().value;a=b;R=S;O=N;A=D;w=v;u=n;if(!a&&!R){H.ZS(3);break}h=a?ISj(a):[];if(!R){r=[];H.ZS(4);break}return g.B(H,cge(R,w),5);case 5:r=H.j;case 4:return C=r,g.B(H,Zv(h.concat(C)),3);case 3:Y=[];l=new Map;if(!a){H.ZS(7);break}return g.B(H,UDj(a,O,A),8);case 8:Y=H.j;IS=g.G(Y);for(pZ=IS.next();!pZ.done;pZ=IS.next())$J=pZ.value,l.set($J,{videoId:$J,playlistId:K,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.B(H,rj(X,{mode:"readonly",o$:!0},function(m){return g.WN.all([uL(m,"transfer"),uL(m,"videoDownloadContextEntity")])}),9);
case 9:Q3=H.j;V3=g.G(Q3);xJ=V3.next().value;TK=V3.next().value;dv=xJ;mS=TK;h7=g.G(dv);for(pY=h7.next();!pY.done;pY=h7.next())GK=pY.value,Hx=g.Xf(GK.key).entityId,(U6=l.get(Hx))&&GK&&(U6.cotn=GK.cotn);mn=g.G(mS);for(LZ=mn.next();!LZ.done;LZ=mn.next())kj=LZ.value,W=g.Xf(kj.key).entityId,(KZ=l.get(W))&&kj&&(KZ.offlineModeType=kj.offlineModeType);case 7:wf=[];$W=g.G(u);for(xW=$W.next();!xW.done;xW=$W.next())Dq=xW.value,qS=g.Xf(Dq.key).entityId,K7=tV(Dq),qS!==K&&K7.rootActionId!==K||gX(Q,Dq.actionProto)||
wf.push(Dq.key);kW=g.h9(K,"mainPlaylistEntity");return g.B(H,rj(X,{mode:"readwrite",o$:!0},function(m){var TQ=wf.map(function(q){return ca(m,q)});
TQ.push(ca(m,kW,{Ts:!0}));return g.WN.all(TQ)}),10);
case 10:if(!a){H.ZS(0);break}Y.reverse();if(!Y){H.ZS(0);break}f=g.G(Y);M=f.next();case 13:if(M.done){H.ZS(0);break}z=M.value;return g.B(H,Cn(z,X,Q,p,l.get(z)),14);case 14:M=f.next(),H.ZS(13)}})},Wa=function(K,X,Q){return rj(K,{mode:"readwrite",
o$:!0},function(p){return ME(p,X,Q)})},CBn=function(K){var X;
if((X=K.onResponseReceivedActions)!=null&&X.length){var Q;K=(Q=g.P(g.P(K.onResponseReceivedActions[0],Nw2),g.l3j))==null?void 0:Q.actions;if(K!=null&&K.length)return K}},R7z=function(K){var X;
return g.E(function(Q){X=g.P(K.frameworkUpdates,Yf);return K.frameworkUpdates&&X?g.B(Q,XGz(X),0):Q.return()})},aKz=function(K,X){var Q=K.C.objectStore("EntityAssociationStore");
return Q.index("byParentEntityKey").getAll(IDBKeyRange.only(X)).then(function(p){var U=[];p=g.G(p);for(var I=p.next();!I.done;I=p.next())I=I.value,U.push(Q.index("byChildEntityKey").getAll(I.childEntityKey));return g.WN.all(U)}).then(function(p){var U=[];
p=g.G(p);for(var I=p.next();!I.done;I=p.next())I=I.value,I.length===1&&U.push(I[0].childEntityKey);return U})},Dzo=function(K){switch(K.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},eX=function(K,X,Q,p,U){g.y.call(this);
var I=this;this.j=K;this.HP=X;this.mq=Q;this.N=p;this.V=U;this.C=new Ugj;this.L=new g.zO;this.J=new g.Bh(function(){I.retry()});
this.W=NaN;this.S=!1;this.I$={Pwq:function(){return I.C},
EY:function(){return I.L},
ycT:function(){return I.J},
retry:function(){return I.retry()}};
g.k(this,this.J);this.kT=this.j.observe(this.wf.bind(this))},nn=function(K,X,Q,p,U,I){X=g.h9(X,Q);
p=Object.assign({},I,{priority:p,retryScheduleIntervalsInSeconds:U});return{actionType:K,entityKey:X,actionMetadata:p}},Uzl=function(K){return{context:g.S$(),
offlinePlaylistSyncChecks:K}},B$l=function(K){return g.Yr(LOz(),K)},v8x=function(K,X,Q){this.C=K;
this.V=X;this.J=Q},n8j=function(K,X){var Q,p,U,I,d,L,b,S,N;
return g.E(function(D){switch(D.C){case 1:return Q=X.entityKey,U=(p=g.P(X.actionMetadata,qE))==null?void 0:p.isEnqueuedForExpiredStreamUrlRefetch,g.PG(D,2),I=void 0,g.B(D,gO9(K,X),4);case 4:I=D.j;g.PG(D,5);var v=(v=g.P(X.actionMetadata,qE))?{maximumDownloadQuality:v.maximumDownloadQuality}:void 0;return g.B(D,rgz(Q,K.V,{isEnqueuedForExpiredStreamUrlRefetch:U,RH:v,offlineSourceData:I}),7);case 7:d=D.j;g.U7(D,6,2);break;case 5:return g.XZ(D,2),L=Kn(X)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",mg("PDE handleAdd error"),D.return(dX(X,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",L,"DOWNLOAD_STATE_FAILED"));case 6:return g.B(D,ygm(K,d,X),8);case 8:return D.return(dX(X,!0,d.orchestrationActions));case 2:return b=g.XZ(D),S="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",b instanceof g.JQ&&b.type==="QUOTA_EXCEEDED"&&(S="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
N="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),mg("PDE handleAdd error"),D.return(dX(X,!1,void 0,S,N,"DOWNLOAD_STATE_FAILED"))}})},aTj=function(K,X){var Q,p;
return g.E(function(U){switch(U.C){case 1:return Q=Kn(X),g.PG(U,2),p=g.Xf(X.entityKey).entityId,p==="!*$_ALL_ENTITIES_!*$"?g.B(U,$f(K.C,X,K.J),5):g.B(U,jX(p,"musicPlaylist",K.C,X,K.J),6);case 6:return g.B(U,XLn(K.C,X.entityKey),5);case 5:g.U7(U,3);break;case 2:return g.XZ(U),U.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return U.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Q))}})},FO7=function(){i5.apply(this,arguments)},a8j=function(K,X,Q,p){var U,I,d,L,b,S,N,D;
return g.E(function(v){switch(v.C){case 1:U=[],I=g.G(X),d=I.next();case 2:if(d.done){v.ZS(4);break}L=d.value;if(L.upToDate||Q&&!L.shouldAutoSyncMetadata||!L.playlistId){v.ZS(3);break}b={};switch(p){case "mainPlaylistEntity":S={nextAutoRefreshIntervalSeconds:L.checkInSeconds,autoSync:Q};b={mainPlaylistEntityActionMetadata:S};break;case "musicPlaylist":N={autoSync:Q},b={musicPlaylistEntityActionMetadata:N}}return g.B(v,Pa(K,[L.playlistId],p,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",b),6);case 6:(D=
v.j)&&U.push.apply(U,g.gf(D));case 3:d=I.next();v.ZS(2);break;case 4:return v.return(U)}})},mg=function(K,X,Q){g.bS(new g.$X("Woffle: "+K,Q?{cotn:Q}:""));
X instanceof Error&&g.bS(X)},wnj=function(K,X){if(X.length===0)return Promise.resolve([]);
X=X.map(function(Q){return pn(Q)});
return kEC(K.j,X)},V2l=function(){return g.E(function(K){if(K.C==1)return g.B(K,mj7(),2);
if(!K.j)return K.return(void 0);E8K||(E8K=new dgm);return K.return(E8K)})},oX=function(K){g.y.call(this);
var X=this;this.api=K;this.I$={pSq:function(){return X.C},
oMy:function(){return X.j}};
typeof g.RW.BroadcastChannel!=="undefined"&&(this.C=new g.RW.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.P_()),this.C.onmessage=this.J.bind(this),this.j=new g.RW.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.P_()),this.j.onmessage=this.T.bind(this))},ODl=function(K,X){var Q;
return g.E(function(p){return p.C==1?g.B(p,m0J(K,X),2):(Q=p.j)?g.B(p,rj(K,{mode:"readwrite",o$:!0},function(U){var I=[ME(U,Q.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];Q.mainDownloadsListEntity&&I.push(ME(U,Q.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.WN.all(I)}),0):p.ZS(0)})},Obo=function(K,X,Q){var p=MLK(X);
return qtK(K,p).then(function(){return cxJ(K,X,Q)})},VqJ=function(K,X){this.api=K;
this.C=X;this.logger=new g.uB("woffle");this.j=!1;this.I$={Qw:this.Qw}},R$9=function(K,X){var Q,p,U,I,d,L,b,S,N,D;
return g.E(function(v){switch(v.C){case 1:return Q=Kn(X),g.PG(v,2),p=g.Xf(X.entityKey).entityId,p==="!*$_ALL_ENTITIES_!*$"?g.B(v,MR7(K.C,X,K.J,(N=X.actionMetadata)==null?void 0:(D=N.offlineLoggingData)==null?void 0:D.offlineDeleteReason),5):g.B(v,RX(K.C,p),6);case 6:U=v.j;I=g.P(X.actionMetadata,va);if(L=(d=I)==null?void 0:d.playlistId)U.playlistId=L;U.offlineDeleteReason=(b=X.actionMetadata)==null?void 0:(S=b.offlineLoggingData)==null?void 0:S.offlineDeleteReason;return g.B(v,Cn(p,K.C,X,K.J,U),7);
case 7:if(!K.V.K("woffle_enable_main_downloads_library")){v.ZS(5);break}return g.B(v,M4n(K.C,X.entityKey),5);case 5:g.U7(v,3);break;case 2:return g.XZ(v),v.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return v.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q))}})},lKv=function(){var K,X,Q,p,U;
return g.E(function(I){if(I.C==1)return g.B(I,O3(),2);if(I.C!=3)return(K=I.j)?g.B(I,t0(K,"refresh"),3):I.return(!1);X=I.j;if((Q=X[0])==null||!Q.refreshTime)return I.return(!1);p=Number(X[0].refreshTime);U=Date.now()/1E3;return I.return(isFinite(p)&&U>=p)})},K6e=function(K,X,Q){Q=Q===void 0?[]:Q;
var p,U,I,d,L,b,S,N,D,v,n,a,R;return g.E(function(O){if(O.C==1)return Q.length?g.B(O,t0(K,X),2):O.return([]);p=O.j;U=new Set;I=g.G(p);for(d=I.next();!d.done;d=I.next())if(L=d.value,b=L.id||L.key)S=g.Xf(b).entityId,U.add(S);N=[];D=g.G(Q);for(v=D.next();!v.done;v=D.next())n=v.value,a=n.offlineVideoData,R=void 0,((R=a)==null?0:R.videoId)&&!U.has(a.videoId)&&N.push(n);return O.return(N)})},Cvl=function(){i5.apply(this,arguments)},MqJ=function(){Dv.apply(this,arguments)},Zp7=function(K,X){X.length!==0&&
X.forEach(function(Q){Q=tV(Q);
Q.retryScheduleIndex<3&&Djj(K.C,[Q])})},C$m=function(){var K;
return g.E(function(X){return X.C==1?g.B(X,V2l(),2):(K=X.j)?X.return(K.delete("yt-player-local-img")):X.return(!0)})},cNK=function(){var K,X;
return g.E(function(Q){if(Q.C==1)return g.B(Q,g.Wx(),2);if(Q.C!=3){K=Q.j;if(!K)throw g.Wm("rvdfd");return g.B(Q,g.Nl(K),3)}X=Q.j;return Q.return(g.iE(X,["index","media"],{mode:"readwrite",o$:!0},function(p){var U={};return g.OQ(p.objectStore("index"),{},function(I){var d=I.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),L=g.WN.resolve(void 0);if(d){var b=d[1];d=d[2];U[b]=U[b]||{};var S;U[b][d]=g.LjQ((S=I.getValue())==null?void 0:S.fmts)}else L=I.delete().then(function(){});
return g.WN.all([g.si(I),L]).then(function(N){return g.G(N).next().value})}).then(function(){for(var I={},d=g.G(Object.keys(U)),L=d.next();!L.done;L=d.next()){L=L.value;
var b=U[L].v;I[L]=U[L].a&&b?1:2}var S=O1C(I);return g.RuZ(p.objectStore("media"),{},function(N){var D=N.cursor.key.match(g.cqf);D&&I[D[1]]||p.objectStore("media").delete(N.cursor.key);return g.MJS(N)}).then(function(){return S})})}))})},gbz=function(K){var X,Q,p,U;
g.E(function(I){switch(I.C){case 1:if(!K.C){hV(K,"onTransferPausedByUser");I.ZS(2);break}X=K.C;K.T.stop();return g.B(I,Ha(K,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:p=((Q=X)==null?0:Q.key)?g.Xf(X.key).entityId:"";if(!p||!K.J){I.ZS(4);break}return g.B(I,wX(p,K.J,K.j,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.B(I,BY(K,p),6);case 6:U=I.j,ibz({videoId:p,oE:X,offlineModeType:U});case 2:U3(K),IX(K),g.mk(I)}})},WOJ=function(K,X){var Q,p,U,I;
return g.E(function(d){switch(d.C){case 1:return Q=Kn(X),g.PG(d,2),p=g.Xf(X.entityKey).entityId,p==="!*$_ALL_ENTITIES_!*$"?g.B(d,MR7(K.C,X,K.J,(U=X.actionMetadata)==null?void 0:(I=U.offlineLoggingData)==null?void 0:I.offlineDeleteReason),5):g.B(d,Ubn(p,K.C,X,K.J),6);case 6:if(!K.V.K("woffle_enable_main_downloads_library")){d.ZS(5);break}return g.B(d,M4n(K.C,X.entityKey),5);case 5:g.U7(d,3);break;case 2:return g.XZ(d),d.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return d.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q))}})},w92=function(){i5.apply(this,arguments)},sjn=function(){i5.apply(this,arguments)},HA7=function(K,X){return K!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||X?K==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&X?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":K:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},
YCm=function(K,X,Q,p){g.y.call(this);
var U=this;this.j=K;this.api=X;this.vP=Q;this.wf=p;this.L=new g.zO;this.T=new g.Bh(function(){U.C&&U.C.transferState==="TRANSFER_STATE_TRANSFERRING"&&U.L.mE()&&((U.C.transferRetryCount||0)<3?Z9(U.N,U.S,!1,!1):Qu(U.N,U.S.videoDetails.videoId),U.PQ("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.mq=this.fb=0;this.kT=this.W=!1;this.Nw=g.Rn(this.api.B().experiments,"html5_transfer_processing_logs_interval");this.zK=new g.N3(this);this.I$={VeJ:function(){return U.T},
teP:function(){return U.wf},
EY:function(){return U.L}};
this.HP=this.j.observe(this.zY.bind(this));this.N=new VqJ(X,this);this.GK=new VR2(X);this.gf=new lL(this.j);this.Fy=this.L.listen("publicytnetworkstatus-online",this.qk.bind(this));this.Lb=this.L.listen("publicytnetworkstatus-offline",this.DqW.bind(this));this.kT=this.api.B().K("html5_less_transfer_processing_logs");g.k(this,this.zK);this.zK.X(X,"offlinetransferpause",this.ifW);if(g.XJ(this.api.B()))this.J="mainVideoDownloadStateEntity";else if(g.oM(this.api.B())||g.KG(this.api.B()))this.J="musicTrackDownloadMetadataEntity"},
z$n=function(){i5.apply(this,arguments)},fT7=function(K,X,Q,p){var U,I,d,L,b,S,N,D,v,n,a,R,O,A,w,u,h;
return g.E(function(r){switch(r.C){case 1:U=Date.now().toString();Q||(Q=U);I=X.videos;d=X.playlistId;L=[];b=[];if(I)for(S=g.G(I),N=S.next();!N.done;N=S.next()){D=N.value;v=D.offlineVideoData;if(!v||!v.videoId)throw mg("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");n=v.videoId;a={videoId:n,playlistId:d};R={id:g.h9(JSON.stringify(a),"mainPlaylistVideoEntity"),video:g.h9(n,"mainVideoEntity")};L.push(R);b.push(R.id)}A={key:g.h9(d,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:Q,lastSyncedTimestampMillis:U};w={key:g.h9(d,"mainPlaylistEntity"),playlistId:d,videos:b,title:X.title,thumbnailStyleData:b1K(X),visibility:Dzo(X),downloadState:A.key};X.channel&&(u=X.channel.offlineChannelData,O=yOx(g.h9(d,"ytMainChannelEntity"),u),w.channelOwner=O.id);((h=w)==null?0:h.entityMetadata)?(w.entityMetadata.offlineLastModifiedTimestampSeconds=X.lastModifiedTimestamp,p&&(w.entityMetadata.nextAutoRefreshIntervalSeconds=String(p))):w&&(w.entityMetadata={nextAutoRefreshIntervalSeconds:p?
String(p):void 0,offlineLastModifiedTimestampSeconds:X.lastModifiedTimestamp});g.PG(r,2);return g.B(r,rj(K.C,{mode:"readwrite",o$:!0},function(C){var Y=ME(C,w,"mainPlaylistEntity"),l=ME(C,A,"mainPlaylistDownloadStateEntity");Y=[Y,l];l=g.G(L);for(var IS=l.next();!IS.done;IS=l.next())Y.push(ME(C,IS.value,"mainPlaylistVideoEntity"));O&&Y.push(ME(C,O,"ytMainChannelEntity"));return g.WN.all(Y)}),4);
case 4:g.U7(r,3);break;case 2:throw g.XZ(r),mg("PES failure for playlist"),Error("PES failure for playlist");case 3:return r.return({mainPlaylistEntity:w,c0K:O,d4y:L})}})},aSJ=function(K,X,Q,p){p=p===void 0?[]:p;
X={offlineOrchestrationContext:cOm(K,X,Q,p)};X=qy2(3,X);GH7(Y0z(),X,K.rootActionId)},Aqo=function(){i5.apply(this,arguments)},kTK=function(){i5.apply(this,arguments)},sqz=function(){this.C=new Map},cW2=function(K,X){return rj(K,{mode:"readwrite",
o$:!0},function(Q){return ca(Q,X)})},jjl=function(){i5.apply(this,arguments)},mbJ=function(K){var X;
return g.E(function(Q){switch(Q.C){case 1:if(!K.j)return mg("transferManager is undefined"),Q.return();if(K.j.C){Q.ZS(2);break}return g.B(Q,IX(K.j),2);case 2:if(!K.V.K("woffle_enable_main_downloads_library")){Q.ZS(4);break}return g.B(Q,K.dH(),4);case 4:if(!K.V.K("html5_offline_playback_position_sync")){Q.ZS(6);break}return g.B(Q,K.eB(),7);case 7:return g.B(Q,K.gr(864E5),6);case 6:return g.B(Q,K.refreshAllStaleEntities(43200,!0),9);case 9:return g.B(Q,K.dF(),10);case 10:if(!K.V.K("html5_retry_downloads_for_expiration")){Q.ZS(11);
break}return g.B(Q,K.qt(),11);case 11:return K.W=g.iH(function(){K.refreshAllStaleEntities(43200,!0);K.dF()},9E5),g.ES(g.fE(),function(){return K.a6()}),g.B(Q,O3(),13);
case 13:return X=Q.j,g.B(Q,GTn(X),14);case 14:jI2(K.J),g.mk(Q)}})},uZK=function(K,X){var Q,p;
return g.E(function(U){switch(U.C){case 1:return Q=Kn(X),g.B(U,l5(K.C,X.entityKey,"transfer"),2);case 2:if(p=U.j)return U.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q));g.PG(U,3);return g.B(U,fRj(K,X),5);case 5:g.U7(U,4);break;case 3:return g.XZ(U),U.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return U.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Q))}})},h$n=function(){i5.apply(this,arguments)},Djj=function(K,X){X=g.G(X);
for(var Q=X.next();!Q.done;Q=X.next())Q=Q.value,SH3(Q,1),K.actions.push(Q);K.actions.sort(K.C)},H19=function(){i5.apply(this,arguments)},GTn=function(K){var X;
return g.E(function(Q){if(Q.C==1)return g.B(Q,N59(K),2);X=Q.j;g.gN("offlineStateSnapshot",X);g.mk(Q)})},cql=function(){i5.apply(this,arguments)},hV=function(K,X){K.api.Q1("woffle",{mcte:X});
mg("missing current transfer entity.")},O1C=function(K){var X=g.Ya();
X=Object.assign({},X);K=Object.assign({},K);for(var Q in X)K[Q]?(X[Q]!==4&&(X[Q]=K[Q]),delete K[Q]):X[Q]!==2&&(X[Q]=4);Object.assign(X,K);g.eAh(X);JSON.stringify(X);return X},U3=function(K){K.C=void 0;
K.S=void 0;K.T.stop()},Jqx=function(){i5.apply(this,arguments)},kEC=function(K,X){return rj(K,{mode:"readwrite",
o$:!0},function(Q){return NOj(Q,X,"offlineOrchestrationActionWrapperEntity")})},l87=function(K,X,Q,p){var U,I,d,L,b,S,N;
return g.E(function(D){switch(D.C){case 1:return g.B(D,iAm([X]),2);case 2:return U=D.j,g.B(D,fT7(K,U[0],Q,p),3);case 3:return I=D.j,d=I.mainPlaylistEntity,L=I.c0K,S=ISj(d,(b=L)==null?void 0:b.avatar),g.PG(D,4),g.B(D,qU(S),6);case 6:g.U7(D,5);break;case 4:N=g.XZ(D),N instanceof Error&&N.message==="Failed to fetch"&&mg(N.message);case 5:return D.return(U[0].videos)}})},i1C=function(K){var X,Q,p,U,I;
g.E(function(d){switch(d.C){case 1:if(!K.C)return hV(K,"onTransferComplete"),d.return();X=K.C;K.T.stop();if(!X||!K.S){d.ZS(2);break}Q=Llj(K.api.B(),X.cotn,K.S);return g.B(d,bTm(K,Q),2);case 2:return g.B(d,Ha(K,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:U=((p=X)==null?0:p.key)?g.Xf(X.key).entityId:"";if(!U||!K.J){d.ZS(5);break}return g.B(d,wX(U,K.J,K.j,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.B(d,FBz(K.j,U),7);case 7:return g.B(d,BY(K,U),8);case 8:I=d.j,Yv({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:U,oE:X,offlineModeType:I}),U3(K),IX(K),g.mk(d)}})},SCz=function(K,X,Q,p){if(K&&K.streamsProgress){p=K;
a:{X=X.itag+";"+X.xtags;for(var U=K.streamsProgress,I=0;I<U.length;I++){var d=JSON.parse(U[I].formatStreamBytes);if(d.itag+";"+d.xtags===X){U[I]=Q;Q=U;break a}}U.push(Q);Q=U}p.streamsProgress=Q}else K={key:p,streamsProgress:[Q]};return K},M4n=function(K,X){var Q,p,U,I,d,L,b,S,N,D,v,n,a,R,O;
return g.E(function(A){if(A.C==1)return Q=g.h9("main_downloads_library_id","mainDownloadsLibraryEntity"),p=g.h9("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.B(A,rj(K,{mode:"readonly",o$:!0},function(w){return g.WN.all([yR(w,Q,"mainDownloadsLibraryEntity"),yR(w,p,"mainDownloadsListEntity"),yR(w,g.iG,"mainDownloadsListEntity")])}),2);
U=A.j;I=g.G(U);d=I.next().value;L=I.next().value;b=I.next().value;S=d;N=L;D=b;if(!S)return A.ZS(0);if(X===g.iG&&((v=D)==null?0:v.downloads))D.downloads=[];else if((n=N)==null?0:n.downloads)for(a=g.Xf(X).entityType,R=0;R<N.downloads.length;R++)if(O=N.downloads[R],a==="mainVideoEntity"&&O.videoItem===X){N.downloads.splice(R,1);break}else if(a==="mainPlaylistEntity"&&O.playlistItem===X){N.downloads.splice(R,1);break}return g.B(A,rj(K,{mode:"readwrite",o$:!0},function(w){var u=[ME(w,S,"mainDownloadsLibraryEntity")];
N&&u.push(ME(w,N,"mainDownloadsListEntity"));D&&u.push(ME(w,D,"mainDownloadsListEntity"));return g.WN.all(u)}),0)})},KR=function(){},PvJ=function(){i5.apply(this,arguments)},o8l=function(K,X,Q){X=X===void 0?43200:X;
Q=Q===void 0?!0:Q;var p=p===void 0?!1:p;var U,I,d;return g.E(function(L){switch(L.C){case 1:if(!K.L.mE())return L.return([]);U=[];g.PG(L,2);return g.B(L,rRC(X,Q,p),4);case 4:U=L.j;g.U7(L,3);break;case 2:I=g.XZ(L),I instanceof Error&&I.message==="No data"||I instanceof Error&&I.message==="Empty response body"&&mg(I.message);case 3:return d=a8j(K,U,Q,"mainPlaylistEntity"),L.return(d)}})},Z12=function(){Dv.apply(this,arguments)},ygm=function(K,X,Q){var p,U,I,d,L;
return g.E(function(b){if(b.C==1){if(!X.frameworkUpdates||!g.P(X.frameworkUpdates,Yf))return b.return();if(!(g.P(X.frameworkUpdates,Yf).mutations&&g.P(X.frameworkUpdates,Yf).mutations.length>0&&g.P(X.frameworkUpdates,Yf).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return b.ZS(2);p=g.Xf(g.P(X.frameworkUpdates,Yf).mutations[0].entityKey).entityId;return g.B(b,RX(K.C,p),3)}if(b.C!=2){U=b.j;I=g.P(Q.actionMetadata,qE);if(L=(d=I)==null?void 0:d.playlistId)U.playlistId=L;U.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.XJ(K.V)?g.B(b,Cn(p,K.C,Q,K.J,U),2):g.oM(K.V)?g.B(b,NE(p,K.C,Q,K.J),2):b.ZS(2)}return g.B(b,XGz(g.P(X.frameworkUpdates,Yf)),0)})},lL=function(K){g.y.call(this);
this.C=K;this.j=this.C.observe(this.J.bind(this))},g8z=function(){g.cJ.apply(this,arguments);
var K=this;this.events=new g.N3(this);this.V=this.player.B();this.I$={vMq:function(){return K.C},
Ii:function(){return K.Ii()},
BL:function(X){return K.BL(X)}}},iL=function(K,X,Q,p,U,I,d,L,b,S,N){this.entityType=K;
this.actionId=X;this.action=Q;this.parentActionId=p;this.rootActionId=U===void 0?X:U;this.childActionIds=I;this.prereqActionId=d;this.postreqActionIds=L;this.hasChildActionFailed=S;this.retryScheduleIndex=0;this.C=N||Date.now();this.retryScheduleIndex=b||0},yu=function(K){var X;
K.offlineDeleteReason=(X=K.offlineDeleteReason)!=null?X:"OFFLINE_DELETE_REASON_UNKNOWN";var Q;K.offlineModeType=(Q=K.offlineModeType)!=null?Q:"OFFLINE_NOW";g.gN("offlineDeleteEvent",K)},rqx=function(){i5.apply(this,arguments)},yxe=function(K,X){var Q,p,U,I,d,L,b,S,N;
return g.E(function(D){if(D.C==1)return Q=g.h9("music_downloads_library_id","musicDownloadsLibraryEntity"),g.B(D,l5(K,Q,"musicDownloadsLibraryEntity"),2);(p=D.j)||(p={id:Q});U=g.Xf(X).entityType;U==="musicTrack"?(I=p.downloadedTracks)!=null&&I.includes(X)||(p.downloadedTracks=((d=p.downloadedTracks)!=null?d:[]).concat(X)):U==="musicPlaylist"?(L=p.downloadedPlaylists)!=null&&L.includes(X)||(p.downloadedPlaylists=((b=p.downloadedPlaylists)!=null?b:[]).concat(X)):U!=="musicAlbumRelease"||(S=p.downloadedAlbumReleases)!=
null&&S.includes(X)||(p.downloadedAlbumReleases=((N=p.downloadedAlbumReleases)!=null?N:[]).concat(X));return g.B(D,Wa(K,p,"musicDownloadsLibraryEntity"),0)})},X3=function(K){return K.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!K.entityKey},yqo=function(){i5.apply(this,arguments)},tq7=function(){i5.apply(this,arguments)},oOl=function(K,X,Q){X=Llj(K.V,Q.cotn,X);
Q=g.Vb(X);return g.GKZ(X,Q,K.V)},MLK=function(K){K=K.key||K.id;
if(!K)throw Error("Entity key is missing");return K},Bw9=function(K,X){var Q,p;
return g.E(function(U){switch(U.C){case 1:return Q=Kn(X),g.PG(U,2),p=g.Xf(X.entityKey).entityId,p==="!*$_ALL_ENTITIES_!*$"?g.B(U,$f(K.C,X,K.J),5):g.B(U,jX(p,"musicAlbumRelease",K.C,X,K.J),6);case 6:return g.B(U,XLn(K.C,X.entityKey),5);case 5:g.U7(U,3);break;case 2:return g.XZ(U),U.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return U.return(new X9("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Q))}})},HDe=function(K,X){K=K instanceof gj?K:X(K);
g.Mg(K);throw K;};
g.E6.prototype.yB=g.Sz(45,function(K){return this.app.yB(K)});
g.aR.prototype.yB=g.Sz(44,function(K){return g.tgO(this,9,K)});
g.e(i5,Dv);g.RZ.Object.defineProperties(i5.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.C.entityMetadata},
set:function(K){this.C.entityMetadata=K}}});
g.e(HTx,i5);HTx.prototype.j=function(){return[]};
g.e(W2m,i5);W2m.prototype.j=function(){return[]};
g.e(Gnm,i5);Gnm.prototype.j=function(){return[]};
g.e(eI7,i5);eI7.prototype.j=function(){return[]};
g.e(ipv,i5);ipv.prototype.j=function(){return[]};
g.e(AN9,i5);AN9.prototype.j=function(){var K=[];this.C.alternateChannel&&K.push(this.C.alternateChannel);this.C.alternateChannelList&&K.push.apply(K,g.gf(this.C.alternateChannelList));this.C.oneofChannelEntity&&K.push(this.C.oneofChannelEntity);return[].concat(g.gf(new Set(K)))};
g.e(EOe,i5);EOe.prototype.j=function(){var K=[];this.C.entryCollection&&K.push(this.C.entryCollection);return[].concat(g.gf(new Set(K)))};
g.e(Db2,Dv);Db2.prototype.j=function(){var K=[];this.C.video&&K.push(this.C.video);return[].concat(g.gf(new Set(K)))};
g.e(GCj,i5);GCj.prototype.j=function(){var K=[];this.C.parentPlaylist&&K.push(this.C.parentPlaylist);if(this.C.entries)for(var X=g.G(this.C.entries),Q=X.next();!Q.done;Q=X.next())K.push.apply(K,g.gf((new Db2(Q.value)).j()));return[].concat(g.gf(new Set(K)))};
g.e(cql,i5);cql.prototype.j=function(){var K=[];this.C.descriptionEntity&&K.push(this.C.descriptionEntity);this.C.creators&&K.push.apply(K,g.gf(this.C.creators));this.C.theBiggestFan&&K.push(this.C.theBiggestFan);return[].concat(g.gf(new Set(K)))};
g.e(obl,i5);obl.prototype.j=function(){return[]};
g.e(djv,i5);djv.prototype.j=function(){return[]};
g.e(m$n,i5);m$n.prototype.j=function(){return[]};
g.e(X9z,i5);X9z.prototype.j=function(){return[]};
g.e(lSC,i5);lSC.prototype.j=function(){return[]};
g.e(Jqx,i5);Jqx.prototype.j=function(){return[]};
g.e(tq7,i5);tq7.prototype.j=function(){return[]};
g.e(CXe,i5);CXe.prototype.j=function(){return[]};
g.e(Qjx,i5);Qjx.prototype.j=function(){return[]};
g.e(jjl,i5);jjl.prototype.j=function(){var K=[];this.C.downloadsList&&K.push(this.C.downloadsList);this.C.smartDownloadsList&&K.push(this.C.smartDownloadsList);this.C.recommendedDownloadsList&&K.push(this.C.recommendedDownloadsList);this.C.refresh&&K.push(this.C.refresh);return[].concat(g.gf(new Set(K)))};
g.e(Cyx,Dv);Cyx.prototype.j=function(){var K=[];this.C.video&&K.push(this.C.video);this.C.playlist&&K.push(this.C.playlist);this.C.videoItem&&K.push(this.C.videoItem);this.C.playlistItem&&K.push(this.C.playlistItem);return[].concat(g.gf(new Set(K)))};
g.e(pGo,i5);pGo.prototype.j=function(){var K=[];this.C.refresh&&K.push(this.C.refresh);if(this.C.downloads)for(var X=g.G(this.C.downloads),Q=X.next();!Q.done;Q=X.next())K.push.apply(K,g.gf((new Cyx(Q.value)).j()));return[].concat(g.gf(new Set(K)))};
g.e(s6j,i5);s6j.prototype.j=function(){var K=[];this.C.localImageEntities&&K.push.apply(K,g.gf(this.C.localImageEntities));return[].concat(g.gf(new Set(K)))};
g.e(xgx,i5);xgx.prototype.j=function(){var K=[];this.C.playbackData&&K.push(this.C.playbackData);this.C.localImageEntities&&K.push.apply(K,g.gf(this.C.localImageEntities));this.C.videoDownloadContextEntity&&K.push(this.C.videoDownloadContextEntity);return[].concat(g.gf(new Set(K)))};
g.e(ZAe,i5);ZAe.prototype.j=function(){return[]};
g.e(E6C,i5);E6C.prototype.j=function(){var K=[];this.C.fakeChildren&&K.push.apply(K,g.gf(this.C.fakeChildren));return[].concat(g.gf(new Set(K)))};
g.e(Aqo,i5);Aqo.prototype.j=function(){var K=[];this.C.video&&K.push(this.C.video);this.C.playbackData&&K.push(this.C.playbackData);this.C.offlineVideoPolicy&&K.push(this.C.offlineVideoPolicy);return[].concat(g.gf(new Set(K)))};
g.e(H2v,i5);H2v.prototype.j=function(){return[]};
g.e(Rte,i5);Rte.prototype.j=function(){var K=[];this.C.channelOwner&&K.push(this.C.channelOwner);this.C.videos&&K.push.apply(K,g.gf(this.C.videos));this.C.collaboratorChannels&&K.push.apply(K,g.gf(this.C.collaboratorChannels));this.C.downloadState&&K.push(this.C.downloadState);this.C.refresh&&K.push(this.C.refresh);return[].concat(g.gf(new Set(K)))};
g.e(e7K,i5);e7K.prototype.j=function(){var K=[];this.C.video&&K.push(this.C.video);this.C.channelContributor&&K.push(this.C.channelContributor);return[].concat(g.gf(new Set(K)))};
g.e(MqJ,Dv);MqJ.prototype.j=function(){var K=[];this.C.localImageEntities&&K.push.apply(K,g.gf(this.C.localImageEntities));this.C.videoDownloadContextEntity&&K.push(this.C.videoDownloadContextEntity);return[].concat(g.gf(new Set(K)))};
g.e(Z12,Dv);Z12.prototype.j=function(){var K=[];this.C.recommendedVideoMetadata&&K.push.apply(K,g.gf((new MqJ(this.C.recommendedVideoMetadata)).j()));return[].concat(g.gf(new Set(K)))};
g.e(q0K,Dv);q0K.prototype.j=function(){var K=[];this.C.playbackPosition&&K.push(this.C.playbackPosition);return[].concat(g.gf(new Set(K)))};
g.e(Y49,i5);Y49.prototype.j=function(){var K=[];this.C.owner&&K.push(this.C.owner);this.C.downloadState&&K.push(this.C.downloadState);this.C.userState&&K.push.apply(K,g.gf((new q0K(this.C.userState)).j()));this.C.additionalMetadata&&K.push.apply(K,g.gf((new Z12(this.C.additionalMetadata)).j()));return[].concat(g.gf(new Set(K)))};
g.e(XSe,i5);XSe.prototype.j=function(){var K=[];this.C.userChannelDetails&&K.push(this.C.userChannelDetails);return[].concat(g.gf(new Set(K)))};
g.e(kTK,i5);kTK.prototype.j=function(){var K=[];this.C.channelOwner&&K.push(this.C.channelOwner);this.C.playbackPosition&&K.push(this.C.playbackPosition);this.C.localImageEntities&&K.push.apply(K,g.gf(this.C.localImageEntities));this.C.downloadStatus&&K.push(this.C.downloadStatus);return[].concat(g.gf(new Set(K)))};
g.e(yWJ,i5);yWJ.prototype.j=function(){return[]};
g.e(EFK,i5);EFK.prototype.j=function(){return[]};
g.e(s_j,i5);s_j.prototype.j=function(){return[]};
g.e(qHo,i5);qHo.prototype.j=function(){return[]};
g.e(Fll,i5);Fll.prototype.j=function(){return[]};
g.e(JRo,i5);JRo.prototype.j=function(){return[]};
g.e(DDx,i5);DDx.prototype.j=function(){return[]};
g.e(PvJ,i5);PvJ.prototype.j=function(){return[]};
g.e(PCj,i5);PCj.prototype.j=function(){return[]};
g.e(Py9,i5);Py9.prototype.j=function(){return[]};
g.e(htC,i5);htC.prototype.j=function(){return[]};
g.e(tOx,i5);tOx.prototype.j=function(){return[]};
g.e(w92,i5);w92.prototype.j=function(){return[]};
g.e(j_z,i5);j_z.prototype.j=function(){var K=[];this.C.compositeSourceKeys&&K.push.apply(K,g.gf(this.C.compositeSourceKeys));return[].concat(g.gf(new Set(K)))};
g.e(bbx,i5);bbx.prototype.j=function(){var K=[];this.C.trackDownloadMetadatas&&K.push.apply(K,g.gf(this.C.trackDownloadMetadatas));return[].concat(g.gf(new Set(K)))};
g.e(uNK,i5);
uNK.prototype.j=function(){var K=[];this.C.downloadedTracks&&K.push.apply(K,g.gf(this.C.downloadedTracks));this.C.smartDownloadedTracks&&K.push.apply(K,g.gf(this.C.smartDownloadedTracks));this.C.downloadedEpisodes&&K.push.apply(K,g.gf(this.C.downloadedEpisodes));this.C.downloadedAlbumReleases&&K.push.apply(K,g.gf(this.C.downloadedAlbumReleases));this.C.smartDownloadedAlbumReleases&&K.push.apply(K,g.gf(this.C.smartDownloadedAlbumReleases));this.C.downloadedPlaylists&&K.push.apply(K,g.gf(this.C.downloadedPlaylists));this.C.smartDownloadedPlaylists&&
K.push.apply(K,g.gf(this.C.smartDownloadedPlaylists));this.C.metadataOnlyTracks&&K.push.apply(K,g.gf(this.C.metadataOnlyTracks));return[].concat(g.gf(new Set(K)))};
g.e(T$K,i5);T$K.prototype.j=function(){var K=[];this.C.trackDownloadMetadatas&&K.push.apply(K,g.gf(this.C.trackDownloadMetadatas));return[].concat(g.gf(new Set(K)))};
g.e(kMJ,i5);kMJ.prototype.j=function(){var K=[];this.C.playbackData&&K.push(this.C.playbackData);this.C.localImageEntities&&K.push.apply(K,g.gf(this.C.localImageEntities));this.C.videoDownloadContextEntity&&K.push(this.C.videoDownloadContextEntity);return[].concat(g.gf(new Set(K)))};
g.e(CDv,i5);CDv.prototype.j=function(){var K=[];this.C.musicLibraryStatusEntity&&K.push(this.C.musicLibraryStatusEntity);this.C.primaryArtists&&K.push.apply(K,g.gf(this.C.primaryArtists));this.C.details&&K.push(this.C.details);this.C.userDetails&&K.push(this.C.userDetails);this.C.tracks&&K.push.apply(K,g.gf(this.C.tracks));this.C.share&&K.push(this.C.share);this.C.downloadMetadata&&K.push(this.C.downloadMetadata);this.C.refresh&&K.push(this.C.refresh);return[].concat(g.gf(new Set(K)))};
g.e(etj,i5);etj.prototype.j=function(){var K=[];this.C.albumRelease&&K.push(this.C.albumRelease);this.C.tracks&&K.push.apply(K,g.gf(this.C.tracks));return[].concat(g.gf(new Set(K)))};
g.e(nOJ,i5);nOJ.prototype.j=function(){var K=[];this.C.albumRelease&&K.push(this.C.albumRelease);return[].concat(g.gf(new Set(K)))};
g.e(iDn,i5);iDn.prototype.j=function(){var K=[];this.C.details&&K.push(this.C.details);this.C.userDetails&&K.push(this.C.userDetails);return[].concat(g.gf(new Set(K)))};
g.e(Xn9,i5);Xn9.prototype.j=function(){var K=[];this.C.parentArtist&&K.push(this.C.parentArtist);return[].concat(g.gf(new Set(K)))};
g.e(BzC,i5);BzC.prototype.j=function(){var K=[];this.C.parentArtist&&K.push(this.C.parentArtist);return[].concat(g.gf(new Set(K)))};
g.e(h$n,i5);h$n.prototype.j=function(){return[]};
g.e(KlC,i5);KlC.prototype.j=function(){return[]};
g.e(bA9,Dv);bA9.prototype.j=function(){var K=[];this.C.creatorEntity&&K.push(this.C.creatorEntity);return[].concat(g.gf(new Set(K)))};
g.e(Rqj,i5);
Rqj.prototype.j=function(){var K=[];this.C.tracks&&K.push.apply(K,g.gf(this.C.tracks));this.C.refresh&&K.push(this.C.refresh);this.C.musicLibraryStatusEntity&&K.push(this.C.musicLibraryStatusEntity);this.C.details&&K.push(this.C.details);this.C.downloadMetadata&&K.push(this.C.downloadMetadata);this.C.sideloadMetadata&&K.push(this.C.sideloadMetadata);this.C.userDetails&&K.push(this.C.userDetails);this.C.entryCollection&&K.push(this.C.entryCollection);this.C.share&&K.push(this.C.share);this.C.podcastShowAdditionalMetadata&&
K.push.apply(K,g.gf((new bA9(this.C.podcastShowAdditionalMetadata)).j()));return[].concat(g.gf(new Set(K)))};
g.e(eqo,i5);eqo.prototype.j=function(){return[]};
g.e(nFn,i5);
nFn.prototype.j=function(){var K=[];this.C.musicLibraryStatusEntity&&K.push(this.C.musicLibraryStatusEntity);this.C.artists&&K.push.apply(K,g.gf(this.C.artists));this.C.audioModeVersion&&K.push(this.C.audioModeVersion);this.C.videoModeVersion&&K.push(this.C.videoModeVersion);this.C.userDetails&&K.push(this.C.userDetails);this.C.details&&K.push(this.C.details);this.C.albumRelease&&K.push(this.C.albumRelease);this.C.share&&K.push(this.C.share);this.C.libraryEdit&&K.push(this.C.libraryEdit);this.C.downloadMetadata&&
K.push(this.C.downloadMetadata);this.C.playbackPosition&&K.push(this.C.playbackPosition);this.C.lyrics&&K.push(this.C.lyrics);return[].concat(g.gf(new Set(K)))};
g.e(OTK,i5);OTK.prototype.j=function(){var K=[];this.C.parentTrack&&K.push(this.C.parentTrack);return[].concat(g.gf(new Set(K)))};
g.e(QqJ,i5);QqJ.prototype.j=function(){var K=[];this.C.parentTrack&&K.push(this.C.parentTrack);return[].concat(g.gf(new Set(K)))};
g.e(FO7,i5);FO7.prototype.j=function(){return[]};
g.e(tLl,i5);tLl.prototype.j=function(){return[]};
g.e(PD3,i5);PD3.prototype.j=function(){return[]};
g.e(T52,i5);T52.prototype.j=function(){return[]};
g.e(L2J,i5);L2J.prototype.j=function(){var K=[];this.C.transfer&&K.push(this.C.transfer);this.C.adsPlaybackData&&K.push.apply(K,g.gf(this.C.adsPlaybackData));this.C.drmLicense&&K.push(this.C.drmLicense);this.C.offlineVideoPolicy&&K.push(this.C.offlineVideoPolicy);this.C.videoDownloadContextEntity&&K.push(this.C.videoDownloadContextEntity);return[].concat(g.gf(new Set(K)))};
g.e(qCv,i5);qCv.prototype.j=function(){return[]};
g.e(u57,i5);u57.prototype.j=function(){var K=[];this.C.offlineVideoStreams&&K.push.apply(K,g.gf(this.C.offlineVideoStreams));this.C.captionTrack&&K.push.apply(K,g.gf(this.C.captionTrack));return[].concat(g.gf(new Set(K)))};
g.e(xb2,i5);xb2.prototype.j=function(){return[]};
g.e(h7j,i5);h7j.prototype.j=function(){return[]};
g.e(fSo,i5);fSo.prototype.j=function(){return[]};
g.e(Syv,i5);Syv.prototype.j=function(){return[]};
g.e(Zbe,i5);Zbe.prototype.j=function(){return[]};
g.e(wGo,i5);wGo.prototype.j=function(){return[]};
g.e(Bqv,i5);Bqv.prototype.j=function(){return[]};
g.e(sjn,i5);sjn.prototype.j=function(){return[]};
g.e(BOv,i5);BOv.prototype.j=function(){return[]};
g.e(yqo,i5);yqo.prototype.j=function(){return[]};
g.e(Gh3,i5);Gh3.prototype.j=function(){return[]};
g.e(Wl7,i5);Wl7.prototype.j=function(){return[]};
g.e(Jgm,i5);Jgm.prototype.j=function(){return[]};
g.e(Cvl,i5);Cvl.prototype.j=function(){return[]};
g.e(H19,i5);H19.prototype.j=function(){return[]};
g.e(M2n,i5);M2n.prototype.j=function(){return[]};
g.e(knv,i5);knv.prototype.j=function(){return[]};
g.e(gwz,i5);gwz.prototype.j=function(){return[]};
g.e(z$n,i5);z$n.prototype.j=function(){return[]};
g.e(rqx,i5);rqx.prototype.j=function(){return[]};
g.e(t4J,i5);t4J.prototype.j=function(){return[]};
g.e(I82,i5);I82.prototype.j=function(){return[]};
var gFo=["browse","music/browse","streaming_browse","unplugged/browse"],IT7=["offline/playlist_sync_check"],KMm=["offline"],S0m=["offline/offline_video_playback_position_sync"],K2z=["offline/get_playback_data_entity"],xf;Vu.getInstance=function(){return g.E(function(K){return K.return(new Promise(function(X){g.Wx().then(function(Q){Q?(Vu.instance||(Vu.instance=new Vu(Q)),X(Vu.instance)):X(void 0)})}))})};
Vu.prototype.get=function(K){var X=this,Q,p,U;return g.E(function(I){if(I.C==1)return g.B(I,rWn(X.token),2);if(I.C!=3)return Q=I.j,g.B(I,Q.get("prefs",K),3);p=I.j;if(!p)return I.return();U=(0,g.Wh)();return p.expirationTimestampMs<=U?I.return():I.return(p.value)})};
Vu.prototype.set=function(K,X,Q){Q=Q===void 0?31536E3:Q;var p=this,U,I,d;return g.E(function(L){if(L.C==1)return U=(0,g.Wh)(),I={key:K,value:X,expirationTimestampMs:U+Q*1E3},g.B(L,rWn(p.token),2);d=L.j;return g.B(L,g.bW(d,"prefs",I),0)})};
Vu.prototype.remove=function(K){var X=this,Q;return g.E(function(p){if(p.C==1)return g.B(p,rWn(X.token),2);Q=p.j;return g.B(p,Q.delete("prefs",K),0)})};
g.e(gj,g.$X);g.e(oi,zqm);oi.prototype.J=function(K,X){X=BB7(X);K=(new TextEncoder).encode(JSON.stringify(K));return this.C.encrypt(K,X)};
oi.prototype.j=function(K,X){if(!(K instanceof Uint8Array))throw F6e(1);var Q=new TextDecoder;X=BB7(X);K=this.C.decrypt(K,X);return JSON.parse(Q.decode(K))};
var JxK={accountLinkStatusEntity:m$n,booleanEntity:eI7,buttonEntity:H19,captionTrack:FO7,channelHandle:HTx,chipEntity:Bqv,commerceAcquisitionClientPayloadEntity:knv,commerceCartListEntity:gwz,compositeSourceEntity:w92,multiviewStagingEntity:j_z,contextNoteFeedEntityPayload:W2m,contextNoteUserRatingEntityPayload:Gnm,continuationTokenEntity:H2v,downloadQualityPickerEntity:tq7,downloadsPageRefreshTokenEntity:Qjx,downloadsPageViewConfigurationEntity:yWJ,downloadStatusEntity:CXe,dismissState:sjn,sfvAudioItemCurrentlyPlayingEntity:Syv,
emojiFountainDataEntity:Jgm,emojiCustomizationSetEntity:Wl7,fakeChannel:AN9,fakePlaylist:EOe,fakePlaylistEntryCollection:GCj,fakeVideo:cql,fakeVideoDescription:obl,featuredProductsEntity:Py9,flowStateEntity:djv,iconBadgeEntity:z$n,interstitialInteractionStateEntity:lSC,likeButtonAnimationEntity:EFK,liveChatPollStateEntity:Jqx,dataFreshnessEntity:Gh3,liveViewerLeaderboardChatEntryPointStateEntity:h7j,liveViewerLeaderboardPointsEntity:fSo,liveReactionsDataEntity:Cvl,logoEntity:X9z,macroMarkerEntity:s_j,
mainDownloadsLibraryEntity:jjl,mainDownloadsListEntity:pGo,mainPlaylistDownloadStateEntity:s6j,mainPlaylistEntity:Rte,mainPlaylistVideoEntity:e7K,mainVideoDownloadStateEntity:xgx,mainVideoEntity:Y49,markersEngagementPanelSyncEntity:qHo,markersVisibilityOverrideEntity:Fll,musicAlbumReleaseDetail:etj,musicAlbumReleaseDownloadMetadataEntity:bbx,musicAlbumRelease:CDv,musicAlbumReleaseUserDetail:nOJ,musicArtistDetail:Xn9,musicArtist:iDn,musicArtistUserDetail:BzC,musicDownloadsLibraryEntity:uNK,musicLibraryEdit:h$n,
musicLibraryStatusEntity:KlC,musicPlaylist:Rqj,musicPlaylistDownloadMetadataEntity:T$K,musicShare:eqo,musicTrackDetail:OTK,musicTrackDownloadMetadataEntity:kMJ,musicTrack:nFn,musicTrackUserDetail:QqJ,offlineOrchestrationActionWrapperEntity:tLl,offlineVideoPolicy:PD3,offlineVideoStreams:T52,offlineabilityEntity:ZAe,orchestrationWebSamplingEntity:E6C,pageHeaderEntity:BOv,pdpStateEntity:rqx,pinnedProductEntity:htC,playbackData:L2J,playerStateEntity:JRo,quantityIncrementerEntity:t4J,refresh:qCv,saveToPlaylistListEntity:Zbe,
selectedChipIndexEntityPayload:DDx,settingEntity:wGo,stringEntity:ipv,suggestedFeedbackChipStateEntity:PvJ,transfer:u57,trendingOfferEntity:tOx,videoDownloadContextEntity:xb2,videoOverviewAsyncDataEntity:I82,videoPlaybackPositionEntity:M2n,votingEntity:yqo,ytMainChannelEntity:XSe,youchatPendingResponseEntity:PCj,ytMainDownloadedVideoEntity:Aqo,ytMainVideoEntity:kTK};g.e(xv,zqm);xv.prototype.J=function(K){return K};
xv.prototype.j=function(K){if(K instanceof Uint8Array)throw F6e(0);return K};
g.e(JV,g.y);JV.prototype.observe=function(K){var X=this;this.observers.push(K);return function(){var Q=X.observers.indexOf(K);Q>=0&&X.observers.splice(Q,1)}};
JV.prototype.j=function(K){pSn(this,K.data)};
JV.prototype.sJ=function(){this.channel.close()};
var EwK,Nw2=new g.E1("elementsCommand");var Yf=new g.E1("entityBatchUpdate");var PBn=new g.E1("downloadStatusEntity");var tRK=new g.E1("mainPlaylistEntityActionMetadata");var va=new g.E1("mainVideoEntityActionMetadata");var n6e=new g.E1("musicPlaylistEntityActionMetadata");var wbn=new g.E1("musicTrackEntityActionMetadata");var WMx=new g.E1("localImageEntityActionMetadata");var qE=new g.E1("playbackDataActionMetadata");var h2n=new g.E1("transferEntityActionMetadata");var dzC=new g.E1("videoPlaybackPositionEntityActionMetadata");var wSz;new g.ob;new g.ob;Qal.prototype.request=function(K,X,Q){X=X===void 0?{}:X;return this.locks.request(K,X,function(p){return Q(p)})};var fn=g.RW.caches,zl,E8K;KR.prototype.open=function(K){return fn.open(ZDJ(K))};
KR.prototype.has=function(K){return fn.has(ZDJ(K))};
KR.prototype.delete=function(K){return fn.delete(ZDJ(K))};
KR.prototype.match=function(K,X){var Q=this,p,U,I,d,L,b;return g.E(function(S){switch(S.C){case 1:return g.B(S,Q.keys(),2);case 2:p=S.j,U=g.G(p),I=U.next();case 3:if(I.done){S.ZS(5);break}d=I.value;return g.B(S,Q.open(d),6);case 6:return L=S.j,g.B(S,L.match(K,X),7);case 7:if(b=S.j)return S.return(b);I=U.next();S.ZS(3);break;case 5:return S.return()}})};
g.e(dgm,KR);dgm.prototype.keys=function(){var K,X,Q,p,U,I,d,L,b;return g.E(function(S){if(S.C==1)return K=[],X=g.P_("CacheStorage keys"),g.B(S,fn.keys(),2);Q=S.j;p=g.G(Q);for(U=p.next();!U.done;U=p.next()){I=U.value;var N=I.indexOf(":");d=N===-1?{Bu:I}:{Bu:I.substring(0,N),datasyncId:I.substring(N+1)};L=d.Bu;b=d.datasyncId;b===X&&K.push(L)}return S.return(K)})};g.e(oX,g.y);oX.prototype.J=function(K){this.api.BP("onOfflineOperationFailure",K.data)};
oX.prototype.T=function(K){this.api.publish("offlinetransferpause",K.data)};
oX.prototype.sJ=function(){var K;(K=this.C)==null||K.close();var X;(X=this.j)==null||X.close()};GEj.prototype.nw=function(){this.C&&PY(this)};
GEj.prototype.uM=function(){this.j&&this.j.resolve();this.J=this.C=!1;this.kT()};var oFx=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var RIJ="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var AOJ="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.e(YH3,Tl);YH3.prototype.j=function(K){return X3(K)?n8j(this,K):m7(K)?t2e(this,K):Promise.reject(Error("Unsupported action type: "+K.actionType))};g.e(fK3,Tl);fK3.prototype.j=function(K){return m7(K)?mge(this,K):PXm(K)?Tw3(this,K):aX(K)?JW3(this,K):Promise.reject(Error("Unsupported action type: "+K.actionType))};g.F=VqJ.prototype;g.F.P8J=function(K){var X=this,Q,p,U,I;return g.E(function(d){if(!g.Z(K.state,128))return d.ZS(0);Q=K.state.SP;var L=(p=Q)==null?void 0:p.errorCode,b=(U=Q)==null?void 0:U.FA;I=L==="net.connect"&&b===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(L==null?0:L.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.B(d,X.PQ(X.player.getVideoData().videoId,I),0)})};
g.F.PQ=function(K,X){var Q=this;return g.E(function(p){if(p.C==1){if(Q.j)return p.return();Q.j=!0;return X==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(Z9(Q,K,!1,!0),p.ZS(0)):g.B(p,Qu(Q,K),3)}g.Wi(K,4);return g.B(p,Q.C.PQ(X),0)})};
g.F.GJ=function(K){K.status===2?(K.status!==this.J&&(d$n(this.C),g.Wi(K.videoId,2)),K.cH&&jqx(this.C,K.videoId,K.cH)):K.status===4?(Qu(this,K.videoId),this.PQ(K.videoId,K.gy?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):K.status===1&&i1C(this.C);this.J=K.status;this.api.BP("localmediachange",{videoId:K.videoId,status:K.status})};
g.F.Rj=function(){var K=this,X;return g.E(function(Q){if(Q.C==1){if(K.j)return Q.return();K.j=!0;X=K.player.getVideoData().videoId;return g.B(Q,Qu(K,X),2)}return g.B(Q,K.C.Rj(),0)})};
g.F.Qw=function(K){switch(K){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.F.K=function(K){return this.api.B().K(K)};g.e(Dg9,Tl);Dg9.prototype.j=function(K){return X3(K)?uZK(this,K):m7(K)?Ag9(this,K):PXm(K)?V5e(this,K):Promise.reject(Error("Unsupported action type: "+K.actionType))};Ugj.prototype.C=function(K,X){var Q=K.action.actionMetadata.priority-X.action.actionMetadata.priority;Q===0&&(K.C<X.C?Q=-1:K.C>X.C&&(Q=1));return Q};g.e(eX,g.y);eX.prototype.sJ=function(){this.kT&&this.kT();g.y.prototype.sJ.call(this)};
eX.prototype.createAction=function(K,X){var Q=g.Xf(K.entityKey).entityType,p=g.Oo(16);return new iL(Q,p,K,X.actionId,X.rootActionId)};
eX.prototype.wf=function(K){var X=this,Q,p,U,I,d,L,b,S,N;return g.E(function(D){if(D.C==1){if(X.lq())return D.return();p=(Q=K.offlineOrchestrationActionWrapperEntity)!=null?Q:new Set;U=[];I=g.G(p);for(d=I.next();!d.done;d=I.next())L=d.value,b=g.Xf(L),S=b.entityId,JOm(X.C,S)||U.push(L);return g.B(D,P$9(X,U),2)}N=D.j;return g.B(D,ezm(X,N),0)})};
eX.prototype.retry=function(){var K=this;return g.E(function(X){return g.B(X,o6m(K),0)})};VR2.prototype.SI=function(K,X){X=X===void 0?!0:X;var Q=this,p,U,I,d,L,b,S,N;return g.E(function(D){switch(D.C){case 1:if(!Q.C)return D.return();p=[];U=g.yE(Q.C.C,X);I=[];for(d={iL:0};d.iL<U.length;d={iL:d.iL},d.iL++)L=U[d.iL],b=Q.C.MW(L,"json3"),S=g.gU(b,{withCredentials:!0,format:"RAW"},3,500).then(function(v){return function(n){n={metadata:g.wx(U[v.iL]),trackData:n.xhr.responseText};I.push(n)}}(d)).n7(function(v){mg("Caption fetch error",v)}),p.push(S);
return g.B(D,Axz(p),2);case 2:return g.PG(D,3),g.B(D,R2m(K,I),5);case 5:g.U7(D,0);break;case 3:N=g.XZ(D),mg("Caption DB transaction error",N),g.mk(D)}})};g.e(lL,g.y);lL.prototype.sJ=function(){this.j&&this.j();g.y.prototype.sJ.call(this)};
lL.prototype.J=function(K){var X=this,Q,p,U,I,d,L,b,S;return g.E(function(N){p=(Q=K.transfer)!=null?Q:new Set;U=[];I=g.G(p);for(d=I.next();!d.done;d=I.next())L=d.value,b=g.Xf(L),S=b.entityId,U.push(S);return U.length===0?N.return():g.B(N,JNl(X,U),0)})};g.e(YCm,g.y);g.F=YCm.prototype;g.F.sJ=function(){this.HP&&this.HP();this.gf.dispose();this.T.dispose();this.Fy&&g.PS(this.L.eX,this.Fy);this.Lb&&g.PS(this.L.eX,this.Lb);g.y.prototype.sJ.call(this)};
g.F.ifW=function(K){var X=this,Q,p,U;return g.E(function(I){switch(I.C){case 1:Q=g.h9(K,"transfer");if(X.C&&Q===X.C.key){Z9(X.N,X.S,!0);X.T.stop();I.ZS(0);break}return g.B(I,rj(X.j,{mode:"readwrite",o$:!0},function(d){return yR(d,Q,"transfer").then(function(L){if(L&&L.transferState!=="TRANSFER_STATE_COMPLETE"&&L.transferState!=="TRANSFER_STATE_FAILED")return L.transferState="TRANSFER_STATE_PAUSED_BY_USER",ME(d,L,"transfer").then(function(){return L})})}),3);
case 3:p=I.j;if(!p){I.ZS(0);break}if(!K||!X.J){I.ZS(5);break}return g.B(I,wX(K,X.J,X.j,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.B(I,BY(X,K),7);case 7:U=I.j,ibz({videoId:K,oE:p,offlineModeType:U}),g.mk(I)}})};
g.F.DqW=function(){var K=this;if(this.C&&this.S){Z9(this.N,this.S,!1);var X=this.C,Q=(X==null?0:X.key)?g.Xf(X.key).entityId:"";Q&&this.J&&(new Promise(function(p,U){wX(Q,K.J,K.j,"DOWNLOAD_STATE_PAUSED").catch(function(I){U(I)})})).catch(function(p){mg("Download state setting error",p)})}this.T.stop()};
g.F.qk=function(){this.C?$$j(this,this.C):IX(this)};
g.F.zY=function(K){var X=this;return g.E(function(Q){switch(Q.C){case 1:if(!X.C){Q.ZS(2);break}if(X.C.transferState==="TRANSFER_STATE_COMPLETE"||X.C.transferState==="TRANSFER_STATE_FAILED"||!K.transfer||!K.transfer.has(X.C.key)){Q.ZS(3);break}return g.B(Q,l5(X.j,X.C.key,"transfer"),4);case 4:X.C=Q.j;if(X.C){Q.ZS(3);break}return g.B(Q,M53(X),3);case 3:if(X.C)return Q.return();case 2:return g.B(Q,IX(X),0)}})};
g.F.PQ=function(K,X){var Q=this,p,U,I,d,L;return g.E(function(b){switch(b.C){case 1:if(!Q.C){hV(Q,"onTransferFailure: "+K);b.ZS(2);break}p=Q.C;I=((U=p)==null?0:U.key)?g.Xf(p.key).entityId:"";a:switch(K){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var S=!1;break a;default:S=!0}return S&&hz2(Q)?g.B(b,Ha(Q,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.B(b,
$zj(Q,K),5);case 5:if(!I||!Q.J){b.ZS(2);break}return g.B(b,wX(I,Q.J,Q.j,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.B(b,BY(Q,I),9);case 9:d=b.j;Yv({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:I,oE:p,offlineModeType:d});if(!I||!Q.J){b.ZS(2);break}return g.B(b,wX(I,Q.J,Q.j,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:U3(Q),L=IX(Q,!0),X&&X(L),g.mk(b)}})};
g.F.Rj=function(K){var X=this,Q,p,U,I,d,L,b,S,N,D,v,n;return g.E(function(a){switch(a.C){case 1:if(!X.C){hV(X,"onMaybeTransferStreamsExpired");a.ZS(2);break}return hz2(X)?g.B(a,Ha(X,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.B(a,$zj(X,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!X.J){a.ZS(2);break}Q=X.C;U=((p=Q)==null?0:p.key)?g.Xf(Q.key).entityId:"";if(!U){a.ZS(2);break}return g.B(a,wX(U,X.J,X.j,"DOWNLOAD_STATE_FAILED"),2);case 9:return X.C||hV(X,"onMaybeTransferStreamsExpiredRetryAttempting"),
I=X.C,L=((d=I)==null?0:d.key)?g.Xf(I.key).entityId:"",g.B(a,BY(X,L),10);case 10:return b=a.j,Yv({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:L,oE:I,offlineModeType:b}),S=AWe(),g.$l(S,qE,{isEnqueuedForExpiredStreamUrlRefetch:!0}),N=g.h9(L,"playbackData"),D={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:N,actionMetadata:S},v=pn(new iL("playbackData",L,D)),g.B(a,Wa(X.j,v,"offlineOrchestrationActionWrapperEntity"),2);case 2:U3(X),n=IX(X,!0),
K&&K(n),g.mk(a)}})};
var YFz={},x09=(YFz.TRANSFER_STATE_TRANSFERRING=1,YFz.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,YFz);g.F=F9.prototype;g.F.aQ=function(){return this.S.promise};
g.F.UW=function(){if(this.j&&this.N)return this.S.promise;e2l(this).then(this.S.resolve).catch(this.S.reject);return this.S.promise};
g.F.Sl=function(K){var X={};return X.playbackData=new YH3(K,this.V,this.C),X.transfer=new Dg9(K,this.V),X.videoPlaybackPositionEntity=new fK3(K,this.V),X};
g.F.a6=function(){var K=this;return g.E(function(X){return K.j?g.B(X,i2e(K.j),0):X.ZS(0)})};
g.F.I6=function(){var K=this,X,Q;return g.E(function(p){if(p.C==1)return K.j||K.N?g.B(p,K.aQ(),2):p.return();K.W!==void 0&&(g.MX(K.W),K.W=void 0);K.T!==void 0&&(g.MX(K.T),K.T=void 0);(X=K.j)==null||X.dispose();K.j=void 0;(Q=K.N)==null||Q.dispose();K.N=void 0;K.api.BP("onOrchestrationLostLeader");K.S=new g.ob;g.mk(p)})};
g.F.isOrchestrationLeader=function(){return this.J.C};
g.F.Te=function(){return g.E(function(K){return K.return(!1)})};
g.F.Sg=function(K){var X=this.C;X.api.publish("offlinetransferpause",K);var Q;(Q=X.j)==null||Q.postMessage(K)};
g.F.qk=function(K){var X,Q;return g.E(function(p){if(p.C==1)return g.B(p,O3(),2);X=p.j;if(!X)return p.return();Q=g.h9(K,"transfer");return g.B(p,rj(X,{mode:"readwrite",o$:!0},function(U){var I=yR(U,Q,"transfer"),d=yR(U,g.h9(K,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.WN.all([I,d]).then(function(L){L=g.G(L);var b=L.next().value;var S=L.next().value;return b&&b.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(b.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",ME(U,b,"transfer").then(function(){Yv({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:K,oE:b,offlineModeType:S==null?void 0:S.offlineModeType});return g.WN.resolve(null)})):g.WN.resolve(null)})}),0)})};
g.F.MY=function(K){K=K===void 0?43200:K;var X=this,Q,p,U,I,d,L,b,S;return g.E(function(N){if(N.C==1)return X.L.mE()?g.B(N,O3(),2):N.return(usn());if(N.C!=3){Q=N.j;if(!Q)return N.return([]);p=Date.now()/1E3;return g.B(N,t0(Q,"offlineVideoPolicy"),3)}U=N.j;I=[];d=g.G(U);for(L=d.next();!L.done;L=d.next())b=L.value,Number(b.lastUpdatedTimestampSeconds)+K<=p&&(S=g.Xf(b.key).entityId,I.push(S));return I.length?N.return(Pa(X,I,X.kT,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):N.return([])})};
g.F.deleteAll=function(){return Pa(this,["!*$_ALL_ENTITIES_!*$"],this.kT,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.F.refreshAllStaleEntities=function(K){var X=this;return g.E(function(Q){return Q.C==1?g.B(Q,X.MY(K),2):Q.return(Q.j)})};
g.F.setUpPositionSyncInterval=function(K){var X=this;this.T!==void 0&&(g.MX(this.T),this.T=void 0);var Q=K!=null?K:864E5;this.T=g.iH(function(){X.gr(Q)},Q)};
g.F.gr=function(K){var X=this,Q,p,U,I,d,L;return g.E(function(b){switch(b.C){case 1:return g.PG(b,2),g.B(b,Vu.getInstance(),4);case 4:Q=b.j;if(!Q)throw Error("prefStorage is undefined");return g.B(b,Q.get("psi"),5);case 5:p=b.j;I=((U=p)==null?0:U.EZ)?Number(p.EZ)/1E3:0;d=Date.now();if(!(I+K<=d)){b.ZS(6);break}return g.B(b,Pa(X,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.U7(b,0);break;case 2:L=g.XZ(b),mg("Offline manager error",L),
g.mk(b)}})};
g.F.qt=function(){var K=this,X,Q,p,U,I,d,L;return g.E(function(b){if(b.C==1)return g.B(b,O3(),2);if(b.C!=3)return(X=b.j)?g.B(b,t0(X,"transfer"),3):b.return([]);Q=b.j;p=[];U=g.G(Q);for(I=U.next();!I.done;I=U.next())d=I.value,d.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&d.key&&(L=g.Xf(d.key).entityId,p.push(L));return b.return(rxj(K,p))})};
g.F.dF=function(){return g.E(function(K){return K.return([])})};
g.F.dH=function(){return g.E(function(K){g.mk(K)})};
g.F.eB=function(){return g.E(function(K){g.mk(K)})};g.e(yRo,Tl);yRo.prototype.j=function(K){return X3(K)?QUx(this,K):m7(K)?IKj(this,K):aX(K)?WOJ(this,K):Promise.reject(Error("Unsupported action type: "+K.actionType))};
var AV=[10];g.e(aRn,Tl);aRn.prototype.j=function(K){return X3(K)?Ujm(this,K):m7(K)?vFJ(this,K):aX(K)?R$9(this,K):Promise.reject(Error("Unsupported action type: "+K.actionType))};
var pL2=[10];g.e(v8x,Tl);v8x.prototype.j=function(K){return m7(K)?wLz(this,K):Promise.reject(Error("Unsupported action type: "+K.actionType))};g.e(B5n,F9);g.F=B5n.prototype;g.F.Sl=function(K){var X=F9.prototype.Sl.call(this,K);X.mainVideoEntity=new aRn(K,this.V,this.C);X.mainPlaylistEntity=new yRo(K,this.V,this.C);X.mainDownloadsListEntity=new v8x(K,this.V,this.C);return X};
g.F.refreshAllStaleEntities=function(K,X){var Q=this,p,U,I,d,L,b,S,N,D,v,n;return g.E(function(a){switch(a.C){case 1:p=[];if(!Q.V.K("web_player_offline_playlist_auto_refresh")){a.ZS(2);break}return g.B(a,o8l(Q,K,X),3);case 3:p=a.j;case 2:return g.B(a,Vu.getInstance(),4);case 4:return U=a.j,g.B(a,(I=U)==null?void 0:I.get("sdois"),5);case 5:return d=a.j,g.B(a,(L=U)==null?void 0:L.get("lmqf"),6);case 6:b=a.j;if(!d){a.ZS(7);break}N=p;D=N.concat;return g.B(a,KOx(Q,d,(S=b)!=null?S:"SD",K===0),8);case 8:p=
D.call(N,a.j);case 7:return v=p,n=v.concat,g.B(a,F9.prototype.refreshAllStaleEntities.call(Q,K,X),9);case 9:return p=n.call(v,a.j),a.return(p)}})};
g.F.Te=function(K){var X,Q,p,U,I,d,L,b;return g.E(function(S){if(S.C==1)return g.B(S,O3(),2);if(S.C!=3)return(X=S.j)?g.B(S,l5(X,g.iG,"mainDownloadsListEntity"),3):S.return(!1);Q=S.j;if((p=Q)==null?0:(U=p.downloads)==null?0:U.length)for(I=g.h9(K,"mainVideoEntity"),d=g.G(Q.downloads),L=d.next();!L.done;L=d.next())if(b=L.value,b.videoItem===I)return S.return(!0);return S.return(!1)})};
g.F.dF=function(){var K=this,X,Q,p,U,I,d,L,b;return g.E(function(S){if(S.C==1)return g.B(S,O3(),2);if(S.C!=3)return(X=S.j)?g.B(S,t0(X,"downloadStatusEntity"),3):S.return([]);Q=S.j;p=[];U=g.G(Q);for(I=U.next();!I.done;I=U.next())d=I.value,d.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&d.key&&(L=g.Xf(d.key).entityId,p.push(L));return p.length?(b={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},S.return(Pa(K,p,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
b))):S.return([])})};
g.F.eB=function(){var K;return g.E(function(X){return X.C==1?g.B(X,O3(),2):(K=X.j)?g.B(X,rj(K,{mode:"readwrite",o$:!0},function(Q){return uL(Q,"mainVideoEntity").then(function(p){var U=[];p=g.G(p);for(var I=p.next();!I.done;I=p.next()){I=I.value;var d=void 0;(d=I.userState)!=null&&d.playbackPosition||(d=g.Xf(I.key).entityId,d={key:g.h9(d,"videoPlaybackPositionEntity"),videoId:d,lastPlaybackPositionSeconds:"0"},U.push(ME(Q,d,"videoPlaybackPositionEntity")),I.userState={playbackPosition:d.key},U.push(ME(Q,
I,"mainVideoEntity")))}return g.WN.all(U)})}),0):X.return()})};
g.F.dH=function(){var K,X,Q,p,U,I,d,L,b,S,N,D,v,n,a,R,O,A,w,u,h,r,C,Y,l,IS,pZ,$J,Q3,V3,xJ,TK,dv,mS,h7,pY,GK,Hx;return g.E(function(U6){if(U6.C==1)return g.B(U6,O3(),2);if(U6.C!=3){K=U6.j;if(!K)return U6.return();X=g.h9("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.B(U6,rj(K,{mode:"readonly",o$:!0},function(mn){return g.WN.all([yR(mn,X,"mainDownloadsListEntity"),yR(mn,g.iG,"mainDownloadsListEntity"),uL(mn,"mainVideoEntity"),uL(mn,"mainPlaylistEntity")])}),3)}Q=U6.j;
p=g.G(Q);U=p.next().value;I=p.next().value;d=p.next().value;L=p.next().value;b=U;S=I;N=d;D=L;v=new Set;if((n=b)==null?0:(a=n.downloads)==null?0:a.length)for(R=g.G(b.downloads),O=R.next();!O.done;O=R.next())A=O.value,w=void 0,(u=(w=A.videoItem)!=null?w:A.playlistItem)&&v.add(u);if((h=S)==null?0:(r=h.downloads)==null?0:r.length)for(C=g.G(S.downloads),Y=C.next();!Y.done;Y=C.next())l=Y.value,l.videoItem&&v.add(l.videoItem);IS=new Set;pZ=[];$J=g.G(D);for(Q3=$J.next();!Q3.done;Q3=$J.next()){V3=Q3.value;
if(V3.videos)for(xJ=g.G(V3.videos),TK=xJ.next();!TK.done;TK=xJ.next())dv=TK.value,(mS=JSON.parse(g.Xf(dv).entityId).videoId)&&IS.add(mS);V3.key&&!v.has(V3.key)&&pZ.push(V3.key)}h7=g.G(N);for(pY=h7.next();!pY.done;pY=h7.next())GK=pY.value,GK.key&&!v.has(GK.key)&&(Hx=g.Xf(GK.key).entityId,IS.has(Hx)||pZ.push(GK.key));return pZ.length?g.B(U6,ODl(K,pZ),0):U6.ZS(0)})};g.e($Do,Tl);$Do.prototype.j=function(K){return X3(K)?SFo(this,K):m7(K)?TOm(this,K):aX(K)?Bw9(this,K):Promise.reject(Error("Unsupported action type: "+K.actionType))};
var kf=[10];g.e(Op3,Tl);Op3.prototype.j=function(K){return X3(K)?t53(this,K):m7(K)?j6l(this,K):aX(K)?aTj(this,K):Promise.reject(Error("Unsupported action type: "+K.actionType))};
var Ba=[10];g.e(hIl,Tl);hIl.prototype.j=function(K){return X3(K)?p9l(this,K):m7(K)?fHK(this,K):aX(K)?Q_o(this,K):Promise.reject(Error("Unsupported action type: "+K.actionType))};
var ztl=[10];g.e(E3,F9);E3.prototype.Sl=function(K){var X=F9.prototype.Sl.call(this,K);X.musicTrack=new hIl(K,this.C);X.musicPlaylist=new Op3(K,this.C);X.musicAlbumRelease=new $Do(K,this.C);return X};
E3.prototype.refreshAllStaleEntities=function(K,X){var Q=this,p,U,I;return g.E(function(d){if(d.C==1)return g.B(d,FMm(Q,K,X),2);if(d.C!=3)return U=p=d.j,I=U.concat,g.B(d,F9.prototype.refreshAllStaleEntities.call(Q,K,X),3);p=I.call(U,d.j);return d.return(p)})};g.e(g8z,g.cJ);g.F=g8z.prototype;g.F.create=function(){var K=this;g.k(this,this.events);if(g.XJ(this.V))this.C=new B5n(this.V,this.player);else if(g.oM(this.V)||g.KG(this.V))this.C=new E3(this.V,this.player);this.events.X(this.player,"onPlaybackStartExternal",function(){K.Ii()});
this.events.X(this.player,"videodatachange",function(){K.Ii()});
this.V.K("html5_offline_playback_position_sync")&&this.events.X(this.player,"presentingplayerstatechange",this.BL)};
g.F.Px=function(){return!1};
g.F.LX=function(K,X,Q,p){var U=this;return g.E(function(I){return U.C?I.return(Pa(U.C,K,X,Q,p)):I.return(Promise.reject())})};
g.F.deleteAll=function(){return this.C.deleteAll()};
g.F.MY=function(K){return this.C.MY(K)};
g.F.refreshAllStaleEntities=function(K){return this.C.refreshAllStaleEntities(K)};
g.F.setUpPositionSyncInterval=function(K){this.C.setUpPositionSyncInterval(K)};
g.F.Sg=function(K){this.C.Sg(K)};
g.F.qk=function(K){return this.C.qk(K)};
g.F.Ii=function(){var K=this,X;return g.E(function(Q){X=K.player.getVideoData();return g.$Q(X)?o7e(X)&&K.j!==X.clientPlaybackNonce?g.B(Q,dbn(K,X),0):Q.ZS(0):Q.return()})};
g.F.BL=function(K){var X=this,Q,p,U,I,d,L,b;return g.E(function(S){if(S.C==1)return Q=X.player.getVideoData(),p=Q.ZL,g.qx(K,2)||g.qx(K,512)?g.B(S,O3(),2):S.return();if(S.C!=3){U=S.j;if(!U)return mg("PES is undefined"),S.return();I=Q.videoId;return g.B(S,l5(U,g.h9(I,"mainVideoEntity"),"mainVideoEntity"),3)}d=S.j;if(!d)return S.return();L=Math.floor(p).toString();b={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:L}};return g.B(S,X.LX([I],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
b),0)})};
g.F.isOrchestrationLeader=function(){return this.C.isOrchestrationLeader()};
g.F.updateDownloadState=function(K,X){var Q,p,U,I;return g.E(function(d){if(d.C==1)return g.B(d,O3(),2);Q=d.j;if(!Q)return mg("PES is undefined"),d.return();p=g.Xf(K);U=p.entityType;I=p.entityId;return g.B(d,wX(I,U,Q,X,!0),0)})};g.Nq("offline",g8z);})(_yt_player);
